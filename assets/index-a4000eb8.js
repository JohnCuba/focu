var Is=Object.defineProperty;var Ts=(t,e,n)=>e in t?Is(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var _e=(t,e,n)=>(Ts(t,typeof e!="symbol"?e+"":e,n),n);import{d as no,r as $e,o as qs,a as Ke,b as he,c as Se,e as ee,t as tn,n as jt,w as pn,f as nn,F as ro,g as js,h as rt,i as Lt,j as Ds,k as Ps,l as Rs,m as ot,u as fe,p as $r,q as ti,s as Sr,T as Bs,v as io,x as Dt,y as Ls,z as ni,A as Ms,B as ri}from"./index-fbd8d5ee.js";var Ns=typeof globalThis<"u"?globalThis:typeof window<"u"||typeof window<"u"?window:typeof self<"u"?self:{};function Us(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){if(this instanceof r){var i=[null];i.push.apply(i,arguments);var o=Function.bind.apply(e,i);return new o}return e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var Qn={},Fs={get exports(){return Qn},set exports(t){Qn=t}};(function(t,e){(function(n,r){t.exports=r()})(Ns,function(){var n=1e3,r=6e4,i=36e5,o="millisecond",s="second",a="minute",u="hour",h="day",y="week",c="month",w="quarter",$="year",O="date",T="Invalid Date",k=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,m=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,g={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(A){var E=["th","st","nd","rd"],q=A%100;return"["+A+(E[(q-20)%10]||E[q]||E[0])+"]"}},f=function(A,E,q){var N=String(A);return!N||N.length>=E?A:""+Array(E+1-N.length).join(q)+A},d={s:f,z:function(A){var E=-A.utcOffset(),q=Math.abs(E),N=Math.floor(q/60),R=q%60;return(E<=0?"+":"-")+f(N,2,"0")+":"+f(R,2,"0")},m:function A(E,q){if(E.date()<q.date())return-A(q,E);var N=12*(q.year()-E.year())+(q.month()-E.month()),R=E.clone().add(N,c),l=q-R<0,v=E.clone().add(N+(l?-1:1),c);return+(-(N+(q-R)/(l?R-v:v-R))||0)},a:function(A){return A<0?Math.ceil(A)||0:Math.floor(A)},p:function(A){return{M:c,y:$,w:y,d:h,D:O,h:u,m:a,s,ms:o,Q:w}[A]||String(A||"").toLowerCase().replace(/s$/,"")},u:function(A){return A===void 0}},p="en",_={};_[p]=g;var P=function(A){return A instanceof z},M=function A(E,q,N){var R;if(!E)return p;if(typeof E=="string"){var l=E.toLowerCase();_[l]&&(R=l),q&&(_[l]=q,R=l);var v=E.split("-");if(!R&&v.length>1)return A(v[0])}else{var b=E.name;_[b]=E,R=b}return!N&&R&&(p=R),R||!N&&p},D=function(A,E){if(P(A))return A.clone();var q=typeof E=="object"?E:{};return q.date=A,q.args=arguments,new z(q)},U=d;U.l=M,U.i=P,U.w=function(A,E){return D(A,{locale:E.$L,utc:E.$u,x:E.$x,$offset:E.$offset})};var z=function(){function A(q){this.$L=M(q.locale,null,!0),this.parse(q)}var E=A.prototype;return E.parse=function(q){this.$d=function(N){var R=N.date,l=N.utc;if(R===null)return new Date(NaN);if(U.u(R))return new Date;if(R instanceof Date)return new Date(R);if(typeof R=="string"&&!/Z$/i.test(R)){var v=R.match(k);if(v){var b=v[2]-1||0,S=(v[7]||"0").substring(0,3);return l?new Date(Date.UTC(v[1],b,v[3]||1,v[4]||0,v[5]||0,v[6]||0,S)):new Date(v[1],b,v[3]||1,v[4]||0,v[5]||0,v[6]||0,S)}}return new Date(R)}(q),this.$x=q.x||{},this.init()},E.init=function(){var q=this.$d;this.$y=q.getFullYear(),this.$M=q.getMonth(),this.$D=q.getDate(),this.$W=q.getDay(),this.$H=q.getHours(),this.$m=q.getMinutes(),this.$s=q.getSeconds(),this.$ms=q.getMilliseconds()},E.$utils=function(){return U},E.isValid=function(){return this.$d.toString()!==T},E.isSame=function(q,N){var R=D(q);return this.startOf(N)<=R&&R<=this.endOf(N)},E.isAfter=function(q,N){return D(q)<this.startOf(N)},E.isBefore=function(q,N){return this.endOf(N)<D(q)},E.$g=function(q,N,R){return U.u(q)?this[N]:this.set(R,q)},E.unix=function(){return Math.floor(this.valueOf()/1e3)},E.valueOf=function(){return this.$d.getTime()},E.startOf=function(q,N){var R=this,l=!!U.u(N)||N,v=U.p(q),b=function(B,F){var K=U.w(R.$u?Date.UTC(R.$y,F,B):new Date(R.$y,F,B),R);return l?K:K.endOf(h)},S=function(B,F){return U.w(R.toDate()[B].apply(R.toDate("s"),(l?[0,0,0,0]:[23,59,59,999]).slice(F)),R)},I=this.$W,L=this.$M,Q=this.$D,j="set"+(this.$u?"UTC":"");switch(v){case $:return l?b(1,0):b(31,11);case c:return l?b(1,L):b(0,L+1);case y:var x=this.$locale().weekStart||0,C=(I<x?I+7:I)-x;return b(l?Q-C:Q+(6-C),L);case h:case O:return S(j+"Hours",0);case u:return S(j+"Minutes",1);case a:return S(j+"Seconds",2);case s:return S(j+"Milliseconds",3);default:return this.clone()}},E.endOf=function(q){return this.startOf(q,!1)},E.$set=function(q,N){var R,l=U.p(q),v="set"+(this.$u?"UTC":""),b=(R={},R[h]=v+"Date",R[O]=v+"Date",R[c]=v+"Month",R[$]=v+"FullYear",R[u]=v+"Hours",R[a]=v+"Minutes",R[s]=v+"Seconds",R[o]=v+"Milliseconds",R)[l],S=l===h?this.$D+(N-this.$W):N;if(l===c||l===$){var I=this.clone().set(O,1);I.$d[b](S),I.init(),this.$d=I.set(O,Math.min(this.$D,I.daysInMonth())).$d}else b&&this.$d[b](S);return this.init(),this},E.set=function(q,N){return this.clone().$set(q,N)},E.get=function(q){return this[U.p(q)]()},E.add=function(q,N){var R,l=this;q=Number(q);var v=U.p(N),b=function(L){var Q=D(l);return U.w(Q.date(Q.date()+Math.round(L*q)),l)};if(v===c)return this.set(c,this.$M+q);if(v===$)return this.set($,this.$y+q);if(v===h)return b(1);if(v===y)return b(7);var S=(R={},R[a]=r,R[u]=i,R[s]=n,R)[v]||1,I=this.$d.getTime()+q*S;return U.w(I,this)},E.subtract=function(q,N){return this.add(-1*q,N)},E.format=function(q){var N=this,R=this.$locale();if(!this.isValid())return R.invalidDate||T;var l=q||"YYYY-MM-DDTHH:mm:ssZ",v=U.z(this),b=this.$H,S=this.$m,I=this.$M,L=R.weekdays,Q=R.months,j=function(F,K,X,ie){return F&&(F[K]||F(N,l))||X[K].slice(0,ie)},x=function(F){return U.s(b%12||12,F,"0")},C=R.meridiem||function(F,K,X){var ie=F<12?"AM":"PM";return X?ie.toLowerCase():ie},B={YY:String(this.$y).slice(-2),YYYY:this.$y,M:I+1,MM:U.s(I+1,2,"0"),MMM:j(R.monthsShort,I,Q,3),MMMM:j(Q,I),D:this.$D,DD:U.s(this.$D,2,"0"),d:String(this.$W),dd:j(R.weekdaysMin,this.$W,L,2),ddd:j(R.weekdaysShort,this.$W,L,3),dddd:L[this.$W],H:String(b),HH:U.s(b,2,"0"),h:x(1),hh:x(2),a:C(b,S,!0),A:C(b,S,!1),m:String(S),mm:U.s(S,2,"0"),s:String(this.$s),ss:U.s(this.$s,2,"0"),SSS:U.s(this.$ms,3,"0"),Z:v};return l.replace(m,function(F,K){return K||B[F]||v.replace(":","")})},E.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},E.diff=function(q,N,R){var l,v=U.p(N),b=D(q),S=(b.utcOffset()-this.utcOffset())*r,I=this-b,L=U.m(this,b);return L=(l={},l[$]=L/12,l[c]=L,l[w]=L/3,l[y]=(I-S)/6048e5,l[h]=(I-S)/864e5,l[u]=I/i,l[a]=I/r,l[s]=I/n,l)[v]||I,R?L:U.a(L)},E.daysInMonth=function(){return this.endOf(c).$D},E.$locale=function(){return _[this.$L]},E.locale=function(q,N){if(!q)return this.$L;var R=this.clone(),l=M(q,N,!0);return l&&(R.$L=l),R},E.clone=function(){return U.w(this.$d,this)},E.toDate=function(){return new Date(this.valueOf())},E.toJSON=function(){return this.isValid()?this.toISOString():null},E.toISOString=function(){return this.$d.toISOString()},E.toString=function(){return this.$d.toUTCString()},A}(),H=z.prototype;return D.prototype=H,[["$ms",o],["$s",s],["$m",a],["$H",u],["$W",h],["$M",c],["$y",$],["$D",O]].forEach(function(A){H[A[1]]=function(E){return this.$g(E,A[0],A[1])}}),D.extend=function(A,E){return A.$i||(A(E,z,D),A.$i=!0),D},D.locale=M,D.isDayjs=P,D.unix=function(A){return D(1e3*A)},D.en=_[p],D.Ls=_,D.p={},D})})(Fs);var rn={},Ks={get exports(){return rn},set exports(t){rn=t}};(function(t,e){var n=function(){function i(){this.fetch=!1,this.DOMException=window.DOMException}return i.prototype=window,new i}();(function(i){(function(o){var s={searchParams:"URLSearchParams"in i,iterable:"Symbol"in i&&"iterator"in Symbol,blob:"FileReader"in i&&"Blob"in i&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in i,arrayBuffer:"ArrayBuffer"in i};function a(A){return A&&DataView.prototype.isPrototypeOf(A)}if(s.arrayBuffer)var u=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],h=ArrayBuffer.isView||function(A){return A&&u.indexOf(Object.prototype.toString.call(A))>-1};function y(A){if(typeof A!="string"&&(A=String(A)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(A))throw new TypeError("Invalid character in header field name");return A.toLowerCase()}function c(A){return typeof A!="string"&&(A=String(A)),A}function w(A){var E={next:function(){var q=A.shift();return{done:q===void 0,value:q}}};return s.iterable&&(E[Symbol.iterator]=function(){return E}),E}function $(A){this.map={},A instanceof $?A.forEach(function(E,q){this.append(q,E)},this):Array.isArray(A)?A.forEach(function(E){this.append(E[0],E[1])},this):A&&Object.getOwnPropertyNames(A).forEach(function(E){this.append(E,A[E])},this)}$.prototype.append=function(A,E){A=y(A),E=c(E);var q=this.map[A];this.map[A]=q?q+", "+E:E},$.prototype.delete=function(A){delete this.map[y(A)]},$.prototype.get=function(A){return A=y(A),this.has(A)?this.map[A]:null},$.prototype.has=function(A){return this.map.hasOwnProperty(y(A))},$.prototype.set=function(A,E){this.map[y(A)]=c(E)},$.prototype.forEach=function(A,E){for(var q in this.map)this.map.hasOwnProperty(q)&&A.call(E,this.map[q],q,this)},$.prototype.keys=function(){var A=[];return this.forEach(function(E,q){A.push(q)}),w(A)},$.prototype.values=function(){var A=[];return this.forEach(function(E){A.push(E)}),w(A)},$.prototype.entries=function(){var A=[];return this.forEach(function(E,q){A.push([q,E])}),w(A)},s.iterable&&($.prototype[Symbol.iterator]=$.prototype.entries);function O(A){if(A.bodyUsed)return Promise.reject(new TypeError("Already read"));A.bodyUsed=!0}function T(A){return new Promise(function(E,q){A.onload=function(){E(A.result)},A.onerror=function(){q(A.error)}})}function k(A){var E=new FileReader,q=T(E);return E.readAsArrayBuffer(A),q}function m(A){var E=new FileReader,q=T(E);return E.readAsText(A),q}function g(A){for(var E=new Uint8Array(A),q=new Array(E.length),N=0;N<E.length;N++)q[N]=String.fromCharCode(E[N]);return q.join("")}function f(A){if(A.slice)return A.slice(0);var E=new Uint8Array(A.byteLength);return E.set(new Uint8Array(A)),E.buffer}function d(){return this.bodyUsed=!1,this._initBody=function(A){this._bodyInit=A,A?typeof A=="string"?this._bodyText=A:s.blob&&Blob.prototype.isPrototypeOf(A)?this._bodyBlob=A:s.formData&&FormData.prototype.isPrototypeOf(A)?this._bodyFormData=A:s.searchParams&&URLSearchParams.prototype.isPrototypeOf(A)?this._bodyText=A.toString():s.arrayBuffer&&s.blob&&a(A)?(this._bodyArrayBuffer=f(A.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):s.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(A)||h(A))?this._bodyArrayBuffer=f(A):this._bodyText=A=Object.prototype.toString.call(A):this._bodyText="",this.headers.get("content-type")||(typeof A=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):s.searchParams&&URLSearchParams.prototype.isPrototypeOf(A)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},s.blob&&(this.blob=function(){var A=O(this);if(A)return A;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?O(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(k)}),this.text=function(){var A=O(this);if(A)return A;if(this._bodyBlob)return m(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(g(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},s.formData&&(this.formData=function(){return this.text().then(M)}),this.json=function(){return this.text().then(JSON.parse)},this}var p=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function _(A){var E=A.toUpperCase();return p.indexOf(E)>-1?E:A}function P(A,E){E=E||{};var q=E.body;if(A instanceof P){if(A.bodyUsed)throw new TypeError("Already read");this.url=A.url,this.credentials=A.credentials,E.headers||(this.headers=new $(A.headers)),this.method=A.method,this.mode=A.mode,this.signal=A.signal,!q&&A._bodyInit!=null&&(q=A._bodyInit,A.bodyUsed=!0)}else this.url=String(A);if(this.credentials=E.credentials||this.credentials||"same-origin",(E.headers||!this.headers)&&(this.headers=new $(E.headers)),this.method=_(E.method||this.method||"GET"),this.mode=E.mode||this.mode||null,this.signal=E.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&q)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(q)}P.prototype.clone=function(){return new P(this,{body:this._bodyInit})};function M(A){var E=new FormData;return A.trim().split("&").forEach(function(q){if(q){var N=q.split("="),R=N.shift().replace(/\+/g," "),l=N.join("=").replace(/\+/g," ");E.append(decodeURIComponent(R),decodeURIComponent(l))}}),E}function D(A){var E=new $,q=A.replace(/\r?\n[\t ]+/g," ");return q.split(/\r?\n/).forEach(function(N){var R=N.split(":"),l=R.shift().trim();if(l){var v=R.join(":").trim();E.append(l,v)}}),E}d.call(P.prototype);function U(A,E){E||(E={}),this.type="default",this.status=E.status===void 0?200:E.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in E?E.statusText:"OK",this.headers=new $(E.headers),this.url=E.url||"",this._initBody(A)}d.call(U.prototype),U.prototype.clone=function(){return new U(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new $(this.headers),url:this.url})},U.error=function(){var A=new U(null,{status:0,statusText:""});return A.type="error",A};var z=[301,302,303,307,308];U.redirect=function(A,E){if(z.indexOf(E)===-1)throw new RangeError("Invalid status code");return new U(null,{status:E,headers:{location:A}})},o.DOMException=i.DOMException;try{new o.DOMException}catch{o.DOMException=function(E,q){this.message=E,this.name=q;var N=Error(E);this.stack=N.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function H(A,E){return new Promise(function(q,N){var R=new P(A,E);if(R.signal&&R.signal.aborted)return N(new o.DOMException("Aborted","AbortError"));var l=new XMLHttpRequest;function v(){l.abort()}l.onload=function(){var b={status:l.status,statusText:l.statusText,headers:D(l.getAllResponseHeaders()||"")};b.url="responseURL"in l?l.responseURL:b.headers.get("X-Request-URL");var S="response"in l?l.response:l.responseText;q(new U(S,b))},l.onerror=function(){N(new TypeError("Network request failed"))},l.ontimeout=function(){N(new TypeError("Network request failed"))},l.onabort=function(){N(new o.DOMException("Aborted","AbortError"))},l.open(R.method,R.url,!0),R.credentials==="include"?l.withCredentials=!0:R.credentials==="omit"&&(l.withCredentials=!1),"responseType"in l&&s.blob&&(l.responseType="blob"),R.headers.forEach(function(b,S){l.setRequestHeader(S,b)}),R.signal&&(R.signal.addEventListener("abort",v),l.onreadystatechange=function(){l.readyState===4&&R.signal.removeEventListener("abort",v)}),l.send(typeof R._bodyInit>"u"?null:R._bodyInit)})}return H.polyfill=!0,i.fetch||(i.fetch=H,i.Headers=$,i.Request=P,i.Response=U),o.Headers=$,o.Request=P,o.Response=U,o.fetch=H,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(n),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var r=n;e=r.fetch,e.default=r.fetch,e.fetch=r.fetch,e.Headers=r.Headers,e.Request=r.Request,e.Response=r.Response,t.exports=e})(Ks,rn);function oe(t,e,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function a(y){try{h(r.next(y))}catch(c){s(c)}}function u(y){try{h(r.throw(y))}catch(c){s(c)}}function h(y){y.done?o(y.value):i(y.value).then(a,u)}h((r=r.apply(t,e||[])).next())})}class xe{constructor(e){this.client=e}static flatten(e,n=""){let r={};for(const i in e){let o=e[i],s=n?`${n}[${i}]`:i;Array.isArray(o)?r=Object.assign(r,this.flatten(o,s)):r[s]=o}return r}}xe.CHUNK_SIZE=5*1024*1024;class G extends Error{constructor(e,n=0,r="",i=""){super(e),this.name="AppwriteException",this.message=e,this.code=n,this.type=r,this.response=i}}class Qs{constructor(){this.config={endpoint:"https://HOSTNAME/v1",endpointRealtime:"",project:"",jwt:"",locale:""},this.headers={"x-sdk-name":"Web","x-sdk-platform":"client","x-sdk-language":"web","x-sdk-version":"11.0.0","X-Appwrite-Response-Format":"1.0.0"},this.realtime={socket:void 0,timeout:void 0,url:"",channels:new Set,subscriptions:new Map,subscriptionsCounter:0,reconnect:!0,reconnectAttempts:0,lastMessage:void 0,connect:()=>{clearTimeout(this.realtime.timeout),this.realtime.timeout=window==null?void 0:window.setTimeout(()=>{this.realtime.createSocket()},50)},getTimeout:()=>{switch(!0){case this.realtime.reconnectAttempts<5:return 1e3;case this.realtime.reconnectAttempts<15:return 5e3;case this.realtime.reconnectAttempts<100:return 1e4;default:return 6e4}},createSocket:()=>{var e,n;if(this.realtime.channels.size<1)return;const r=new URLSearchParams;r.set("project",this.config.project),this.realtime.channels.forEach(o=>{r.append("channels[]",o)});const i=this.config.endpointRealtime+"/realtime?"+r.toString();(i!==this.realtime.url||!this.realtime.socket||((e=this.realtime.socket)===null||e===void 0?void 0:e.readyState)>WebSocket.OPEN)&&(this.realtime.socket&&((n=this.realtime.socket)===null||n===void 0?void 0:n.readyState)<WebSocket.CLOSING&&(this.realtime.reconnect=!1,this.realtime.socket.close()),this.realtime.url=i,this.realtime.socket=new WebSocket(i),this.realtime.socket.addEventListener("message",this.realtime.onMessage),this.realtime.socket.addEventListener("open",o=>{this.realtime.reconnectAttempts=0}),this.realtime.socket.addEventListener("close",o=>{var s,a,u;if(!this.realtime.reconnect||((a=(s=this.realtime)===null||s===void 0?void 0:s.lastMessage)===null||a===void 0?void 0:a.type)==="error"&&((u=this.realtime)===null||u===void 0?void 0:u.lastMessage.data).code===1008){this.realtime.reconnect=!0;return}const h=this.realtime.getTimeout();console.error(`Realtime got disconnected. Reconnect will be attempted in ${h/1e3} seconds.`,o.reason),setTimeout(()=>{this.realtime.reconnectAttempts++,this.realtime.createSocket()},h)}))},onMessage:e=>{var n,r;try{const i=JSON.parse(e.data);switch(this.realtime.lastMessage=i,i.type){case"connected":const o=JSON.parse((n=window.localStorage.getItem("cookieFallback"))!==null&&n!==void 0?n:"{}"),s=o==null?void 0:o[`a_session_${this.config.project}`],a=i.data;s&&!a.user&&((r=this.realtime.socket)===null||r===void 0||r.send(JSON.stringify({type:"authentication",data:{session:s}})));break;case"event":let u=i.data;if(u!=null&&u.channels){if(!u.channels.some(y=>this.realtime.channels.has(y)))return;this.realtime.subscriptions.forEach(y=>{u.channels.some(c=>y.channels.includes(c))&&setTimeout(()=>y.callback(u))})}break;case"error":throw i.data;default:break}}catch(i){console.error(i)}},cleanUp:e=>{this.realtime.channels.forEach(n=>{e.includes(n)&&(Array.from(this.realtime.subscriptions).some(([i,o])=>o.channels.includes(n))||this.realtime.channels.delete(n))})}}}setEndpoint(e){return this.config.endpoint=e,this.config.endpointRealtime=this.config.endpointRealtime||this.config.endpoint.replace("https://","wss://").replace("http://","ws://"),this}setEndpointRealtime(e){return this.config.endpointRealtime=e,this}setProject(e){return this.headers["X-Appwrite-Project"]=e,this.config.project=e,this}setJWT(e){return this.headers["X-Appwrite-JWT"]=e,this.config.jwt=e,this}setLocale(e){return this.headers["X-Appwrite-Locale"]=e,this.config.locale=e,this}subscribe(e,n){let r=typeof e=="string"?[e]:e;r.forEach(o=>this.realtime.channels.add(o));const i=this.realtime.subscriptionsCounter++;return this.realtime.subscriptions.set(i,{channels:r,callback:n}),this.realtime.connect(),()=>{this.realtime.subscriptions.delete(i),this.realtime.cleanUp(r),this.realtime.connect()}}call(e,n,r={},i={}){var o,s;return oe(this,void 0,void 0,function*(){e=e.toUpperCase(),r=Object.assign({},this.headers,r);let a={method:e,headers:r,credentials:"include"};if(typeof window<"u"&&window.localStorage&&(r["X-Fallback-Cookies"]=(o=window.localStorage.getItem("cookieFallback"))!==null&&o!==void 0?o:""),e==="GET")for(const[u,h]of Object.entries(xe.flatten(i)))n.searchParams.append(u,h);else switch(r["content-type"]){case"application/json":a.body=JSON.stringify(i);break;case"multipart/form-data":let u=new FormData;for(const h in i)Array.isArray(i[h])?i[h].forEach(y=>{u.append(h+"[]",y)}):u.append(h,i[h]);a.body=u,delete r["content-type"];break}try{let u=null;const h=yield rn.fetch(n.toString(),a);if(!((s=h.headers.get("content-type"))===null||s===void 0)&&s.includes("application/json")?u=yield h.json():u={message:yield h.text()},400<=h.status)throw new G(u==null?void 0:u.message,h.status,u==null?void 0:u.type,u);const y=h.headers.get("X-Fallback-Cookies");return typeof window<"u"&&window.localStorage&&y&&(window.console.warn("Appwrite is using localStorage for session management. Increase your security by adding a custom domain as your API endpoint."),window.localStorage.setItem("cookieFallback",y)),u}catch(u){throw u instanceof G?u:new G(u.message)}})}}class Ws extends xe{constructor(e){super(e)}get(){return oe(this,void 0,void 0,function*(){let e="/account",n={};const r=new URL(this.client.config.endpoint+e);return yield this.client.call("get",r,{"content-type":"application/json"},n)})}create(e,n,r,i){return oe(this,void 0,void 0,function*(){if(typeof e>"u")throw new G('Missing required parameter: "userId"');if(typeof n>"u")throw new G('Missing required parameter: "email"');if(typeof r>"u")throw new G('Missing required parameter: "password"');let o="/account",s={};typeof e<"u"&&(s.userId=e),typeof n<"u"&&(s.email=n),typeof r<"u"&&(s.password=r),typeof i<"u"&&(s.name=i);const a=new URL(this.client.config.endpoint+o);return yield this.client.call("post",a,{"content-type":"application/json"},s)})}updateEmail(e,n){return oe(this,void 0,void 0,function*(){if(typeof e>"u")throw new G('Missing required parameter: "email"');if(typeof n>"u")throw new G('Missing required parameter: "password"');let r="/account/email",i={};typeof e<"u"&&(i.email=e),typeof n<"u"&&(i.password=n);const o=new URL(this.client.config.endpoint+r);return yield this.client.call("patch",o,{"content-type":"application/json"},i)})}createJWT(){return oe(this,void 0,void 0,function*(){let e="/account/jwt",n={};const r=new URL(this.client.config.endpoint+e);return yield this.client.call("post",r,{"content-type":"application/json"},n)})}listLogs(e){return oe(this,void 0,void 0,function*(){let n="/account/logs",r={};typeof e<"u"&&(r.queries=e);const i=new URL(this.client.config.endpoint+n);return yield this.client.call("get",i,{"content-type":"application/json"},r)})}updateName(e){return oe(this,void 0,void 0,function*(){if(typeof e>"u")throw new G('Missing required parameter: "name"');let n="/account/name",r={};typeof e<"u"&&(r.name=e);const i=new URL(this.client.config.endpoint+n);return yield this.client.call("patch",i,{"content-type":"application/json"},r)})}updatePassword(e,n){return oe(this,void 0,void 0,function*(){if(typeof e>"u")throw new G('Missing required parameter: "password"');let r="/account/password",i={};typeof e<"u"&&(i.password=e),typeof n<"u"&&(i.oldPassword=n);const o=new URL(this.client.config.endpoint+r);return yield this.client.call("patch",o,{"content-type":"application/json"},i)})}updatePhone(e,n){return oe(this,void 0,void 0,function*(){if(typeof e>"u")throw new G('Missing required parameter: "phone"');if(typeof n>"u")throw new G('Missing required parameter: "password"');let r="/account/phone",i={};typeof e<"u"&&(i.phone=e),typeof n<"u"&&(i.password=n);const o=new URL(this.client.config.endpoint+r);return yield this.client.call("patch",o,{"content-type":"application/json"},i)})}getPrefs(){return oe(this,void 0,void 0,function*(){let e="/account/prefs",n={};const r=new URL(this.client.config.endpoint+e);return yield this.client.call("get",r,{"content-type":"application/json"},n)})}updatePrefs(e){return oe(this,void 0,void 0,function*(){if(typeof e>"u")throw new G('Missing required parameter: "prefs"');let n="/account/prefs",r={};typeof e<"u"&&(r.prefs=e);const i=new URL(this.client.config.endpoint+n);return yield this.client.call("patch",i,{"content-type":"application/json"},r)})}createRecovery(e,n){return oe(this,void 0,void 0,function*(){if(typeof e>"u")throw new G('Missing required parameter: "email"');if(typeof n>"u")throw new G('Missing required parameter: "url"');let r="/account/recovery",i={};typeof e<"u"&&(i.email=e),typeof n<"u"&&(i.url=n);const o=new URL(this.client.config.endpoint+r);return yield this.client.call("post",o,{"content-type":"application/json"},i)})}updateRecovery(e,n,r,i){return oe(this,void 0,void 0,function*(){if(typeof e>"u")throw new G('Missing required parameter: "userId"');if(typeof n>"u")throw new G('Missing required parameter: "secret"');if(typeof r>"u")throw new G('Missing required parameter: "password"');if(typeof i>"u")throw new G('Missing required parameter: "passwordAgain"');let o="/account/recovery",s={};typeof e<"u"&&(s.userId=e),typeof n<"u"&&(s.secret=n),typeof r<"u"&&(s.password=r),typeof i<"u"&&(s.passwordAgain=i);const a=new URL(this.client.config.endpoint+o);return yield this.client.call("put",a,{"content-type":"application/json"},s)})}listSessions(){return oe(this,void 0,void 0,function*(){let e="/account/sessions",n={};const r=new URL(this.client.config.endpoint+e);return yield this.client.call("get",r,{"content-type":"application/json"},n)})}deleteSessions(){return oe(this,void 0,void 0,function*(){let e="/account/sessions",n={};const r=new URL(this.client.config.endpoint+e);return yield this.client.call("delete",r,{"content-type":"application/json"},n)})}createAnonymousSession(){return oe(this,void 0,void 0,function*(){let e="/account/sessions/anonymous",n={};const r=new URL(this.client.config.endpoint+e);return yield this.client.call("post",r,{"content-type":"application/json"},n)})}createEmailSession(e,n){return oe(this,void 0,void 0,function*(){if(typeof e>"u")throw new G('Missing required parameter: "email"');if(typeof n>"u")throw new G('Missing required parameter: "password"');let r="/account/sessions/email",i={};typeof e<"u"&&(i.email=e),typeof n<"u"&&(i.password=n);const o=new URL(this.client.config.endpoint+r);return yield this.client.call("post",o,{"content-type":"application/json"},i)})}createMagicURLSession(e,n,r){return oe(this,void 0,void 0,function*(){if(typeof e>"u")throw new G('Missing required parameter: "userId"');if(typeof n>"u")throw new G('Missing required parameter: "email"');let i="/account/sessions/magic-url",o={};typeof e<"u"&&(o.userId=e),typeof n<"u"&&(o.email=n),typeof r<"u"&&(o.url=r);const s=new URL(this.client.config.endpoint+i);return yield this.client.call("post",s,{"content-type":"application/json"},o)})}updateMagicURLSession(e,n){return oe(this,void 0,void 0,function*(){if(typeof e>"u")throw new G('Missing required parameter: "userId"');if(typeof n>"u")throw new G('Missing required parameter: "secret"');let r="/account/sessions/magic-url",i={};typeof e<"u"&&(i.userId=e),typeof n<"u"&&(i.secret=n);const o=new URL(this.client.config.endpoint+r);return yield this.client.call("put",o,{"content-type":"application/json"},i)})}createOAuth2Session(e,n,r,i){if(typeof e>"u")throw new G('Missing required parameter: "provider"');let o="/account/sessions/oauth2/{provider}".replace("{provider}",e),s={};typeof n<"u"&&(s.success=n),typeof r<"u"&&(s.failure=r),typeof i<"u"&&(s.scopes=i);const a=new URL(this.client.config.endpoint+o);s.project=this.client.config.project;for(const[u,h]of Object.entries(xe.flatten(s)))a.searchParams.append(u,h);if(typeof window<"u"&&(window!=null&&window.location))window.location.href=a.toString();else return a}createPhoneSession(e,n){return oe(this,void 0,void 0,function*(){if(typeof e>"u")throw new G('Missing required parameter: "userId"');if(typeof n>"u")throw new G('Missing required parameter: "phone"');let r="/account/sessions/phone",i={};typeof e<"u"&&(i.userId=e),typeof n<"u"&&(i.phone=n);const o=new URL(this.client.config.endpoint+r);return yield this.client.call("post",o,{"content-type":"application/json"},i)})}updatePhoneSession(e,n){return oe(this,void 0,void 0,function*(){if(typeof e>"u")throw new G('Missing required parameter: "userId"');if(typeof n>"u")throw new G('Missing required parameter: "secret"');let r="/account/sessions/phone",i={};typeof e<"u"&&(i.userId=e),typeof n<"u"&&(i.secret=n);const o=new URL(this.client.config.endpoint+r);return yield this.client.call("put",o,{"content-type":"application/json"},i)})}getSession(e){return oe(this,void 0,void 0,function*(){if(typeof e>"u")throw new G('Missing required parameter: "sessionId"');let n="/account/sessions/{sessionId}".replace("{sessionId}",e),r={};const i=new URL(this.client.config.endpoint+n);return yield this.client.call("get",i,{"content-type":"application/json"},r)})}updateSession(e){return oe(this,void 0,void 0,function*(){if(typeof e>"u")throw new G('Missing required parameter: "sessionId"');let n="/account/sessions/{sessionId}".replace("{sessionId}",e),r={};const i=new URL(this.client.config.endpoint+n);return yield this.client.call("patch",i,{"content-type":"application/json"},r)})}deleteSession(e){return oe(this,void 0,void 0,function*(){if(typeof e>"u")throw new G('Missing required parameter: "sessionId"');let n="/account/sessions/{sessionId}".replace("{sessionId}",e),r={};const i=new URL(this.client.config.endpoint+n);return yield this.client.call("delete",i,{"content-type":"application/json"},r)})}updateStatus(){return oe(this,void 0,void 0,function*(){let e="/account/status",n={};const r=new URL(this.client.config.endpoint+e);return yield this.client.call("patch",r,{"content-type":"application/json"},n)})}createVerification(e){return oe(this,void 0,void 0,function*(){if(typeof e>"u")throw new G('Missing required parameter: "url"');let n="/account/verification",r={};typeof e<"u"&&(r.url=e);const i=new URL(this.client.config.endpoint+n);return yield this.client.call("post",i,{"content-type":"application/json"},r)})}updateVerification(e,n){return oe(this,void 0,void 0,function*(){if(typeof e>"u")throw new G('Missing required parameter: "userId"');if(typeof n>"u")throw new G('Missing required parameter: "secret"');let r="/account/verification",i={};typeof e<"u"&&(i.userId=e),typeof n<"u"&&(i.secret=n);const o=new URL(this.client.config.endpoint+r);return yield this.client.call("put",o,{"content-type":"application/json"},i)})}createPhoneVerification(){return oe(this,void 0,void 0,function*(){let e="/account/verification/phone",n={};const r=new URL(this.client.config.endpoint+e);return yield this.client.call("post",r,{"content-type":"application/json"},n)})}updatePhoneVerification(e,n){return oe(this,void 0,void 0,function*(){if(typeof e>"u")throw new G('Missing required parameter: "userId"');if(typeof n>"u")throw new G('Missing required parameter: "secret"');let r="/account/verification/phone",i={};typeof e<"u"&&(i.userId=e),typeof n<"u"&&(i.secret=n);const o=new URL(this.client.config.endpoint+r);return yield this.client.call("put",o,{"content-type":"application/json"},i)})}}class zs extends xe{constructor(e){super(e)}getBrowser(e,n,r,i){if(typeof e>"u")throw new G('Missing required parameter: "code"');let o="/avatars/browsers/{code}".replace("{code}",e),s={};typeof n<"u"&&(s.width=n),typeof r<"u"&&(s.height=r),typeof i<"u"&&(s.quality=i);const a=new URL(this.client.config.endpoint+o);s.project=this.client.config.project;for(const[u,h]of Object.entries(xe.flatten(s)))a.searchParams.append(u,h);return a}getCreditCard(e,n,r,i){if(typeof e>"u")throw new G('Missing required parameter: "code"');let o="/avatars/credit-cards/{code}".replace("{code}",e),s={};typeof n<"u"&&(s.width=n),typeof r<"u"&&(s.height=r),typeof i<"u"&&(s.quality=i);const a=new URL(this.client.config.endpoint+o);s.project=this.client.config.project;for(const[u,h]of Object.entries(xe.flatten(s)))a.searchParams.append(u,h);return a}getFavicon(e){if(typeof e>"u")throw new G('Missing required parameter: "url"');let n="/avatars/favicon",r={};typeof e<"u"&&(r.url=e);const i=new URL(this.client.config.endpoint+n);r.project=this.client.config.project;for(const[o,s]of Object.entries(xe.flatten(r)))i.searchParams.append(o,s);return i}getFlag(e,n,r,i){if(typeof e>"u")throw new G('Missing required parameter: "code"');let o="/avatars/flags/{code}".replace("{code}",e),s={};typeof n<"u"&&(s.width=n),typeof r<"u"&&(s.height=r),typeof i<"u"&&(s.quality=i);const a=new URL(this.client.config.endpoint+o);s.project=this.client.config.project;for(const[u,h]of Object.entries(xe.flatten(s)))a.searchParams.append(u,h);return a}getImage(e,n,r){if(typeof e>"u")throw new G('Missing required parameter: "url"');let i="/avatars/image",o={};typeof e<"u"&&(o.url=e),typeof n<"u"&&(o.width=n),typeof r<"u"&&(o.height=r);const s=new URL(this.client.config.endpoint+i);o.project=this.client.config.project;for(const[a,u]of Object.entries(xe.flatten(o)))s.searchParams.append(a,u);return s}getInitials(e,n,r,i){let o="/avatars/initials",s={};typeof e<"u"&&(s.name=e),typeof n<"u"&&(s.width=n),typeof r<"u"&&(s.height=r),typeof i<"u"&&(s.background=i);const a=new URL(this.client.config.endpoint+o);s.project=this.client.config.project;for(const[u,h]of Object.entries(xe.flatten(s)))a.searchParams.append(u,h);return a}getQR(e,n,r,i){if(typeof e>"u")throw new G('Missing required parameter: "text"');let o="/avatars/qr",s={};typeof e<"u"&&(s.text=e),typeof n<"u"&&(s.size=n),typeof r<"u"&&(s.margin=r),typeof i<"u"&&(s.download=i);const a=new URL(this.client.config.endpoint+o);s.project=this.client.config.project;for(const[u,h]of Object.entries(xe.flatten(s)))a.searchParams.append(u,h);return a}}class Gs extends xe{constructor(e){super(e)}listDocuments(e,n,r){return oe(this,void 0,void 0,function*(){if(typeof e>"u")throw new G('Missing required parameter: "databaseId"');if(typeof n>"u")throw new G('Missing required parameter: "collectionId"');let i="/databases/{databaseId}/collections/{collectionId}/documents".replace("{databaseId}",e).replace("{collectionId}",n),o={};typeof r<"u"&&(o.queries=r);const s=new URL(this.client.config.endpoint+i);return yield this.client.call("get",s,{"content-type":"application/json"},o)})}createDocument(e,n,r,i,o){return oe(this,void 0,void 0,function*(){if(typeof e>"u")throw new G('Missing required parameter: "databaseId"');if(typeof n>"u")throw new G('Missing required parameter: "collectionId"');if(typeof r>"u")throw new G('Missing required parameter: "documentId"');if(typeof i>"u")throw new G('Missing required parameter: "data"');let s="/databases/{databaseId}/collections/{collectionId}/documents".replace("{databaseId}",e).replace("{collectionId}",n),a={};typeof r<"u"&&(a.documentId=r),typeof i<"u"&&(a.data=i),typeof o<"u"&&(a.permissions=o);const u=new URL(this.client.config.endpoint+s);return yield this.client.call("post",u,{"content-type":"application/json"},a)})}getDocument(e,n,r,i){return oe(this,void 0,void 0,function*(){if(typeof e>"u")throw new G('Missing required parameter: "databaseId"');if(typeof n>"u")throw new G('Missing required parameter: "collectionId"');if(typeof r>"u")throw new G('Missing required parameter: "documentId"');let o="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}".replace("{databaseId}",e).replace("{collectionId}",n).replace("{documentId}",r),s={};typeof i<"u"&&(s.queries=i);const a=new URL(this.client.config.endpoint+o);return yield this.client.call("get",a,{"content-type":"application/json"},s)})}updateDocument(e,n,r,i,o){return oe(this,void 0,void 0,function*(){if(typeof e>"u")throw new G('Missing required parameter: "databaseId"');if(typeof n>"u")throw new G('Missing required parameter: "collectionId"');if(typeof r>"u")throw new G('Missing required parameter: "documentId"');let s="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}".replace("{databaseId}",e).replace("{collectionId}",n).replace("{documentId}",r),a={};typeof i<"u"&&(a.data=i),typeof o<"u"&&(a.permissions=o);const u=new URL(this.client.config.endpoint+s);return yield this.client.call("patch",u,{"content-type":"application/json"},a)})}deleteDocument(e,n,r){return oe(this,void 0,void 0,function*(){if(typeof e>"u")throw new G('Missing required parameter: "databaseId"');if(typeof n>"u")throw new G('Missing required parameter: "collectionId"');if(typeof r>"u")throw new G('Missing required parameter: "documentId"');let i="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}".replace("{databaseId}",e).replace("{collectionId}",n).replace("{documentId}",r),o={};const s=new URL(this.client.config.endpoint+i);return yield this.client.call("delete",s,{"content-type":"application/json"},o)})}}class Js{static custom(e){return e}static unique(){return"unique()"}}const Hs={}.VITE_PROJECT_ID,Ys="https://cloud.appwrite.io/v1";let An;const kr=()=>(An||(An=new Qs().setEndpoint(Ys).setProject(Hs)),An);let On;const Xs=()=>(On||(On=new Ws(kr())),On);let En;const Zs=()=>(En||(En=new zs(kr())),En);let xn;const Vs=()=>(xn||(xn=new Gs(kr())),xn),Gt={}.VITE_DICTIONARY_DB_ID,Jt={}.VITE_WORDS_COLLECTION_ID;class ea{constructor(){_e(this,"appwriteDatabasesClient");_e(this,"getAll",async()=>{const e=await this.listDocuments();return{documents:e.documents.map(this.wordFrom),total:e.total}});_e(this,"add",async e=>{const n=await this.appwriteDatabasesClient.createDocument(Gt,Jt,Js.unique(),e);return this.wordFrom(n)});_e(this,"edit",async e=>{if(!e.appwriteId)throw new Error("Can	 edit word in appwrite");const n=await this.appwriteDatabasesClient.updateDocument(Gt,Jt,e.appwriteId,e);return this.wordFrom(n)});_e(this,"delete",async e=>{const n=await this.findByKey(e);if(!n)throw new Error("Can't find document with key: "+e);return this.appwriteDatabasesClient.deleteDocument(Gt,Jt,n==null?void 0:n.$id),e});this.appwriteDatabasesClient=Vs()}wordFrom(e){const{$databaseId:n,$permissions:r,$collectionId:i,$createdAt:o,$updatedAt:s,$id:a,...u}=e;return{appwriteId:u.appwriteId||a,...u}}listDocuments(){return this.appwriteDatabasesClient.listDocuments(Gt,Jt)}async findByKey(e){return(await this.listDocuments()).documents.find(({key:r})=>r===e)}}const ta={},na=Object.freeze(Object.defineProperty({__proto__:null,default:ta},Symbol.toStringTag,{value:"Module"})),ra=Us(na);var Ar={};Ar.test=function(){return typeof window.queueMicrotask=="function"};Ar.install=function(t){return function(){window.queueMicrotask(t)}};var Or={},oo=window.MutationObserver||window.WebKitMutationObserver;Or.test=function(){return oo};Or.install=function(t){var e=0,n=new oo(t),r=window.document.createTextNode("");return n.observe(r,{characterData:!0}),function(){r.data=e=++e%2}};var Er={};Er.test=function(){return window.setImmediate?!1:typeof window.MessageChannel<"u"};Er.install=function(t){var e=new window.MessageChannel;return e.port1.onmessage=t,function(){e.port2.postMessage(0)}};var xr={};xr.test=function(){return"document"in window&&"onreadystatechange"in window.document.createElement("script")};xr.install=function(t){return function(){var e=window.document.createElement("script");return e.onreadystatechange=function(){t(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},window.document.documentElement.appendChild(e),t}};var Cr={};Cr.test=function(){return!0};Cr.install=function(t){return function(){setTimeout(t,0)}};var It=[ra,Ar,Or,Er,xr,Cr],gt,et,Tt=-1,Ge=[],Wn=!1;function ia(){!gt||!et||(gt=!1,et.length?Ge=et.concat(Ge):Tt=-1,Ge.length&&so())}function so(){if(!gt){Wn=!1,gt=!0;for(var t=Ge.length,e=setTimeout(ia);t;){for(et=Ge,Ge=[];et&&++Tt<t;)et[Tt].run();Tt=-1,t=Ge.length}et=null,Tt=-1,gt=!1,clearTimeout(e)}}var ao,Ot=-1,oa=It.length;for(;++Ot<oa;)if(It[Ot]&&It[Ot].test&&It[Ot].test()){ao=It[Ot].install(so);break}function uo(t,e){this.fun=t,this.array=e}uo.prototype.run=function(){var t=this.fun,e=this.array;switch(e.length){case 0:return t();case 1:return t(e[0]);case 2:return t(e[0],e[1]);case 3:return t(e[0],e[1],e[2]);default:return t.apply(null,e)}};var Oe=sa;function sa(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];Ge.push(new uo(t,e)),!Wn&&!gt&&(Wn=!0,ao())}var zn={},aa={get exports(){return zn},set exports(t){zn=t}};(function(t,e){(function(n){t.exports=n()})(function(n){var r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function i(m,g){var f=m[0],d=m[1],p=m[2],_=m[3];f+=(d&p|~d&_)+g[0]-680876936|0,f=(f<<7|f>>>25)+d|0,_+=(f&d|~f&p)+g[1]-389564586|0,_=(_<<12|_>>>20)+f|0,p+=(_&f|~_&d)+g[2]+606105819|0,p=(p<<17|p>>>15)+_|0,d+=(p&_|~p&f)+g[3]-1044525330|0,d=(d<<22|d>>>10)+p|0,f+=(d&p|~d&_)+g[4]-176418897|0,f=(f<<7|f>>>25)+d|0,_+=(f&d|~f&p)+g[5]+1200080426|0,_=(_<<12|_>>>20)+f|0,p+=(_&f|~_&d)+g[6]-1473231341|0,p=(p<<17|p>>>15)+_|0,d+=(p&_|~p&f)+g[7]-45705983|0,d=(d<<22|d>>>10)+p|0,f+=(d&p|~d&_)+g[8]+1770035416|0,f=(f<<7|f>>>25)+d|0,_+=(f&d|~f&p)+g[9]-1958414417|0,_=(_<<12|_>>>20)+f|0,p+=(_&f|~_&d)+g[10]-42063|0,p=(p<<17|p>>>15)+_|0,d+=(p&_|~p&f)+g[11]-1990404162|0,d=(d<<22|d>>>10)+p|0,f+=(d&p|~d&_)+g[12]+1804603682|0,f=(f<<7|f>>>25)+d|0,_+=(f&d|~f&p)+g[13]-40341101|0,_=(_<<12|_>>>20)+f|0,p+=(_&f|~_&d)+g[14]-1502002290|0,p=(p<<17|p>>>15)+_|0,d+=(p&_|~p&f)+g[15]+1236535329|0,d=(d<<22|d>>>10)+p|0,f+=(d&_|p&~_)+g[1]-165796510|0,f=(f<<5|f>>>27)+d|0,_+=(f&p|d&~p)+g[6]-1069501632|0,_=(_<<9|_>>>23)+f|0,p+=(_&d|f&~d)+g[11]+643717713|0,p=(p<<14|p>>>18)+_|0,d+=(p&f|_&~f)+g[0]-373897302|0,d=(d<<20|d>>>12)+p|0,f+=(d&_|p&~_)+g[5]-701558691|0,f=(f<<5|f>>>27)+d|0,_+=(f&p|d&~p)+g[10]+38016083|0,_=(_<<9|_>>>23)+f|0,p+=(_&d|f&~d)+g[15]-660478335|0,p=(p<<14|p>>>18)+_|0,d+=(p&f|_&~f)+g[4]-405537848|0,d=(d<<20|d>>>12)+p|0,f+=(d&_|p&~_)+g[9]+568446438|0,f=(f<<5|f>>>27)+d|0,_+=(f&p|d&~p)+g[14]-1019803690|0,_=(_<<9|_>>>23)+f|0,p+=(_&d|f&~d)+g[3]-187363961|0,p=(p<<14|p>>>18)+_|0,d+=(p&f|_&~f)+g[8]+1163531501|0,d=(d<<20|d>>>12)+p|0,f+=(d&_|p&~_)+g[13]-1444681467|0,f=(f<<5|f>>>27)+d|0,_+=(f&p|d&~p)+g[2]-51403784|0,_=(_<<9|_>>>23)+f|0,p+=(_&d|f&~d)+g[7]+1735328473|0,p=(p<<14|p>>>18)+_|0,d+=(p&f|_&~f)+g[12]-1926607734|0,d=(d<<20|d>>>12)+p|0,f+=(d^p^_)+g[5]-378558|0,f=(f<<4|f>>>28)+d|0,_+=(f^d^p)+g[8]-2022574463|0,_=(_<<11|_>>>21)+f|0,p+=(_^f^d)+g[11]+1839030562|0,p=(p<<16|p>>>16)+_|0,d+=(p^_^f)+g[14]-35309556|0,d=(d<<23|d>>>9)+p|0,f+=(d^p^_)+g[1]-1530992060|0,f=(f<<4|f>>>28)+d|0,_+=(f^d^p)+g[4]+1272893353|0,_=(_<<11|_>>>21)+f|0,p+=(_^f^d)+g[7]-155497632|0,p=(p<<16|p>>>16)+_|0,d+=(p^_^f)+g[10]-1094730640|0,d=(d<<23|d>>>9)+p|0,f+=(d^p^_)+g[13]+681279174|0,f=(f<<4|f>>>28)+d|0,_+=(f^d^p)+g[0]-358537222|0,_=(_<<11|_>>>21)+f|0,p+=(_^f^d)+g[3]-722521979|0,p=(p<<16|p>>>16)+_|0,d+=(p^_^f)+g[6]+76029189|0,d=(d<<23|d>>>9)+p|0,f+=(d^p^_)+g[9]-640364487|0,f=(f<<4|f>>>28)+d|0,_+=(f^d^p)+g[12]-421815835|0,_=(_<<11|_>>>21)+f|0,p+=(_^f^d)+g[15]+530742520|0,p=(p<<16|p>>>16)+_|0,d+=(p^_^f)+g[2]-995338651|0,d=(d<<23|d>>>9)+p|0,f+=(p^(d|~_))+g[0]-198630844|0,f=(f<<6|f>>>26)+d|0,_+=(d^(f|~p))+g[7]+1126891415|0,_=(_<<10|_>>>22)+f|0,p+=(f^(_|~d))+g[14]-1416354905|0,p=(p<<15|p>>>17)+_|0,d+=(_^(p|~f))+g[5]-57434055|0,d=(d<<21|d>>>11)+p|0,f+=(p^(d|~_))+g[12]+1700485571|0,f=(f<<6|f>>>26)+d|0,_+=(d^(f|~p))+g[3]-1894986606|0,_=(_<<10|_>>>22)+f|0,p+=(f^(_|~d))+g[10]-1051523|0,p=(p<<15|p>>>17)+_|0,d+=(_^(p|~f))+g[1]-2054922799|0,d=(d<<21|d>>>11)+p|0,f+=(p^(d|~_))+g[8]+1873313359|0,f=(f<<6|f>>>26)+d|0,_+=(d^(f|~p))+g[15]-30611744|0,_=(_<<10|_>>>22)+f|0,p+=(f^(_|~d))+g[6]-1560198380|0,p=(p<<15|p>>>17)+_|0,d+=(_^(p|~f))+g[13]+1309151649|0,d=(d<<21|d>>>11)+p|0,f+=(p^(d|~_))+g[4]-145523070|0,f=(f<<6|f>>>26)+d|0,_+=(d^(f|~p))+g[11]-1120210379|0,_=(_<<10|_>>>22)+f|0,p+=(f^(_|~d))+g[2]+718787259|0,p=(p<<15|p>>>17)+_|0,d+=(_^(p|~f))+g[9]-343485551|0,d=(d<<21|d>>>11)+p|0,m[0]=f+m[0]|0,m[1]=d+m[1]|0,m[2]=p+m[2]|0,m[3]=_+m[3]|0}function o(m){var g=[],f;for(f=0;f<64;f+=4)g[f>>2]=m.charCodeAt(f)+(m.charCodeAt(f+1)<<8)+(m.charCodeAt(f+2)<<16)+(m.charCodeAt(f+3)<<24);return g}function s(m){var g=[],f;for(f=0;f<64;f+=4)g[f>>2]=m[f]+(m[f+1]<<8)+(m[f+2]<<16)+(m[f+3]<<24);return g}function a(m){var g=m.length,f=[1732584193,-271733879,-1732584194,271733878],d,p,_,P,M,D;for(d=64;d<=g;d+=64)i(f,o(m.substring(d-64,d)));for(m=m.substring(d-64),p=m.length,_=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],d=0;d<p;d+=1)_[d>>2]|=m.charCodeAt(d)<<(d%4<<3);if(_[d>>2]|=128<<(d%4<<3),d>55)for(i(f,_),d=0;d<16;d+=1)_[d]=0;return P=g*8,P=P.toString(16).match(/(.*?)(.{0,8})$/),M=parseInt(P[2],16),D=parseInt(P[1],16)||0,_[14]=M,_[15]=D,i(f,_),f}function u(m){var g=m.length,f=[1732584193,-271733879,-1732584194,271733878],d,p,_,P,M,D;for(d=64;d<=g;d+=64)i(f,s(m.subarray(d-64,d)));for(m=d-64<g?m.subarray(d-64):new Uint8Array(0),p=m.length,_=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],d=0;d<p;d+=1)_[d>>2]|=m[d]<<(d%4<<3);if(_[d>>2]|=128<<(d%4<<3),d>55)for(i(f,_),d=0;d<16;d+=1)_[d]=0;return P=g*8,P=P.toString(16).match(/(.*?)(.{0,8})$/),M=parseInt(P[2],16),D=parseInt(P[1],16)||0,_[14]=M,_[15]=D,i(f,_),f}function h(m){var g="",f;for(f=0;f<4;f+=1)g+=r[m>>f*8+4&15]+r[m>>f*8&15];return g}function y(m){var g;for(g=0;g<m.length;g+=1)m[g]=h(m[g]);return m.join("")}y(a("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function m(g,f){return g=g|0||0,g<0?Math.max(g+f,0):Math.min(g,f)}ArrayBuffer.prototype.slice=function(g,f){var d=this.byteLength,p=m(g,d),_=d,P,M,D,U;return f!==n&&(_=m(f,d)),p>_?new ArrayBuffer(0):(P=_-p,M=new ArrayBuffer(P),D=new Uint8Array(M),U=new Uint8Array(this,p,P),D.set(U),M)}}();function c(m){return/[\u0080-\uFFFF]/.test(m)&&(m=unescape(encodeURIComponent(m))),m}function w(m,g){var f=m.length,d=new ArrayBuffer(f),p=new Uint8Array(d),_;for(_=0;_<f;_+=1)p[_]=m.charCodeAt(_);return g?p:d}function $(m){return String.fromCharCode.apply(null,new Uint8Array(m))}function O(m,g,f){var d=new Uint8Array(m.byteLength+g.byteLength);return d.set(new Uint8Array(m)),d.set(new Uint8Array(g),m.byteLength),f?d:d.buffer}function T(m){var g=[],f=m.length,d;for(d=0;d<f-1;d+=2)g.push(parseInt(m.substr(d,2),16));return String.fromCharCode.apply(String,g)}function k(){this.reset()}return k.prototype.append=function(m){return this.appendBinary(c(m)),this},k.prototype.appendBinary=function(m){this._buff+=m,this._length+=m.length;var g=this._buff.length,f;for(f=64;f<=g;f+=64)i(this._hash,o(this._buff.substring(f-64,f)));return this._buff=this._buff.substring(f-64),this},k.prototype.end=function(m){var g=this._buff,f=g.length,d,p=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],_;for(d=0;d<f;d+=1)p[d>>2]|=g.charCodeAt(d)<<(d%4<<3);return this._finish(p,f),_=y(this._hash),m&&(_=T(_)),this.reset(),_},k.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},k.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},k.prototype.setState=function(m){return this._buff=m.buff,this._length=m.length,this._hash=m.hash,this},k.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},k.prototype._finish=function(m,g){var f=g,d,p,_;if(m[f>>2]|=128<<(f%4<<3),f>55)for(i(this._hash,m),f=0;f<16;f+=1)m[f]=0;d=this._length*8,d=d.toString(16).match(/(.*?)(.{0,8})$/),p=parseInt(d[2],16),_=parseInt(d[1],16)||0,m[14]=p,m[15]=_,i(this._hash,m)},k.hash=function(m,g){return k.hashBinary(c(m),g)},k.hashBinary=function(m,g){var f=a(m),d=y(f);return g?T(d):d},k.ArrayBuffer=function(){this.reset()},k.ArrayBuffer.prototype.append=function(m){var g=O(this._buff.buffer,m,!0),f=g.length,d;for(this._length+=m.byteLength,d=64;d<=f;d+=64)i(this._hash,s(g.subarray(d-64,d)));return this._buff=d-64<f?new Uint8Array(g.buffer.slice(d-64)):new Uint8Array(0),this},k.ArrayBuffer.prototype.end=function(m){var g=this._buff,f=g.length,d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],p,_;for(p=0;p<f;p+=1)d[p>>2]|=g[p]<<(p%4<<3);return this._finish(d,f),_=y(this._hash),m&&(_=T(_)),this.reset(),_},k.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},k.ArrayBuffer.prototype.getState=function(){var m=k.prototype.getState.call(this);return m.buff=$(m.buff),m},k.ArrayBuffer.prototype.setState=function(m){return m.buff=w(m.buff,!0),k.prototype.setState.call(this,m)},k.ArrayBuffer.prototype.destroy=k.prototype.destroy,k.ArrayBuffer.prototype._finish=k.prototype._finish,k.ArrayBuffer.hash=function(m,g){var f=u(new Uint8Array(m)),d=y(f);return g?T(d):d},k})})(aa);const on=zn;var Ht,ua=new Uint8Array(16);function ca(){if(!Ht&&(Ht=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Ht))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ht(ua)}const fa=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function la(t){return typeof t=="string"&&fa.test(t)}var we=[];for(var Cn=0;Cn<256;++Cn)we.push((Cn+256).toString(16).substr(1));function da(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=(we[t[e+0]]+we[t[e+1]]+we[t[e+2]]+we[t[e+3]]+"-"+we[t[e+4]]+we[t[e+5]]+"-"+we[t[e+6]]+we[t[e+7]]+"-"+we[t[e+8]]+we[t[e+9]]+"-"+we[t[e+10]]+we[t[e+11]]+we[t[e+12]]+we[t[e+13]]+we[t[e+14]]+we[t[e+15]]).toLowerCase();if(!la(n))throw TypeError("Stringified UUID is invalid");return n}function Ir(t,e,n){t=t||{};var r=t.random||(t.rng||ca)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){n=n||0;for(var i=0;i<16;++i)e[n+i]=r[i];return e}return da(r)}var yn={};yn.stringify=function(e){var n=[];n.push({obj:e});for(var r="",i,o,s,a,u,h,y,c,w,$,O;i=n.pop();)if(o=i.obj,s=i.prefix||"",a=i.val||"",r+=s,a)r+=a;else if(typeof o!="object")r+=typeof o>"u"?null:JSON.stringify(o);else if(o===null)r+="null";else if(Array.isArray(o)){for(n.push({val:"]"}),u=o.length-1;u>=0;u--)h=u===0?"":",",n.push({obj:o[u],prefix:h});n.push({val:"["})}else{y=[];for(c in o)o.hasOwnProperty(c)&&y.push(c);for(n.push({val:"}"}),u=y.length-1;u>=0;u--)w=y[u],$=o[w],O=u>0?",":"",O+=JSON.stringify(w)+":",n.push({obj:$,prefix:O});n.push({val:"{"})}return r};function vt(t,e,n){var r=n[n.length-1];t===r.element&&(n.pop(),r=n[n.length-1]);var i=r.element,o=r.index;if(Array.isArray(i))i.push(t);else if(o===e.length-2){var s=e.pop();i[s]=t}else e.push(t)}yn.parse=function(t){for(var e=[],n=[],r=0,i,o,s,a,u,h,y,c,w;;){if(i=t[r++],i==="}"||i==="]"||typeof i>"u"){if(e.length===1)return e.pop();vt(e.pop(),e,n);continue}switch(i){case" ":case"	":case`
`:case":":case",":break;case"n":r+=3,vt(null,e,n);break;case"t":r+=3,vt(!0,e,n);break;case"f":r+=4,vt(!1,e,n);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(o="",r--;;)if(s=t[r++],/[\d\.\-e\+]/.test(s))o+=s;else{r--;break}vt(parseFloat(o),e,n);break;case'"':for(a="",u=void 0,h=0;y=t[r++],y!=='"'||u==="\\"&&h%2===1;)a+=y,u=y,u==="\\"?h++:h=0;vt(JSON.parse('"'+a+'"'),e,n);break;case"[":c={element:[],index:e.length},e.push(c.element),n.push(c);break;case"{":w={element:{},index:e.length},e.push(w.element),n.push(w);break;default:throw new Error("unexpectedly reached end of input: "+i)}}};var je={},ha={get exports(){return je},set exports(t){je=t}},mt=typeof Reflect=="object"?Reflect:null,ii=mt&&typeof mt.apply=="function"?mt.apply:function(e,n,r){return Function.prototype.apply.call(e,n,r)},Zt;mt&&typeof mt.ownKeys=="function"?Zt=mt.ownKeys:Object.getOwnPropertySymbols?Zt=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Zt=function(e){return Object.getOwnPropertyNames(e)};function va(t){console&&console.warn&&console.warn(t)}var co=Number.isNaN||function(e){return e!==e};function se(){se.init.call(this)}ha.exports=se;je.once=ma;se.EventEmitter=se;se.prototype._events=void 0;se.prototype._eventsCount=0;se.prototype._maxListeners=void 0;var oi=10;function gn(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(se,"defaultMaxListeners",{enumerable:!0,get:function(){return oi},set:function(t){if(typeof t!="number"||t<0||co(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");oi=t}});se.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};se.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||co(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function fo(t){return t._maxListeners===void 0?se.defaultMaxListeners:t._maxListeners}se.prototype.getMaxListeners=function(){return fo(this)};se.prototype.emit=function(e){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=e==="error",o=this._events;if(o!==void 0)i=i&&o.error===void 0;else if(!i)return!1;if(i){var s;if(n.length>0&&(s=n[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var u=o[e];if(u===void 0)return!1;if(typeof u=="function")ii(u,this,n);else for(var h=u.length,y=yo(u,h),r=0;r<h;++r)ii(y[r],this,n);return!0};function lo(t,e,n,r){var i,o,s;if(gn(n),o=t._events,o===void 0?(o=t._events=Object.create(null),t._eventsCount=0):(o.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),s=o[e]),s===void 0)s=o[e]=n,++t._eventsCount;else if(typeof s=="function"?s=o[e]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),i=fo(t),i>0&&s.length>i&&!s.warned){s.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=s.length,va(a)}return t}se.prototype.addListener=function(e,n){return lo(this,e,n,!1)};se.prototype.on=se.prototype.addListener;se.prototype.prependListener=function(e,n){return lo(this,e,n,!0)};function pa(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function ho(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=pa.bind(r);return i.listener=n,r.wrapFn=i,i}se.prototype.once=function(e,n){return gn(n),this.on(e,ho(this,e,n)),this};se.prototype.prependOnceListener=function(e,n){return gn(n),this.prependListener(e,ho(this,e,n)),this};se.prototype.removeListener=function(e,n){var r,i,o,s,a;if(gn(n),i=this._events,i===void 0)return this;if(r=i[e],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||n));else if(typeof r!="function"){for(o=-1,s=r.length-1;s>=0;s--)if(r[s]===n||r[s].listener===n){a=r[s].listener,o=s;break}if(o<0)return this;o===0?r.shift():ya(r,o),r.length===1&&(i[e]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||n)}return this};se.prototype.off=se.prototype.removeListener;se.prototype.removeAllListeners=function(e){var n,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var o=Object.keys(r),s;for(i=0;i<o.length;++i)s=o[i],s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(i=n.length-1;i>=0;i--)this.removeListener(e,n[i]);return this};function vo(t,e,n){var r=t._events;if(r===void 0)return[];var i=r[e];return i===void 0?[]:typeof i=="function"?n?[i.listener||i]:[i]:n?ga(i):yo(i,i.length)}se.prototype.listeners=function(e){return vo(this,e,!0)};se.prototype.rawListeners=function(e){return vo(this,e,!1)};se.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):po.call(t,e)};se.prototype.listenerCount=po;function po(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}se.prototype.eventNames=function(){return this._eventsCount>0?Zt(this._events):[]};function yo(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function ya(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function ga(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function ma(t,e){return new Promise(function(n,r){function i(s){t.removeListener(e,o),r(s)}function o(){typeof t.removeListener=="function"&&t.removeListener("error",i),n([].slice.call(arguments))}go(t,e,o,{once:!0}),e!=="error"&&_a(t,i,{once:!0})})}function _a(t,e,n){typeof t.on=="function"&&go(t,"error",e,n)}function go(t,e,n,r){if(typeof t.on=="function")r.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function i(o){r.once&&t.removeEventListener(e,i),n(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}function mn(t){return"$"+t}function mo(t){return t.substring(1)}function We(){this._store={}}We.prototype.get=function(t){var e=mn(t);return this._store[e]};We.prototype.set=function(t,e){var n=mn(t);return this._store[n]=e,!0};We.prototype.has=function(t){var e=mn(t);return e in this._store};We.prototype.keys=function(){return Object.keys(this._store).map(t=>mo(t))};We.prototype.delete=function(t){var e=mn(t),n=e in this._store;return delete this._store[e],n};We.prototype.forEach=function(t){for(var e=Object.keys(this._store),n=0,r=e.length;n<r;n++){var i=e[n],o=this._store[i];i=mo(i),t(o,i)}};Object.defineProperty(We.prototype,"size",{get:function(){return Object.keys(this._store).length}});function Mt(t){if(this._store=new We,t&&Array.isArray(t))for(var e=0,n=t.length;e<n;e++)this.add(t[e])}Mt.prototype.add=function(t){return this._store.set(t,!0)};Mt.prototype.has=function(t){return this._store.has(t)};Mt.prototype.forEach=function(t){this._store.forEach(function(e,n){t(n)})};Object.defineProperty(Mt.prototype,"size",{get:function(){return this._store.size}});function wa(){if(typeof Symbol>"u"||typeof Map>"u"||typeof Set>"u")return!1;var t=Object.getOwnPropertyDescriptor(Map,Symbol.species);return t&&"get"in t&&Map[Symbol.species]===Map}var $t,Ee;wa()?($t=Set,Ee=Map):($t=Mt,Ee=We);function ba(t){return typeof ArrayBuffer<"u"&&t instanceof ArrayBuffer||typeof Blob<"u"&&t instanceof Blob}function $a(t){if(typeof t.slice=="function")return t.slice(0);var e=new ArrayBuffer(t.byteLength),n=new Uint8Array(e),r=new Uint8Array(t);return n.set(r),e}function Sa(t){if(t instanceof ArrayBuffer)return $a(t);var e=t.size,n=t.type;return typeof t.slice=="function"?t.slice(0,e,n):t.webkitSlice(0,e,n)}var _o=Function.prototype.toString,ka=_o.call(Object);function Aa(t){var e=Object.getPrototypeOf(t);if(e===null)return!0;var n=e.constructor;return typeof n=="function"&&n instanceof n&&_o.call(n)==ka}function me(t){var e,n,r;if(!t||typeof t!="object")return t;if(Array.isArray(t)){for(e=[],n=0,r=t.length;n<r;n++)e[n]=me(t[n]);return e}if(t instanceof Date&&isFinite(t))return t.toISOString();if(ba(t))return Sa(t);if(!Aa(t))return t;e={};for(n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var i=me(t[n]);typeof i<"u"&&(e[n]=i)}return e}function wo(t){var e=!1;return function(...n){if(e)throw new Error("once called more than once");e=!0,t.apply(this,n)}}function bo(t){return function(...e){e=me(e);var n=this,r=typeof e[e.length-1]=="function"?e.pop():!1,i=new Promise(function(o,s){var a;try{var u=wo(function(h,y){h?s(h):o(y)});e.push(u),a=t.apply(n,e),a&&typeof a.then=="function"&&o(a)}catch(h){s(h)}});return r&&i.then(function(o){r(null,o)},r),i}}function Oa(t,e,n){if(t.constructor.listeners("debug").length){for(var r=["api",t.name,e],i=0;i<n.length-1;i++)r.push(n[i]);t.constructor.emit("debug",r);var o=n[n.length-1];n[n.length-1]=function(s,a){var u=["api",t.name,e];u=u.concat(s?["error",s]:["success",a]),t.constructor.emit("debug",u),o(s,a)}}}function le(t,e){return bo(function(...n){if(this._closed)return Promise.reject(new Error("database is closed"));if(this._destroyed)return Promise.reject(new Error("database is destroyed"));var r=this;return Oa(r,t,n),this.taskqueue.isReady?e.apply(this,n):new Promise(function(i,o){r.taskqueue.addTask(function(s){s?o(s):i(r[t].apply(r,n))})})})}function Nt(t,e){for(var n={},r=0,i=e.length;r<i;r++){var o=e[r];o in t&&(n[o]=t[o])}return n}var Ea=6;function si(t){return t}function xa(t){return[{ok:t}]}function $o(t,e,n){var r=e.docs,i=new Ee;r.forEach(function(T){i.has(T.id)?i.get(T.id).push(T):i.set(T.id,[T])});var o=i.size,s=0,a=new Array(o);function u(){var T=[];a.forEach(function(k){k.docs.forEach(function(m){T.push({id:k.id,docs:[m]})})}),n(null,{results:T})}function h(){++s===o&&u()}function y(T,k,m){a[T]={id:k,docs:m},h()}var c=[];i.forEach(function(T,k){c.push(k)});var w=0;function $(){if(!(w>=c.length)){var T=Math.min(w+Ea,c.length),k=c.slice(w,T);O(k,w),w+=k.length}}function O(T,k){T.forEach(function(m,g){var f=k+g,d=i.get(m),p=Nt(d[0],["atts_since","attachments"]);p.open_revs=d.map(function(P){return P.rev}),p.open_revs=p.open_revs.filter(si);var _=si;p.open_revs.length===0&&(delete p.open_revs,_=xa),["revs","attachments","binary","ajax","latest"].forEach(function(P){P in e&&(p[P]=e[P])}),t.get(m,p,function(P,M){var D;P?D=[{error:P}]:D=_(M),y(f,m,D),$()})})}$()}var Gn;try{localStorage.setItem("_pouch_check_localstorage",1),Gn=!!localStorage.getItem("_pouch_check_localstorage")}catch{Gn=!1}function sn(){return Gn}class Ca extends je{constructor(){super(),this._listeners={},sn()&&addEventListener("storage",e=>{this.emit(e.key)})}addListener(e,n,r,i){if(this._listeners[n])return;var o=!1,s=this;function a(){if(!s._listeners[n])return;if(o){o="waiting";return}o=!0;var u=Nt(i,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]);function h(){o=!1}r.changes(u).on("change",function(y){y.seq>i.since&&!i.cancelled&&(i.since=y.seq,i.onChange(y))}).on("complete",function(){o==="waiting"&&Oe(a),o=!1}).on("error",h)}this._listeners[n]=a,this.on(e,a)}removeListener(e,n){n in this._listeners&&(super.removeListener(e,this._listeners[n]),delete this._listeners[n])}notifyLocalWindows(e){sn()&&(localStorage[e]=localStorage[e]==="a"?"b":"a")}notify(e){this.emit(e),this.notifyLocalWindows(e)}}function De(t){if(typeof console<"u"&&typeof console[t]=="function"){var e=Array.prototype.slice.call(arguments,1);console[t].apply(console,e)}}function Ia(t,e){var n=6e5;t=parseInt(t,10)||0,e=parseInt(e,10),e!==e||e<=t?e=(t||1)<<1:e=e+1,e>n&&(t=n>>1,e=n);var r=Math.random(),i=e-t;return~~(i*r+t)}function Ta(t){var e=0;return t||(e=2e3),Ia(t,e)}function Jn(t,e){De("info","The above "+t+" is totally normal. "+e)}var Hn;typeof Object.assign=="function"?Hn=Object.assign:Hn=function(t){for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(r!=null)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e};var st=Hn;let ue=class extends Error{constructor(e,n,r){super(),this.status=e,this.name=n,this.message=r,this.error=!0}toString(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})}};new ue(401,"unauthorized","Name or password is incorrect.");var qa=new ue(400,"bad_request","Missing JSON list of 'docs'"),Te=new ue(404,"not_found","missing"),St=new ue(409,"conflict","Document update conflict"),So=new ue(400,"bad_request","_id field must contain a string"),ja=new ue(412,"missing_id","_id is required for puts"),Da=new ue(400,"bad_request","Only reserved document ids may start with underscore.");new ue(412,"precondition_failed","Database not open");var Tr=new ue(500,"unknown_error","Database encountered an unknown error"),ko=new ue(500,"badarg","Some query argument is invalid");new ue(400,"invalid_request","Request was invalid");var Pa=new ue(400,"query_parse_error","Some query parameter is invalid"),ai=new ue(500,"doc_validation","Bad special document member"),_n=new ue(400,"bad_request","Something wrong with the request"),In=new ue(400,"bad_request","Document must be a JSON object");new ue(404,"not_found","Database not found");var qr=new ue(500,"indexed_db_went_bad","unknown");new ue(500,"web_sql_went_bad","unknown");new ue(500,"levelDB_went_went_bad","unknown");new ue(403,"forbidden","Forbidden by design doc validate_doc_update function");var Ao=new ue(400,"bad_request","Invalid rev format");new ue(412,"file_exists","The database could not be created, the file already exists.");var Ra=new ue(412,"missing_stub","A pre-existing attachment stub wasn't found");new ue(413,"invalid_url","Provided URL is invalid");function ne(t,e){function n(r){for(var i=Object.getOwnPropertyNames(t),o=0,s=i.length;o<s;o++)typeof t[i[o]]!="function"&&(this[i[o]]=t[i[o]]);this.stack===void 0&&(this.stack=new Error().stack),r!==void 0&&(this.reason=r)}return n.prototype=ue.prototype,new n(e)}function kt(t){if(typeof t!="object"){var e=t;t=Tr,t.data=e}return"error"in t&&t.error==="conflict"&&(t.name="conflict",t.status=409),"name"in t||(t.name=t.error||"unknown"),"status"in t||(t.status=500),"message"in t||(t.message=t.message||t.reason),"stack"in t||(t.stack=new Error().stack),t}function Ba(t,e,n){try{return!t(e,n)}catch(i){var r="Filter function threw: "+i.toString();return ne(_n,r)}}function jr(t){var e={},n=t.filter&&typeof t.filter=="function";return e.query=t.query_params,function(i){i.doc||(i.doc={});var o=n&&Ba(t.filter,i.doc,e);if(typeof o=="object")return o;if(o)return!1;if(!t.include_docs)delete i.doc;else if(!t.attachments)for(var s in i.doc._attachments)Object.prototype.hasOwnProperty.call(i.doc._attachments,s)&&(i.doc._attachments[s].stub=!0);return!0}}function an(t){for(var e=[],n=0,r=t.length;n<r;n++)e=e.concat(t[n]);return e}function Oo(t){var e;if(t?typeof t!="string"?e=ne(So):/^_/.test(t)&&!/^_(design|local)/.test(t)&&(e=ne(Da)):e=ne(ja),e)throw e}function Fe(t){return typeof t._remote=="boolean"?t._remote:typeof t.type=="function"?(De("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),t.type()==="http"):!1}function La(t,e){return"listenerCount"in t?t.listenerCount(e):je.listenerCount(t,e)}function Yn(t){if(!t)return null;var e=t.split("/");return e.length===2?e:e.length===1?[t,t]:null}function ui(t){var e=Yn(t);return e?e.join("/"):null}var ci=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],fi="queryKey",Ma=/(?:^|&)([^&=]*)=?([^&]*)/g,Na=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function Eo(t){for(var e=Na.exec(t),n={},r=14;r--;){var i=ci[r],o=e[r]||"",s=["user","password"].indexOf(i)!==-1;n[i]=s?decodeURIComponent(o):o}return n[fi]={},n[ci[12]].replace(Ma,function(a,u,h){u&&(n[fi][u]=h)}),n}function Dr(t,e){var n=[],r=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n.push(i),r.push(e[i]));return n.push(t),Function.apply(null,n).apply(null,r)}function un(t,e,n){return t.get(e).catch(function(r){if(r.status!==404)throw r;return{}}).then(function(r){var i=r._rev,o=n(r);return o?(o._id=e,o._rev=i,Ua(t,o,n)):{updated:!1,rev:i}})}function Ua(t,e,n){return t.put(e).then(function(r){return{updated:!0,rev:r.rev}},function(r){if(r.status!==409)throw r;return un(t,e._id,n)})}var Pr=function(t){return atob(t)},Ut=function(t){return btoa(t)};function Rr(t,e){t=t||[],e=e||{};try{return new Blob(t,e)}catch(o){if(o.name!=="TypeError")throw o;for(var n=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,r=new n,i=0;i<t.length;i+=1)r.append(t[i]);return r.getBlob(e.type)}}function Fa(t){for(var e=t.length,n=new ArrayBuffer(e),r=new Uint8Array(n),i=0;i<e;i++)r[i]=t.charCodeAt(i);return n}function Br(t,e){return Rr([Fa(t)],{type:e})}function Lr(t,e){return Br(Pr(t),e)}function Ka(t){for(var e="",n=new Uint8Array(t),r=n.byteLength,i=0;i<r;i++)e+=String.fromCharCode(n[i]);return e}function xo(t,e){var n=new FileReader,r=typeof n.readAsBinaryString=="function";n.onloadend=function(i){var o=i.target.result||"";if(r)return e(o);e(Ka(o))},r?n.readAsBinaryString(t):n.readAsArrayBuffer(t)}function Co(t,e){xo(t,function(n){e(n)})}function Mr(t,e){Co(t,function(n){e(Ut(n))})}function Qa(t,e){var n=new FileReader;n.onloadend=function(r){var i=r.target.result||new ArrayBuffer(0);e(i)},n.readAsArrayBuffer(t)}var Wa=self.setImmediate||self.setTimeout,za=32768;function Ga(t){return Ut(t)}function Ja(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.slice(e,n)}function Ha(t,e,n,r,i){(n>0||r<e.size)&&(e=Ja(e,n,r)),Qa(e,function(o){t.append(o),i()})}function Ya(t,e,n,r,i){(n>0||r<e.length)&&(e=e.substring(n,r)),t.appendBinary(e),i()}function Nr(t,e){var n=typeof t=="string",r=n?t.length:t.size,i=Math.min(za,r),o=Math.ceil(r/i),s=0,a=n?new on:new on.ArrayBuffer,u=n?Ya:Ha;function h(){Wa(c)}function y(){var w=a.end(!0),$=Ga(w);e($),a.destroy()}function c(){var w=s*i,$=w+i;s++,s<o?u(a,t,w,$,h):u(a,t,w,$,y)}c()}function Io(t){return on.hash(t)}function To(t,e){if(!e)return Ir().replace(/-/g,"").toLowerCase();var n=st({},t);return delete n._rev_tree,Io(JSON.stringify(n))}var wn=Ir;function at(t){for(var e,n,r,i=t.rev_tree.slice(),o;o=i.pop();){var s=o.ids,a=s[2],u=o.pos;if(a.length){for(var h=0,y=a.length;h<y;h++)i.push({pos:u+1,ids:a[h]});continue}var c=!!s[1].deleted,w=s[0];(!e||(r!==c?r:n!==u?n<u:e<w))&&(e=w,n=u,r=c)}return n+"-"+e}function ut(t,e){for(var n=t.slice(),r;r=n.pop();)for(var i=r.pos,o=r.ids,s=o[2],a=e(s.length===0,i,o[0],r.ctx,o[1]),u=0,h=s.length;u<h;u++)n.push({pos:i+1,ids:s[u],ctx:a})}function Xa(t,e){return t.pos-e.pos}function Ur(t){var e=[];ut(t,function(i,o,s,a,u){i&&e.push({rev:o+"-"+s,pos:o,opts:u})}),e.sort(Xa).reverse();for(var n=0,r=e.length;n<r;n++)delete e[n].pos;return e}function Fr(t){for(var e=at(t),n=Ur(t.rev_tree),r=[],i=0,o=n.length;i<o;i++){var s=n[i];s.rev!==e&&!s.opts.deleted&&r.push(s.rev)}return r}function Za(t){var e=[];return ut(t.rev_tree,function(n,r,i,o,s){s.status==="available"&&!n&&(e.push(r+"-"+i),s.status="missing")}),e}function Va(t,e){let n=[];const r=t.slice();let i;for(;i=r.pop();){const{pos:o,ids:s}=i,a=`${o}-${s[0]}`,u=s[2];if(n.push(a),a===e){if(u.length!==0)throw new Error("The requested revision is not a leaf");return n.reverse()}(u.length===0||u.length>1)&&(n=[]);for(let h=0,y=u.length;h<y;h++)r.push({pos:o+1,ids:u[h]})}if(n.length===0)throw new Error("The requested revision does not exist");return n.reverse()}function qo(t){for(var e=[],n=t.slice(),r;r=n.pop();){var i=r.pos,o=r.ids,s=o[0],a=o[1],u=o[2],h=u.length===0,y=r.history?r.history.slice():[];y.push({id:s,opts:a}),h&&e.push({pos:i+1-y.length,ids:y});for(var c=0,w=u.length;c<w;c++)n.push({pos:i+1,ids:u[c],history:y})}return e.reverse()}function eu(t,e){return t.pos-e.pos}function tu(t,e,n){for(var r=0,i=t.length,o;r<i;)o=r+i>>>1,n(t[o],e)<0?r=o+1:i=o;return r}function nu(t,e,n){var r=tu(t,e,n);t.splice(r,0,e)}function li(t,e){for(var n,r,i=e,o=t.length;i<o;i++){var s=t[i],a=[s.id,s.opts,[]];r?(r[2].push(a),r=a):n=r=a}return n}function ru(t,e){return t[0]<e[0]?-1:1}function di(t,e){for(var n=[{tree1:t,tree2:e}],r=!1;n.length>0;){var i=n.pop(),o=i.tree1,s=i.tree2;(o[1].status||s[1].status)&&(o[1].status=o[1].status==="available"||s[1].status==="available"?"available":"missing");for(var a=0;a<s[2].length;a++){if(!o[2][0]){r="new_leaf",o[2][0]=s[2][a];continue}for(var u=!1,h=0;h<o[2].length;h++)o[2][h][0]===s[2][a][0]&&(n.push({tree1:o[2][h],tree2:s[2][a]}),u=!0);u||(r="new_branch",nu(o[2],s[2][a],ru))}}return{conflicts:r,tree:t}}function jo(t,e,n){var r=[],i=!1,o=!1,s;if(!t.length)return{tree:[e],conflicts:"new_leaf"};for(var a=0,u=t.length;a<u;a++){var h=t[a];if(h.pos===e.pos&&h.ids[0]===e.ids[0])s=di(h.ids,e.ids),r.push({pos:h.pos,ids:s.tree}),i=i||s.conflicts,o=!0;else if(n!==!0){var y=h.pos<e.pos?h:e,c=h.pos<e.pos?e:h,w=c.pos-y.pos,$=[],O=[];for(O.push({ids:y.ids,diff:w,parent:null,parentIdx:null});O.length>0;){var T=O.pop();if(T.diff===0){T.ids[0]===c.ids[0]&&$.push(T);continue}for(var k=T.ids[2],m=0,g=k.length;m<g;m++)O.push({ids:k[m],diff:T.diff-1,parent:T.ids,parentIdx:m})}var f=$[0];f?(s=di(f.ids,c.ids),f.parent[2][f.parentIdx]=s.tree,r.push({pos:y.pos,ids:y.ids}),i=i||s.conflicts,o=!0):r.push(h)}else r.push(h)}return o||r.push(e),r.sort(eu),{tree:r,conflicts:i||"internal_node"}}function iu(t,e){for(var n=qo(t),r,i,o=0,s=n.length;o<s;o++){var a=n[o],u=a.ids,h;if(u.length>e){r||(r={});var y=u.length-e;h={pos:a.pos+y,ids:li(u,y)};for(var c=0;c<y;c++){var w=a.pos+c+"-"+u[c].id;r[w]=!0}}else h={pos:a.pos,ids:li(u,0)};i?i=jo(i,h,!0).tree:i=[h]}return r&&ut(i,function($,O,T){delete r[O+"-"+T]}),{tree:i,revs:r?Object.keys(r):[]}}function Do(t,e,n){var r=jo(t,e),i=iu(r.tree,n);return{tree:i.tree,stemmedRevs:i.revs,conflicts:r.conflicts}}function ou(t,e){for(var n=t.slice(),r=e.split("-"),i=parseInt(r[0],10),o=r[1],s;s=n.pop();){if(s.pos===i&&s.ids[0]===o)return!0;for(var a=s.ids[2],u=0,h=a.length;u<h;u++)n.push({pos:s.pos+1,ids:a[u]})}return!1}function su(t){return t.ids}function Qe(t,e){e||(e=at(t));for(var n=e.substring(e.indexOf("-")+1),r=t.rev_tree.map(su),i;i=r.pop();){if(i[0]===n)return!!i[1].deleted;r=r.concat(i[2])}}function it(t){return/^_local/.test(t)}function au(t,e){for(var n=e.rev_tree.slice(),r;r=n.pop();){var i=r.pos,o=r.ids,s=o[0],a=o[1],u=o[2],h=u.length===0,y=r.history?r.history.slice():[];if(y.push({id:s,pos:i,opts:a}),h)for(var c=0,w=y.length;c<w;c++){var $=y[c],O=$.pos+"-"+$.id;if(O===t)return i+"-"+s}for(var T=0,k=u.length;T<k;T++)n.push({pos:i+1,ids:u[T],history:y})}throw new Error("Unable to resolve latest revision for id "+e.id+", rev "+t)}function uu(t,e,n,r){try{t.emit("change",e,n,r)}catch(i){De("error",'Error in .on("change", function):',i)}}function cu(t,e,n){var r=[{rev:t._rev}];n.style==="all_docs"&&(r=Ur(e.rev_tree).map(function(o){return{rev:o.rev}}));var i={id:e.id,changes:r,doc:t};return Qe(e,t._rev)&&(i.deleted=!0),n.conflicts&&(i.doc._conflicts=Fr(e),i.doc._conflicts.length||delete i.doc._conflicts),i}class fu extends je{constructor(e,n,r){super(),this.db=e,n=n?me(n):{};var i=n.complete=wo((a,u)=>{a?La(this,"error")>0&&this.emit("error",a):this.emit("complete",u),this.removeAllListeners(),e.removeListener("destroyed",o)});r&&(this.on("complete",function(a){r(null,a)}),this.on("error",r));const o=()=>{this.cancel()};e.once("destroyed",o),n.onChange=(a,u,h)=>{this.isCancelled||uu(this,a,u,h)};var s=new Promise(function(a,u){n.complete=function(h,y){h?u(h):a(y)}});this.once("cancel",function(){e.removeListener("destroyed",o),n.complete(null,{status:"cancelled"})}),this.then=s.then.bind(s),this.catch=s.catch.bind(s),this.then(function(a){i(null,a)},i),e.taskqueue.isReady?this.validateChanges(n):e.taskqueue.addTask(a=>{a?n.complete(a):this.isCancelled?this.emit("cancel"):this.validateChanges(n)})}cancel(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")}validateChanges(e){var n=e.complete;te._changesFilterPlugin?te._changesFilterPlugin.validate(e,r=>{if(r)return n(r);this.doChanges(e)}):this.doChanges(e)}doChanges(e){var n=e.complete;if(e=me(e),"live"in e&&!("continuous"in e)&&(e.continuous=e.live),e.processChange=cu,e.since==="latest"&&(e.since="now"),e.since||(e.since=0),e.since==="now"){this.db.info().then(i=>{if(this.isCancelled){n(null,{status:"cancelled"});return}e.since=i.update_seq,this.doChanges(e)},n);return}if(te._changesFilterPlugin){if(te._changesFilterPlugin.normalize(e),te._changesFilterPlugin.shouldFilter(this,e))return te._changesFilterPlugin.filter(this,e)}else["doc_ids","filter","selector","view"].forEach(function(i){i in e&&De("warn",'The "'+i+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')});"descending"in e||(e.descending=!1),e.limit=e.limit===0?1:e.limit,e.complete=n;var r=this.db._changes(e);if(r&&typeof r.cancel=="function"){const i=this.cancel;this.cancel=(...o)=>{r.cancel(),i.apply(this,o)}}}}function hi(t,e){return t<e?-1:t>e?1:0}function Tn(t,e){return function(n,r){n||r[0]&&r[0].error?(n=n||r[0],n.docId=e,t(n)):t(null,r.length?r[0]:r)}}function lu(t){for(var e=0;e<t.length;e++){var n=t[e];if(n._deleted)delete n._attachments;else if(n._attachments)for(var r=Object.keys(n._attachments),i=0;i<r.length;i++){var o=r[i];n._attachments[o]=Nt(n._attachments[o],["data","digest","content_type","length","revpos","stub"])}}}function du(t,e){var n=hi(t._id,e._id);if(n!==0)return n;var r=t._revisions?t._revisions.start:0,i=e._revisions?e._revisions.start:0;return hi(r,i)}function hu(t){var e={},n=[];return ut(t,function(r,i,o,s){var a=i+"-"+o;return r&&(e[a]=0),s!==void 0&&n.push({from:s,to:a}),a}),n.reverse(),n.forEach(function(r){e[r.from]===void 0?e[r.from]=1+e[r.to]:e[r.from]=Math.min(e[r.from],1+e[r.to])}),e}function vu(t){var e="limit"in t?t.keys.slice(t.skip,t.limit+t.skip):t.skip>0?t.keys.slice(t.skip):t.keys;t.keys=e,t.skip=0,delete t.limit,t.descending&&(e.reverse(),t.descending=!1)}function Po(t){var e=t._compactionQueue[0],n=e.opts,r=e.callback;t.get("_local/compaction").catch(function(){return!1}).then(function(i){i&&i.last_seq&&(n.last_seq=i.last_seq),t._compact(n,function(o,s){o?r(o):r(null,s),Oe(function(){t._compactionQueue.shift(),t._compactionQueue.length&&Po(t)})})})}function pu(t,e,n){return t.get("_local/purges").then(function(r){const i=r.purgeSeq+1;return r.purges.push({docId:e,rev:n,purgeSeq:i}),r.purges.length>self.purged_infos_limit&&r.purges.splice(0,r.purges.length-self.purged_infos_limit),r.purgeSeq=i,r}).catch(function(r){if(r.status!==404)throw r;return{_id:"_local/purges",purges:[{docId:e,rev:n,purgeSeq:0}],purgeSeq:0}}).then(function(r){return t.put(r)})}function yu(t){return t.charAt(0)==="_"?t+" is not a valid attachment name, attachment names cannot start with '_'":!1}class Ro extends je{_setup(){this.post=le("post",function(e,n,r){if(typeof n=="function"&&(r=n,n={}),typeof e!="object"||Array.isArray(e))return r(ne(In));this.bulkDocs({docs:[e]},n,Tn(r,e._id))}).bind(this),this.put=le("put",function(e,n,r){if(typeof n=="function"&&(r=n,n={}),typeof e!="object"||Array.isArray(e))return r(ne(In));if(Oo(e._id),it(e._id)&&typeof this._putLocal=="function")return e._deleted?this._removeLocal(e,r):this._putLocal(e,r);const i=s=>{typeof this._put=="function"&&n.new_edits!==!1?this._put(e,n,s):this.bulkDocs({docs:[e]},n,Tn(s,e._id))};n.force&&e._rev?(o(),i(function(s){var a=s?null:{ok:!0,id:e._id,rev:e._rev};r(s,a)})):i(r);function o(){var s=e._rev.split("-"),a=s[1],u=parseInt(s[0],10),h=u+1,y=To();e._revisions={start:h,ids:[y,a]},e._rev=h+"-"+y,n.new_edits=!1}}).bind(this),this.putAttachment=le("putAttachment",function(e,n,r,i,o){var s=this;typeof o=="function"&&(o=i,i=r,r=null),typeof o>"u"&&(o=i,i=r,r=null),o||De("warn","Attachment",n,"on document",e,"is missing content_type");function a(u){var h="_rev"in u?parseInt(u._rev,10):0;return u._attachments=u._attachments||{},u._attachments[n]={content_type:o,data:i,revpos:++h},s.put(u)}return s.get(e).then(function(u){if(u._rev!==r)throw ne(St);return a(u)},function(u){if(u.reason===Te.message)return a({_id:e});throw u})}).bind(this),this.removeAttachment=le("removeAttachment",function(e,n,r,i){this.get(e,(o,s)=>{if(o){i(o);return}if(s._rev!==r){i(ne(St));return}if(!s._attachments)return i();delete s._attachments[n],Object.keys(s._attachments).length===0&&delete s._attachments,this.put(s,i)})}).bind(this),this.remove=le("remove",function(e,n,r,i){var o;typeof n=="string"?(o={_id:e,_rev:n},typeof r=="function"&&(i=r,r={})):(o=e,typeof n=="function"?(i=n,r={}):(i=r,r=n)),r=r||{},r.was_delete=!0;var s={_id:o._id,_rev:o._rev||r.rev};if(s._deleted=!0,it(s._id)&&typeof this._removeLocal=="function")return this._removeLocal(o,i);this.bulkDocs({docs:[s]},r,Tn(i,s._id))}).bind(this),this.revsDiff=le("revsDiff",function(e,n,r){typeof n=="function"&&(r=n,n={});var i=Object.keys(e);if(!i.length)return r(null,{});var o=0,s=new Ee;function a(h,y){s.has(h)||s.set(h,{missing:[]}),s.get(h).missing.push(y)}function u(h,y){var c=e[h].slice(0);ut(y,function(w,$,O,T,k){var m=$+"-"+O,g=c.indexOf(m);g!==-1&&(c.splice(g,1),k.status!=="available"&&a(h,m))}),c.forEach(function(w){a(h,w)})}i.map(function(h){this._getRevisionTree(h,function(y,c){if(y&&y.status===404&&y.message==="missing")s.set(h,{missing:e[h]});else{if(y)return r(y);u(h,c)}if(++o===i.length){var w={};return s.forEach(function($,O){w[O]=$}),r(null,w)}})},this)}).bind(this),this.bulkGet=le("bulkGet",function(e,n){$o(this,e,n)}).bind(this),this.compactDocument=le("compactDocument",function(e,n,r){this._getRevisionTree(e,(i,o)=>{if(i)return r(i);var s=hu(o),a=[],u=[];Object.keys(s).forEach(function(h){s[h]>n&&a.push(h)}),ut(o,function(h,y,c,w,$){var O=y+"-"+c;$.status==="available"&&a.indexOf(O)!==-1&&u.push(O)}),this._doCompaction(e,u,r)})}).bind(this),this.compact=le("compact",function(e,n){typeof e=="function"&&(n=e,e={}),e=e||{},this._compactionQueue=this._compactionQueue||[],this._compactionQueue.push({opts:e,callback:n}),this._compactionQueue.length===1&&Po(this)}).bind(this),this.get=le("get",function(e,n,r){if(typeof n=="function"&&(r=n,n={}),typeof e!="string")return r(ne(So));if(it(e)&&typeof this._getLocal=="function")return this._getLocal(e,r);var i=[];const o=()=>{var u=[],h=i.length;if(!h)return r(null,u);i.forEach(y=>{this.get(e,{rev:y,revs:n.revs,latest:n.latest,attachments:n.attachments,binary:n.binary},function(c,w){if(c)u.push({missing:y});else{for(var $,O=0,T=u.length;O<T;O++)if(u[O].ok&&u[O].ok._rev===w._rev){$=!0;break}$||u.push({ok:w})}h--,h||r(null,u)})})};if(n.open_revs){if(n.open_revs==="all")this._getRevisionTree(e,function(u,h){if(u)return r(u);i=Ur(h).map(function(y){return y.rev}),o()});else if(Array.isArray(n.open_revs)){i=n.open_revs;for(var s=0;s<i.length;s++){var a=i[s];if(!(typeof a=="string"&&/^\d+-/.test(a)))return r(ne(Ao))}o()}else return r(ne(Tr,"function_clause"));return}return this._get(e,n,(u,h)=>{if(u)return u.docId=e,r(u);var y=h.doc,c=h.metadata,w=h.ctx;if(n.conflicts){var $=Fr(c);$.length&&(y._conflicts=$)}if(Qe(c,y._rev)&&(y._deleted=!0),n.revs||n.revs_info){for(var O=y._rev.split("-"),T=parseInt(O[0],10),k=O[1],m=qo(c.rev_tree),g=null,f=0;f<m.length;f++){var d=m[f],p=d.ids.map(function(A){return A.id}).indexOf(k),_=p===T-1;(_||!g&&p!==-1)&&(g=d)}if(!g)return u=new Error("invalid rev tree"),u.docId=e,r(u);var P=g.ids.map(function(A){return A.id}).indexOf(y._rev.split("-")[1])+1,M=g.ids.length-P;if(g.ids.splice(P,M),g.ids.reverse(),n.revs&&(y._revisions={start:g.pos+g.ids.length-1,ids:g.ids.map(function(A){return A.id})}),n.revs_info){var D=g.pos+g.ids.length;y._revs_info=g.ids.map(function(A){return D--,{rev:D+"-"+A.id,status:A.opts.status}})}}if(n.attachments&&y._attachments){var U=y._attachments,z=Object.keys(U).length;if(z===0)return r(null,y);Object.keys(U).forEach(A=>{this._getAttachment(y._id,A,U[A],{rev:y._rev,binary:n.binary,ctx:w},function(E,q){var N=y._attachments[A];N.data=q,delete N.stub,delete N.length,--z||r(null,y)})})}else{if(y._attachments)for(var H in y._attachments)Object.prototype.hasOwnProperty.call(y._attachments,H)&&(y._attachments[H].stub=!0);r(null,y)}})}).bind(this),this.getAttachment=le("getAttachment",function(e,n,r,i){r instanceof Function&&(i=r,r={}),this._get(e,r,(o,s)=>{if(o)return i(o);if(s.doc._attachments&&s.doc._attachments[n])r.ctx=s.ctx,r.binary=!0,this._getAttachment(e,n,s.doc._attachments[n],r,i);else return i(ne(Te))})}).bind(this),this.allDocs=le("allDocs",function(e,n){if(typeof e=="function"&&(n=e,e={}),e.skip=typeof e.skip<"u"?e.skip:0,e.start_key&&(e.startkey=e.start_key),e.end_key&&(e.endkey=e.end_key),"keys"in e){if(!Array.isArray(e.keys))return n(new TypeError("options.keys must be an array"));var r=["startkey","endkey","key"].filter(function(i){return i in e})[0];if(r){n(ne(Pa,"Query parameter `"+r+"` is not compatible with multi-get"));return}if(!Fe(this)&&(vu(e),e.keys.length===0))return this._allDocs({limit:0},n)}return this._allDocs(e,n)}).bind(this),this.close=le("close",function(e){return this._closed=!0,this.emit("closed"),this._close(e)}).bind(this),this.info=le("info",function(e){this._info((n,r)=>{if(n)return e(n);r.db_name=r.db_name||this.name,r.auto_compaction=!!(this.auto_compaction&&!Fe(this)),r.adapter=this.adapter,e(null,r)})}).bind(this),this.id=le("id",function(e){return this._id(e)}).bind(this),this.bulkDocs=le("bulkDocs",function(e,n,r){if(typeof n=="function"&&(r=n,n={}),n=n||{},Array.isArray(e)&&(e={docs:e}),!e||!e.docs||!Array.isArray(e.docs))return r(ne(qa));for(var i=0;i<e.docs.length;++i)if(typeof e.docs[i]!="object"||Array.isArray(e.docs[i]))return r(ne(In));var o;if(e.docs.forEach(function(u){u._attachments&&Object.keys(u._attachments).forEach(function(h){o=o||yu(h),u._attachments[h].content_type||De("warn","Attachment",h,"on document",u._id,"is missing content_type")})}),o)return r(ne(_n,o));"new_edits"in n||("new_edits"in e?n.new_edits=e.new_edits:n.new_edits=!0);var s=this;!n.new_edits&&!Fe(s)&&e.docs.sort(du),lu(e.docs);var a=e.docs.map(function(u){return u._id});this._bulkDocs(e,n,function(u,h){if(u)return r(u);if(n.new_edits||(h=h.filter(function(w){return w.error})),!Fe(s))for(var y=0,c=h.length;y<c;y++)h[y].id=h[y].id||a[y];r(null,h)})}).bind(this),this.registerDependentDatabase=le("registerDependentDatabase",function(e,n){var r=me(this.__opts);this.__opts.view_adapter&&(r.adapter=this.__opts.view_adapter);var i=new this.constructor(e,r);function o(s){return s.dependentDbs=s.dependentDbs||{},s.dependentDbs[e]?!1:(s.dependentDbs[e]=!0,s)}un(this,"_local/_pouch_dependentDbs",o).then(function(){n(null,{db:i})}).catch(n)}).bind(this),this.destroy=le("destroy",function(e,n){typeof e=="function"&&(n=e,e={});var r="use_prefix"in this?this.use_prefix:!0;const i=()=>{this._destroy(e,(o,s)=>{if(o)return n(o);this._destroyed=!0,this.emit("destroyed"),n(null,s||{ok:!0})})};if(Fe(this))return i();this.get("_local/_pouch_dependentDbs",(o,s)=>{if(o)return o.status!==404?n(o):i();var a=s.dependentDbs,u=this.constructor,h=Object.keys(a).map(y=>{var c=r?y.replace(new RegExp("^"+u.prefix),""):y;return new u(c,this.__opts).destroy()});Promise.all(h).then(i,n)})}).bind(this)}_compact(e,n){var r={return_docs:!1,last_seq:e.last_seq||0},i=[],o,s=0;const a=y=>{this.activeTasks.update(o,{completed_items:++s}),i.push(this.compactDocument(y.id,0))},u=y=>{this.activeTasks.remove(o,y),n(y)},h=y=>{var c=y.last_seq;Promise.all(i).then(()=>un(this,"_local/compaction",w=>!w.last_seq||w.last_seq<c?(w.last_seq=c,w):!1)).then(()=>{this.activeTasks.remove(o),n(null,{ok:!0})}).catch(u)};this.info().then(y=>{o=this.activeTasks.add({name:"database_compaction",total_items:y.update_seq-r.last_seq}),this.changes(r).on("change",a).on("complete",h).on("error",u)})}changes(e,n){return typeof e=="function"&&(n=e,e={}),e=e||{},e.return_docs="return_docs"in e?e.return_docs:!e.live,new fu(this,e,n)}type(){return typeof this._type=="function"?this._type():this.adapter}}Ro.prototype.purge=le("_purge",function(t,e,n){if(typeof this._purge>"u")return n(ne(Tr,"Purge is not implemented in the "+this.adapter+" adapter."));var r=this;r._getRevisionTree(t,(i,o)=>{if(i)return n(i);if(!o)return n(ne(Te));let s;try{s=Va(o,e)}catch(a){return n(a.message||a)}r._purge(t,s,(a,u)=>{if(a)return n(a);pu(r,t,e).then(function(){return n(null,u)})})})});let gu=class{constructor(){this.isReady=!1,this.failed=!1,this.queue=[]}execute(){var e;if(this.failed)for(;e=this.queue.shift();)e(this.failed);else for(;e=this.queue.shift();)e()}fail(e){this.failed=e,this.execute()}ready(e){this.isReady=!0,this.db=e,this.execute()}addTask(e){this.queue.push(e),this.failed&&this.execute()}};function mu(t,e){var n=t.match(/([a-z-]*):\/\/(.*)/);if(n)return{name:/https?/.test(n[1])?n[1]+"://"+n[2]:n[2],adapter:n[1]};var r=te.adapters,i=te.preferredAdapters,o=te.prefix,s=e.adapter;if(!s)for(var a=0;a<i.length;++a){if(s=i[a],s==="idb"&&"websql"in r&&sn()&&localStorage["_pouch__websqldb_"+o+t]){De("log",'PouchDB is downgrading "'+t+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}var u=r[s],h=u&&"use_prefix"in u?u.use_prefix:!0;return{name:h?o+t:t,adapter:s}}function _u(t,e){t.prototype=Object.create(e.prototype,{constructor:{value:t}})}function Bo(t,e){let n=function(...r){if(!(this instanceof n))return new n(...r);e.apply(this,r)};return _u(n,t),n}function wu(t){function e(r){t.removeListener("closed",n),r||t.constructor.emit("destroyed",t.name)}function n(){t.removeListener("destroyed",e),t.constructor.emit("unref",t)}t.once("destroyed",e),t.once("closed",n),t.constructor.emit("ref",t)}class vi extends Ro{constructor(e,n){super(),this._setup(e,n)}_setup(e,n){if(super._setup(),n=n||{},e&&typeof e=="object"&&(n=e,e=n.name,delete n.name),n.deterministic_revs===void 0&&(n.deterministic_revs=!0),this.__opts=n=me(n),this.auto_compaction=n.auto_compaction,this.purged_infos_limit=n.purged_infos_limit||1e3,this.prefix=te.prefix,typeof e!="string")throw new Error("Missing/invalid DB name");var r=(n.prefix||"")+e,i=mu(r,n);if(n.name=i.name,n.adapter=n.adapter||i.adapter,this.name=e,this._adapter=n.adapter,te.emit("debug",["adapter","Picked adapter: ",n.adapter]),!te.adapters[n.adapter]||!te.adapters[n.adapter].valid())throw new Error("Invalid Adapter: "+n.adapter);if(n.view_adapter&&(!te.adapters[n.view_adapter]||!te.adapters[n.view_adapter].valid()))throw new Error("Invalid View Adapter: "+n.view_adapter);this.taskqueue=new gu,this.adapter=n.adapter,te.adapters[n.adapter].call(this,n,o=>{if(o)return this.taskqueue.fail(o);wu(this),this.emit("created",this),te.emit("created",this.name),this.taskqueue.ready(this)})}}const te=Bo(vi,function(t,e){vi.prototype._setup.call(this,t,e)});var bu=typeof AbortController<"u"?AbortController:function(){return{abort:function(){}}},Lo=fetch,_t=Headers;class $u{constructor(){this.tasks={}}list(){return Object.values(this.tasks)}add(e){const n=Ir();return this.tasks[n]={id:n,name:e.name,total_items:e.total_items,created_at:new Date().toJSON()},n}get(e){return this.tasks[e]}remove(e,n){return delete this.tasks[e],this.tasks}update(e,n){const r=this.tasks[e];if(typeof r<"u"){const i={id:r.id,name:r.name,created_at:r.created_at,total_items:n.total_items||r.total_items,completed_items:n.completed_items||r.completed_items,updated_at:new Date().toJSON()};this.tasks[e]=i}return this.tasks}}te.adapters={};te.preferredAdapters=[];te.prefix="_pouch_";var pi=new je;function Su(t){Object.keys(je.prototype).forEach(function(n){typeof je.prototype[n]=="function"&&(t[n]=pi[n].bind(pi))});var e=t._destructionListeners=new Ee;t.on("ref",function(r){e.has(r.name)||e.set(r.name,[]),e.get(r.name).push(r)}),t.on("unref",function(r){if(e.has(r.name)){var i=e.get(r.name),o=i.indexOf(r);o<0||(i.splice(o,1),i.length>1?e.set(r.name,i):e.delete(r.name))}}),t.on("destroyed",function(r){if(e.has(r)){var i=e.get(r);e.delete(r),i.forEach(function(o){o.emit("destroyed",!0)})}})}Su(te);te.adapter=function(t,e,n){e.valid()&&(te.adapters[t]=e,n&&te.preferredAdapters.push(t))};te.plugin=function(t){if(typeof t=="function")t(te);else{if(typeof t!="object"||Object.keys(t).length===0)throw new Error('Invalid plugin: got "'+t+'", expected an object or a function');Object.keys(t).forEach(function(e){te.prototype[e]=t[e]})}return this.__defaults&&(te.__defaults=st({},this.__defaults)),te};te.defaults=function(t){let e=Bo(te,function(n,r){r=r||{},n&&typeof n=="object"&&(r=n,n=r.name,delete r.name),r=st({},e.__defaults,r),te.call(this,n,r)});return e.preferredAdapters=te.preferredAdapters.slice(),Object.keys(te).forEach(function(n){n in e||(e[n]=te[n])}),e.__defaults=st({},this.__defaults,t),e};te.fetch=function(t,e){return Lo(t,e)};te.prototype.activeTasks=te.activeTasks=new $u;var ku="8.0.1";function Kr(t,e){for(var n=t,r=0,i=e.length;r<i;r++){var o=e[r];if(n=n[o],!n)break}return n}function Au(t,e){return t<e?-1:t>e?1:0}function Qr(t){for(var e=[],n="",r=0,i=t.length;r<i;r++){var o=t[r];r>0&&t[r-1]==="\\"&&(o==="$"||o===".")?n=n.substring(0,n.length-1)+o:o==="."?(e.push(n),n=""):n+=o}return e.push(n),e}var Ou=["$or","$nor","$not"];function Mo(t){return Ou.indexOf(t)>-1}function No(t){return Object.keys(t)[0]}function Eu(t){return t[No(t)]}function Pt(t){var e={},n={$or:!0,$nor:!0};return t.forEach(function(r){Object.keys(r).forEach(function(i){var o=r[i];if(typeof o!="object"&&(o={$eq:o}),Mo(i))if(o instanceof Array){if(n[i]){n[i]=!1,e[i]=o;return}var s=[];e[i].forEach(function(u){Object.keys(o).forEach(function(h){var y=o[h],c=Math.max(Object.keys(u).length,Object.keys(y).length),w=Pt([u,y]);Object.keys(w).length<=c||s.push(w)})}),e[i]=s}else e[i]=Pt([o]);else{var a=e[i]=e[i]||{};Object.keys(o).forEach(function(u){var h=o[u];if(u==="$gt"||u==="$gte")return xu(u,h,a);if(u==="$lt"||u==="$lte")return Cu(u,h,a);if(u==="$ne")return Iu(h,a);if(u==="$eq")return Tu(h,a);if(u==="$regex")return qu(h,a);a[u]=h})}})}),e}function xu(t,e,n){typeof n.$eq<"u"||(typeof n.$gte<"u"?t==="$gte"?e>n.$gte&&(n.$gte=e):e>=n.$gte&&(delete n.$gte,n.$gt=e):typeof n.$gt<"u"?t==="$gte"?e>n.$gt&&(delete n.$gt,n.$gte=e):e>n.$gt&&(n.$gt=e):n[t]=e)}function Cu(t,e,n){typeof n.$eq<"u"||(typeof n.$lte<"u"?t==="$lte"?e<n.$lte&&(n.$lte=e):e<=n.$lte&&(delete n.$lte,n.$lt=e):typeof n.$lt<"u"?t==="$lte"?e<n.$lt&&(delete n.$lt,n.$lte=e):e<n.$lt&&(n.$lt=e):n[t]=e)}function Iu(t,e){"$ne"in e?e.$ne.push(t):e.$ne=[t]}function Tu(t,e){delete e.$gt,delete e.$gte,delete e.$lt,delete e.$lte,delete e.$ne,e.$eq=t}function qu(t,e){"$regex"in e?e.$regex.push(t):e.$regex=[t]}function Uo(t){for(var e in t){if(Array.isArray(t))for(var n in t)t[n].$and&&(t[n]=Pt(t[n].$and));var r=t[e];typeof r=="object"&&Uo(r)}return t}function Fo(t,e){for(var n in t){n==="$and"&&(e=!0);var r=t[n];typeof r=="object"&&(e=Fo(r,e))}return e}function ju(t){var e=me(t);Fo(e,!1)&&(e=Uo(e),"$and"in e&&(e=Pt(e.$and))),["$or","$nor"].forEach(function(s){s in e&&e[s].forEach(function(a){for(var u=Object.keys(a),h=0;h<u.length;h++){var y=u[h],c=a[y];(typeof c!="object"||c===null)&&(a[y]={$eq:c})}})}),"$not"in e&&(e.$not=Pt([e.$not]));for(var n=Object.keys(e),r=0;r<n.length;r++){var i=n[r],o=e[i];(typeof o!="object"||o===null)&&(o={$eq:o}),e[i]=o}return Xn(e),e}function Xn(t){Object.keys(t).forEach(function(e){var n=t[e];Array.isArray(n)?n.forEach(function(r){r&&typeof r=="object"&&Xn(r)}):e==="$ne"?t.$ne=[n]:e==="$regex"?t.$regex=[n]:n&&typeof n=="object"&&Xn(n)})}function Du(t,e,n){for(var r="",i=n-t.length;r.length<i;)r+=e;return r}function Pu(t,e,n){var r=Du(t,e,n);return r+t}var Ko=-324,Zn=3,Vn="";function de(t,e){if(t===e)return 0;t=ct(t),e=ct(e);var n=er(t),r=er(e);if(n-r!==0)return n-r;switch(typeof t){case"number":return t-e;case"boolean":return t<e?-1:1;case"string":return Uu(t,e)}return Array.isArray(t)?Nu(t,e):Fu(t,e)}function ct(t){switch(typeof t){case"undefined":return null;case"number":return t===1/0||t===-1/0||isNaN(t)?null:t;case"object":var e=t;if(Array.isArray(t)){var n=t.length;t=new Array(n);for(var r=0;r<n;r++)t[r]=ct(e[r])}else{if(t instanceof Date)return t.toJSON();if(t!==null){t={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=e[i];typeof o<"u"&&(t[i]=ct(o))}}}}return t}function Ru(t){if(t!==null)switch(typeof t){case"boolean":return t?1:0;case"number":return Ku(t);case"string":return t.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var e=Array.isArray(t),n=e?t:Object.keys(t),r=-1,i=n.length,o="";if(e)for(;++r<i;)o+=Re(n[r]);else for(;++r<i;){var s=n[r];o+=Re(s)+Re(t[s])}return o}return""}function Re(t){var e="\0";return t=ct(t),er(t)+Vn+Ru(t)+e}function Bu(t,e){var n=e,r,i=t[e]==="1";if(i)r=0,e++;else{var o=t[e]==="0";e++;var s="",a=t.substring(e,e+Zn),u=parseInt(a,10)+Ko;for(o&&(u=-u),e+=Zn;;){var h=t[e];if(h==="\0")break;s+=h,e++}s=s.split("."),s.length===1?r=parseInt(s,10):r=parseFloat(s[0]+"."+s[1]),o&&(r=r-10),u!==0&&(r=parseFloat(r+"e"+u))}return{num:r,length:e-n}}function Lu(t,e){var n=t.pop();if(e.length){var r=e[e.length-1];n===r.element&&(e.pop(),r=e[e.length-1]);var i=r.element,o=r.index;if(Array.isArray(i))i.push(n);else if(o===t.length-2){var s=t.pop();i[s]=n}else t.push(n)}}function Mu(t){for(var e=[],n=[],r=0;;){var i=t[r++];if(i==="\0"){if(e.length===1)return e.pop();Lu(e,n);continue}switch(i){case"1":e.push(null);break;case"2":e.push(t[r]==="1"),r++;break;case"3":var o=Bu(t,r);e.push(o.num),r+=o.length;break;case"4":for(var s="";;){var a=t[r];if(a==="\0")break;s+=a,r++}s=s.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),e.push(s);break;case"5":var u={element:[],index:e.length};e.push(u.element),n.push(u);break;case"6":var h={element:{},index:e.length};e.push(h.element),n.push(h);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+i)}}}function Nu(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=de(t[r],e[r]);if(i!==0)return i}return t.length===e.length?0:t.length>e.length?1:-1}function Uu(t,e){return t===e?0:t>e?1:-1}function Fu(t,e){for(var n=Object.keys(t),r=Object.keys(e),i=Math.min(n.length,r.length),o=0;o<i;o++){var s=de(n[o],r[o]);if(s!==0||(s=de(t[n[o]],e[r[o]]),s!==0))return s}return n.length===r.length?0:n.length>r.length?1:-1}function er(t){var e=["boolean","number","string","object"],n=e.indexOf(typeof t);if(~n)return t===null?1:Array.isArray(t)?5:n<3?n+2:n+3;if(Array.isArray(t))return 5}function Ku(t){if(t===0)return"1";var e=t.toExponential().split(/e\+?/),n=parseInt(e[1],10),r=t<0,i=r?"0":"2",o=(r?-n:n)-Ko,s=Pu(o.toString(),"0",Zn);i+=Vn+s;var a=Math.abs(parseFloat(e[0]));r&&(a=10-a);var u=a.toFixed(20);return u=u.replace(/\.?0+$/,""),i+=Vn+u,i}function Qu(t){function e(n){return t.map(function(r){var i=No(r),o=Qr(i),s=Kr(n,o);return s})}return function(n,r){var i=e(n.doc),o=e(r.doc),s=de(i,o);return s!==0?s:Au(n.doc._id,r.doc._id)}}function Wu(t,e,n){if(t=t.filter(function(s){return wt(s.doc,e.selector,n)}),e.sort){var r=Qu(e.sort);t=t.sort(r),typeof e.sort[0]!="string"&&Eu(e.sort[0])==="desc"&&(t=t.reverse())}if("limit"in e||"skip"in e){var i=e.skip||0,o=("limit"in e?e.limit:t.length)+i;t=t.slice(i,o)}return t}function wt(t,e,n){return n.every(function(r){var i=e[r],o=Qr(r),s=Kr(t,o);return Mo(r)?zu(r,i,t):cn(i,t,o,s)})}function cn(t,e,n,r){return t?typeof t=="object"?Object.keys(t).every(function(i){var o=t[i];if(i.indexOf("$")===0)return yi(i,e,o,n,r);var s=Qr(i);if(r===void 0&&typeof o!="object"&&s.length>0)return!1;var a=Kr(r,s);return typeof o=="object"?cn(o,e,n,a):yi("$eq",e,o,s,a)}):t===r:!0}function zu(t,e,n){return t==="$or"?e.some(function(r){return wt(n,r,Object.keys(r))}):t==="$not"?!wt(n,e,Object.keys(e)):!e.find(function(r){return wt(n,r,Object.keys(r))})}function yi(t,e,n,r,i){if(!mi[t])throw new Error('unknown operator "'+t+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return mi[t](e,n,r,i)}function Et(t){return typeof t<"u"&&t!==null}function Ye(t){return typeof t<"u"}function Gu(t,e){if(typeof t!="number"||parseInt(t,10)!==t)return!1;var n=e[0],r=e[1];return t%n===r}function gi(t,e){return e.some(function(n){return t instanceof Array?t.some(function(r){return de(n,r)===0}):de(n,t)===0})}function Ju(t,e){return e.every(function(n){return t.some(function(r){return de(n,r)===0})})}function Hu(t,e){return t.length===e}function Yu(t,e){var n=new RegExp(e);return n.test(t)}function Xu(t,e){switch(e){case"null":return t===null;case"boolean":return typeof t=="boolean";case"number":return typeof t=="number";case"string":return typeof t=="string";case"array":return t instanceof Array;case"object":return{}.toString.call(t)==="[object Object]"}}var mi={$elemMatch:function(t,e,n,r){return!Array.isArray(r)||r.length===0?!1:typeof r[0]=="object"&&r[0]!==null?r.some(function(i){return wt(i,e,Object.keys(e))}):r.some(function(i){return cn(e,t,n,i)})},$allMatch:function(t,e,n,r){return!Array.isArray(r)||r.length===0?!1:typeof r[0]=="object"&&r[0]!==null?r.every(function(i){return wt(i,e,Object.keys(e))}):r.every(function(i){return cn(e,t,n,i)})},$eq:function(t,e,n,r){return Ye(r)&&de(r,e)===0},$gte:function(t,e,n,r){return Ye(r)&&de(r,e)>=0},$gt:function(t,e,n,r){return Ye(r)&&de(r,e)>0},$lte:function(t,e,n,r){return Ye(r)&&de(r,e)<=0},$lt:function(t,e,n,r){return Ye(r)&&de(r,e)<0},$exists:function(t,e,n,r){return e?Ye(r):!Ye(r)},$mod:function(t,e,n,r){return Et(r)&&Gu(r,e)},$ne:function(t,e,n,r){return e.every(function(i){return de(r,i)!==0})},$in:function(t,e,n,r){return Et(r)&&gi(r,e)},$nin:function(t,e,n,r){return Et(r)&&!gi(r,e)},$size:function(t,e,n,r){return Et(r)&&Array.isArray(r)&&Hu(r,e)},$all:function(t,e,n,r){return Array.isArray(r)&&Ju(r,e)},$regex:function(t,e,n,r){return Et(r)&&typeof r=="string"&&e.every(function(i){return Yu(r,i)})},$type:function(t,e,n,r){return Xu(r,e)}};function Zu(t,e){if(typeof e!="object")throw new Error("Selector error: expected a JSON object");e=ju(e);var n={doc:t},r=Wu([n],{selector:e},Object.keys(e));return r&&r.length===1}function Vu(t){return Dr(`"use strict";
return `+t+";",{})}function ec(t){var e=["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+t+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join(`
`);return Dr(e,{})}function tc(t,e){if(t.selector&&t.filter&&t.filter!=="_selector"){var n=typeof t.filter=="string"?t.filter:"function";return e(new Error('selector invalid for filter "'+n+'"'))}e()}function nc(t){t.view&&!t.filter&&(t.filter="_view"),t.selector&&!t.filter&&(t.filter="_selector"),t.filter&&typeof t.filter=="string"&&(t.filter==="_view"?t.view=ui(t.view):t.filter=ui(t.filter))}function rc(t,e){return e.filter&&typeof e.filter=="string"&&!e.doc_ids&&!Fe(t.db)}function ic(t,e){var n=e.complete;if(e.filter==="_view"){if(!e.view||typeof e.view!="string"){var r=ne(_n,"`view` filter parameter not found or invalid.");return n(r)}var i=Yn(e.view);t.db.get("_design/"+i[0],function(s,a){if(t.isCancelled)return n(null,{status:"cancelled"});if(s)return n(kt(s));var u=a&&a.views&&a.views[i[1]]&&a.views[i[1]].map;if(!u)return n(ne(Te,a.views?"missing json key: "+i[1]:"missing json key: views"));e.filter=ec(u),t.doChanges(e)})}else if(e.selector)e.filter=function(s){return Zu(s,e.selector)},t.doChanges(e);else{var o=Yn(e.filter);t.db.get("_design/"+o[0],function(s,a){if(t.isCancelled)return n(null,{status:"cancelled"});if(s)return n(kt(s));var u=a&&a.filters&&a.filters[o[1]];if(!u)return n(ne(Te,a&&a.filters?"missing json key: "+o[1]:"missing json key: filters"));e.filter=Vu(u),t.doChanges(e)})}}function oc(t){t._changesFilterPlugin={validate:tc,normalize:nc,shouldFilter:rc,filter:ic}}te.plugin(oc);te.version=ku;function Qo(t){return t.reduce(function(e,n){return e[n]=!0,e},{})}var sc=Qo(["_id","_rev","_access","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),ac=Qo(["_access","_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function _i(t){if(!/^\d+-/.test(t))return ne(Ao);var e=t.indexOf("-"),n=t.substring(0,e),r=t.substring(e+1);return{prefix:parseInt(n,10),id:r}}function uc(t,e){for(var n=t.start-t.ids.length+1,r=t.ids,i=[r[0],e,[]],o=1,s=r.length;o<s;o++)i=[r[o],{status:"missing"},[i]];return[{pos:n,ids:i}]}function Wo(t,e,n){n||(n={deterministic_revs:!0});var r,i,o,s={status:"available"};if(t._deleted&&(s.deleted=!0),e)if(t._id||(t._id=wn()),i=To(t,n.deterministic_revs),t._rev){if(o=_i(t._rev),o.error)return o;t._rev_tree=[{pos:o.prefix,ids:[o.id,{status:"missing"},[[i,s,[]]]]}],r=o.prefix+1}else t._rev_tree=[{pos:1,ids:[i,s,[]]}],r=1;else if(t._revisions&&(t._rev_tree=uc(t._revisions,s),r=t._revisions.start,i=t._revisions.ids[0]),!t._rev_tree){if(o=_i(t._rev),o.error)return o;r=o.prefix,i=o.id,t._rev_tree=[{pos:r,ids:[i,s,[]]}]}Oo(t._id),t._rev=r+"-"+i;var a={metadata:{},data:{}};for(var u in t)if(Object.prototype.hasOwnProperty.call(t,u)){var h=u[0]==="_";if(h&&!sc[u]){var y=ne(ai,u);throw y.message=ai.message+": "+u,y}else h&&!ac[u]?a.metadata[u.slice(1)]=t[u]:a.data[u]=t[u]}return a}function cc(t){try{return Pr(t)}catch{var e=ne(ko,"Attachment is not a valid base64 string");return{error:e}}}function fc(t,e,n){var r=cc(t.data);if(r.error)return n(r.error);t.length=r.length,e==="blob"?t.data=Br(r,t.content_type):e==="base64"?t.data=Ut(r):t.data=r,Nr(r,function(i){t.digest="md5-"+i,n()})}function lc(t,e,n){Nr(t.data,function(r){t.digest="md5-"+r,t.length=t.data.size||t.data.length||0,e==="binary"?Co(t.data,function(i){t.data=i,n()}):e==="base64"?Mr(t.data,function(i){t.data=i,n()}):n()})}function dc(t,e,n){if(t.stub)return n();typeof t.data=="string"?fc(t,e,n):lc(t,e,n)}function hc(t,e,n){if(!t.length)return n();var r=0,i;t.forEach(function(s){var a=s.data&&s.data._attachments?Object.keys(s.data._attachments):[],u=0;if(!a.length)return o();function h(c){i=c,u++,u===a.length&&o()}for(var y in s.data._attachments)Object.prototype.hasOwnProperty.call(s.data._attachments,y)&&dc(s.data._attachments[y],e,h)});function o(){r++,t.length===r&&(i?n(i):n())}}function vc(t,e,n,r,i,o,s,a){if(ou(e.rev_tree,n.metadata.rev)&&!a)return r[i]=n,o();var u=e.winningRev||at(e),h="deleted"in e?e.deleted:Qe(e,u),y="deleted"in n.metadata?n.metadata.deleted:Qe(n.metadata),c=/^1-/.test(n.metadata.rev);if(h&&!y&&a&&c){var w=n.data;w._rev=u,w._id=n.metadata.id,n=Wo(w,a)}var $=Do(e.rev_tree,n.metadata.rev_tree[0],t),O=a&&(h&&y&&$.conflicts!=="new_leaf"||!h&&$.conflicts!=="new_leaf"||h&&!y&&$.conflicts==="new_branch");if(O){var T=ne(St);return r[i]=T,o()}var k=n.metadata.rev;n.metadata.rev_tree=$.tree,n.stemmedRevs=$.stemmedRevs||[],e.rev_map&&(n.metadata.rev_map=e.rev_map);var m=at(n.metadata),g=Qe(n.metadata,m),f=h===g?0:h<g?-1:1,d;k===m?d=g:d=Qe(n.metadata,k),s(n,m,g,d,!0,f,i,o)}function pc(t){return t.metadata.rev_tree[0].ids[1].status==="missing"}function yc(t,e,n,r,i,o,s,a,u){t=t||1e3;function h(T,k,m){var g=at(T.metadata),f=Qe(T.metadata,g);if("was_delete"in a&&f)return o[k]=ne(Te,"deleted"),m();var d=y&&pc(T);if(d){var p=ne(St);return o[k]=p,m()}var _=f?0:1;s(T,g,f,f,!1,_,k,m)}var y=a.new_edits,c=new Ee,w=0,$=e.length;function O(){++w===$&&u&&u()}e.forEach(function(T,k){if(T._id&&it(T._id)){var m=T._deleted?"_removeLocal":"_putLocal";n[m](T,{ctx:i},function(f,d){o[k]=f||d,O()});return}var g=T.metadata.id;c.has(g)?($--,c.get(g).push([T,k])):c.set(g,[[T,k]])}),c.forEach(function(T,k){var m=0;function g(){++m<T.length?f():O()}function f(){var d=T[m],p=d[0],_=d[1];if(r.has(k))vc(t,r.get(k),p,o,_,g,s,y);else{var P=Do([],p.metadata.rev_tree[0],t);p.metadata.rev_tree=P.tree,p.stemmedRevs=P.stemmedRevs||[],h(p,_,g)}}f()})}var gc=5,ve="document-store",be="by-sequence",qe="attach-store",tt="attach-seq-store",Ae="meta-store",Me="local-store",tr="detect-blob-support";function mc(t){try{return JSON.parse(t)}catch{return yn.parse(t)}}function _c(t){try{return JSON.stringify(t)}catch{return yn.stringify(t)}}function Ue(t){return function(e){var n="unknown_error";e.target&&e.target.error&&(n=e.target.error.name||e.target.error.message),t(ne(qr,n,e.type))}}function nr(t,e,n){return{data:_c(t),winningRev:e,deletedOrLocal:n?"1":"0",seq:t.seq,id:t.id}}function nt(t){if(!t)return null;var e=mc(t.data);return e.winningRev=t.winningRev,e.deleted=t.deletedOrLocal==="1",e.seq=t.seq,e}function fn(t){if(!t)return t;var e=t._doc_id_rev.lastIndexOf(":");return t._id=t._doc_id_rev.substring(0,e-1),t._rev=t._doc_id_rev.substring(e+1),delete t._doc_id_rev,t}function zo(t,e,n,r){n?r(t?typeof t!="string"?t:Lr(t,e):Rr([""],{type:e})):t?typeof t!="string"?xo(t,function(i){r(Ut(i))}):r(t):r("")}function Go(t,e,n,r){var i=Object.keys(t._attachments||{});if(!i.length)return r&&r();var o=0;function s(){++o===i.length&&r&&r()}function a(u,h){var y=u._attachments[h],c=y.digest,w=n.objectStore(qe).get(c);w.onsuccess=function($){y.body=$.target.result.body,s()}}i.forEach(function(u){e.attachments&&e.include_docs?a(t,u):(t._attachments[u].stub=!0,s())})}function rr(t,e){return Promise.all(t.map(function(n){if(n.doc&&n.doc._attachments){var r=Object.keys(n.doc._attachments);return Promise.all(r.map(function(i){var o=n.doc._attachments[i];if("body"in o){var s=o.body,a=o.content_type;return new Promise(function(u){zo(s,a,e,function(h){n.doc._attachments[i]=st(Nt(o,["digest","content_type"]),{data:h}),u()})})}}))}}))}function Jo(t,e,n){var r=[],i=n.objectStore(be),o=n.objectStore(qe),s=n.objectStore(tt),a=t.length;function u(){a--,a||h()}function h(){r.length&&r.forEach(function(y){var c=s.index("digestSeq").count(IDBKeyRange.bound(y+"::",y+"::￿",!1,!1));c.onsuccess=function(w){var $=w.target.result;$||o.delete(y)}})}t.forEach(function(y){var c=i.index("_doc_id_rev"),w=e+"::"+y;c.getKey(w).onsuccess=function($){var O=$.target.result;if(typeof O!="number")return u();i.delete(O);var T=s.index("seq").openCursor(IDBKeyRange.only(O));T.onsuccess=function(k){var m=k.target.result;if(m){var g=m.value.digestSeq.split("::")[0];r.push(g),s.delete(m.primaryKey),m.continue()}else u()}}})}function Be(t,e,n){try{return{txn:t.transaction(e,n)}}catch(r){return{error:r}}}var qt=new Ca;function wc(t,e,n,r,i,o){for(var s=e.docs,a,u,h,y,c,w,$,O,T=0,k=s.length;T<k;T++){var m=s[T];m._id&&it(m._id)||(m=s[T]=Wo(m,n.new_edits,t),m.error&&!$&&($=m))}if($)return o($);var g=!1,f=0,d=new Array(s.length),p=new Ee,_=!1,P=r._meta.blobSupport?"blob":"base64";hc(s,P,function(S){if(S)return o(S);M()});function M(){var S=[ve,be,qe,Me,tt,Ae],I=Be(i,S,"readwrite");if(I.error)return o(I.error);a=I.txn,a.onabort=Ue(o),a.ontimeout=Ue(o),a.oncomplete=A,u=a.objectStore(ve),h=a.objectStore(be),y=a.objectStore(qe),c=a.objectStore(tt),w=a.objectStore(Ae),w.get(Ae).onsuccess=function(L){O=L.target.result,z()},q(function(L){if(L)return _=!0,o(L);H()})}function D(){g=!0,z()}function U(){yc(t.revs_limit,s,r,p,a,d,N,n,D)}function z(){!O||!g||(O.docCount+=f,w.put(O))}function H(){if(!s.length)return;var S=0;function I(){++S===s.length&&U()}function L(B){var F=nt(B.target.result);F&&p.set(F.id,F),I()}for(var Q=0,j=s.length;Q<j;Q++){var x=s[Q];if(x._id&&it(x._id)){I();continue}var C=u.get(x.metadata.id);C.onsuccess=L}}function A(){_||(qt.notify(r._meta.name),o(null,d))}function E(S,I){var L=y.get(S);L.onsuccess=function(Q){if(Q.target.result)I();else{var j=ne(Ra,"unknown stub attachment with digest "+S);j.status=412,I(j)}}}function q(S){var I=[];if(s.forEach(function(x){x.data&&x.data._attachments&&Object.keys(x.data._attachments).forEach(function(C){var B=x.data._attachments[C];B.stub&&I.push(B.digest)})}),!I.length)return S();var L=0,Q;function j(){++L===I.length&&S(Q)}I.forEach(function(x){E(x,function(C){C&&!Q&&(Q=C),j()})})}function N(S,I,L,Q,j,x,C,B){S.metadata.winningRev=I,S.metadata.deleted=L;var F=S.data;F._id=S.metadata.id,F._rev=S.metadata.rev,Q&&(F._deleted=!0);var K=F._attachments&&Object.keys(F._attachments).length;if(K)return l(S,I,L,j,C,B);f+=x,z(),R(S,I,L,j,C,B)}function R(S,I,L,Q,j,x){var C=S.data,B=S.metadata;C._doc_id_rev=B.id+"::"+B.rev,delete C._id,delete C._rev;function F(ae){var ye=S.stemmedRevs||[];Q&&r.auto_compaction&&(ye=ye.concat(Za(S.metadata))),ye&&ye.length&&Jo(ye,S.metadata.id,a),B.seq=ae.target.result;var ke=nr(B,I,L),W=u.put(ke);W.onsuccess=X}function K(ae){ae.preventDefault(),ae.stopPropagation();var ye=h.index("_doc_id_rev"),ke=ye.getKey(C._doc_id_rev);ke.onsuccess=function(W){var J=h.put(C,W.target.result);J.onsuccess=F}}function X(){d[j]={ok:!0,id:B.id,rev:B.rev},p.set(S.metadata.id,S.metadata),v(S,B.seq,x)}var ie=h.put(C);ie.onsuccess=F,ie.onerror=K}function l(S,I,L,Q,j,x){var C=S.data,B=0,F=Object.keys(C._attachments);function K(){B===F.length&&R(S,I,L,Q,j,x)}function X(){B++,K()}F.forEach(function(ie){var ae=S.data._attachments[ie];if(ae.stub)B++,K();else{var ye=ae.data;delete ae.data,ae.revpos=parseInt(I,10);var ke=ae.digest;b(ke,ye,X)}})}function v(S,I,L){var Q=0,j=Object.keys(S.data._attachments||{});if(!j.length)return L();function x(){++Q===j.length&&L()}function C(F){var K=S.data._attachments[F].digest,X=c.put({seq:I,digestSeq:K+"::"+I});X.onsuccess=x,X.onerror=function(ie){ie.preventDefault(),ie.stopPropagation(),x()}}for(var B=0;B<j.length;B++)C(j[B])}function b(S,I,L){var Q=y.count(S);Q.onsuccess=function(j){var x=j.target.result;if(x)return L();var C={digest:S,body:I},B=y.put(C);B.onsuccess=L}}}function Ho(t,e,n,r,i){r===-1&&(r=1e3);var o=typeof t.getAll=="function"&&typeof t.getAllKeys=="function"&&r>1&&!n,s,a,u;function h($){a=$.target.result,s&&i(s,a,u)}function y($){s=$.target.result,a&&i(s,a,u)}function c(){if(!s.length)return i();var $=s[s.length-1],O;if(e&&e.upper)try{O=IDBKeyRange.bound($,e.upper,!0,e.upperOpen)}catch(T){if(T.name==="DataError"&&T.code===0)return i()}else O=IDBKeyRange.lowerBound($,!0);e=O,s=null,a=null,t.getAll(e,r).onsuccess=h,t.getAllKeys(e,r).onsuccess=y}function w($){var O=$.target.result;if(!O)return i();i([O.key],[O.value],O)}o?(u={continue:c},t.getAll(e,r).onsuccess=h,t.getAllKeys(e,r).onsuccess=y):n?t.openCursor(e,"prev").onsuccess=w:t.openCursor(e).onsuccess=w}function bc(t,e,n){if(typeof t.getAll=="function"){t.getAll(e).onsuccess=n;return}var r=[];function i(o){var s=o.target.result;s?(r.push(s.value),s.continue()):n({target:{result:r}})}t.openCursor(e).onsuccess=i}function $c(t,e,n){var r=new Array(t.length),i=0;t.forEach(function(o,s){e.get(o).onsuccess=function(a){a.target.result?r[s]=a.target.result:r[s]={key:o,error:"not_found"},i++,i===t.length&&n(t,r,{})}})}function Sc(t,e,n,r,i){try{if(t&&e)return i?IDBKeyRange.bound(e,t,!n,!1):IDBKeyRange.bound(t,e,!1,!n);if(t)return i?IDBKeyRange.upperBound(t):IDBKeyRange.lowerBound(t);if(e)return i?IDBKeyRange.lowerBound(e,!n):IDBKeyRange.upperBound(e,!n);if(r)return IDBKeyRange.only(r)}catch(o){return{error:o}}return null}function kc(t,e,n){var r="startkey"in t?t.startkey:!1,i="endkey"in t?t.endkey:!1,o="key"in t?t.key:!1,s="keys"in t?t.keys:!1,a=t.skip||0,u=typeof t.limit=="number"?t.limit:-1,h=t.inclusive_end!==!1,y,c;if(!s&&(y=Sc(r,i,h,o,t.descending),c=y&&y.error,c&&!(c.name==="DataError"&&c.code===0)))return n(ne(qr,c.name,c.message));var w=[ve,be,Ae];t.attachments&&w.push(qe);var $=Be(e,w,"readonly");if($.error)return n($.error);var O=$.txn;O.oncomplete=A,O.onabort=Ue(n);var T=O.objectStore(ve),k=O.objectStore(be),m=O.objectStore(Ae),g=k.index("_doc_id_rev"),f=[],d,p;m.get(Ae).onsuccess=function(E){d=E.target.result.docCount},t.update_seq&&_(k,function(E){E.target.result&&E.target.result.length>0&&(p=E.target.result[0])});function _(E,q){function N(R){var l=R.target.result,v=void 0;return l&&l.key&&(v=l.key),q({target:{result:[v]}})}E.openCursor(null,"prev").onsuccess=N}function P(E,q,N){var R=E.id+"::"+N;g.get(R).onsuccess=function(v){if(q.doc=fn(v.target.result)||{},t.conflicts){var b=Fr(E);b.length&&(q.doc._conflicts=b)}Go(q.doc,t,O)}}function M(E,q){var N={id:q.id,key:q.id,value:{rev:E}},R=q.deleted;R?s&&(f.push(N),N.value.deleted=!0,N.doc=null):a--<=0&&(f.push(N),t.include_docs&&P(q,N,E))}function D(E){for(var q=0,N=E.length;q<N&&f.length!==u;q++){var R=E[q];if(R.error&&s){f.push(R);continue}var l=nt(R),v=l.winningRev;M(v,l)}}function U(E,q,N){N&&(D(q),f.length<u&&N.continue())}function z(E){var q=E.target.result;t.descending&&(q=q.reverse()),D(q)}function H(){var E={total_rows:d,offset:t.skip,rows:f};t.update_seq&&p!==void 0&&(E.update_seq=p),n(null,E)}function A(){t.attachments?rr(f,t.binary).then(H):H()}if(!(c||u===0)){if(s)return $c(t.keys,T,U);if(u===-1)return bc(T,y,z);Ho(T,y,t.descending,u+a,U)}}function Ac(t){return new Promise(function(e){var n=Rr([""]),r=t.objectStore(tr).put(n,"key");r.onsuccess=function(){var i=navigator.userAgent.match(/Chrome\/(\d+)/),o=navigator.userAgent.match(/Edge\//);e(o||!i||parseInt(i[1],10)>=43)},r.onerror=t.onabort=function(i){i.preventDefault(),i.stopPropagation(),e(!1)}}).catch(function(){return!1})}function Oc(t,e){var n=t.objectStore(ve).index("deletedOrLocal");n.count(IDBKeyRange.only("0")).onsuccess=function(r){e(r.target.result)}}var ir=!1,or=[];function Ec(t,e,n,r){try{t(e,n)}catch(i){r.emit("error",i)}}function wi(){ir||!or.length||(ir=!0,or.shift()())}function xc(t,e,n){or.push(function(){t(function(o,s){Ec(e,o,s,n),ir=!1,Oe(function(){wi()})})}),wi()}function Cc(t,e,n,r){if(t=me(t),t.continuous){var i=n+":"+wn();return qt.addListener(n,i,e,t),qt.notify(n),{cancel:function(){qt.removeListener(n,i)}}}var o=t.doc_ids&&new $t(t.doc_ids);t.since=t.since||0;var s=t.since,a="limit"in t?t.limit:-1;a===0&&(a=1);var u=[],h=0,y=jr(t),c=new Ee,w,$,O,T;function k(M,D,U){if(!U||!M.length)return;var z=new Array(M.length),H=new Array(M.length);function A(N,R){var l=t.processChange(R,N,t);s=l.seq=N.seq;var v=y(l);return typeof v=="object"?Promise.reject(v):v?(h++,t.return_docs&&u.push(l),t.attachments&&t.include_docs?new Promise(function(b){Go(R,t,w,function(){rr([l],t.binary).then(function(){b(l)})})}):Promise.resolve(l)):Promise.resolve()}function E(){for(var N=[],R=0,l=z.length;R<l&&h!==a;R++){var v=z[R];if(v){var b=H[R];N.push(A(b,v))}}Promise.all(N).then(function(S){for(var I=0,L=S.length;I<L;I++)S[I]&&t.onChange(S[I])}).catch(t.complete),h!==a&&U.continue()}var q=0;D.forEach(function(N,R){var l=fn(N),v=M[R];g(l,v,function(b,S){H[R]=b,z[R]=S,++q===M.length&&E()})})}function m(M,D,U,z){if(U.seq!==D)return z();if(U.winningRev===M._rev)return z(U,M);var H=M._id+"::"+U.winningRev,A=T.get(H);A.onsuccess=function(E){z(U,fn(E.target.result))}}function g(M,D,U){if(o&&!o.has(M._id))return U();var z=c.get(M._id);if(z)return m(M,D,z,U);O.get(M._id).onsuccess=function(H){z=nt(H.target.result),c.set(M._id,z),m(M,D,z,U)}}function f(){t.complete(null,{results:u,last_seq:s})}function d(){!t.continuous&&t.attachments?rr(u).then(f):f()}var p=[ve,be];t.attachments&&p.push(qe);var _=Be(r,p,"readonly");if(_.error)return t.complete(_.error);w=_.txn,w.onabort=Ue(t.complete),w.oncomplete=d,$=w.objectStore(be),O=w.objectStore(ve),T=$.index("_doc_id_rev");var P=t.since&&!t.descending?IDBKeyRange.lowerBound(t.since,!0):null;Ho($,P,t.descending,a,k)}var pt=new Ee,qn,jn=new Ee;function Yo(t,e){var n=this;xc(function(r){Ic(n,t,r)},e,n.constructor)}function Ic(t,e,n){var r=e.name,i=null,o=null;t._meta=null;function s(k){return function(m,g){m&&m instanceof Error&&!m.reason&&o&&(m.reason=o),k(m,g)}}function a(k){var m=k.createObjectStore(ve,{keyPath:"id"});k.createObjectStore(be,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),k.createObjectStore(qe,{keyPath:"digest"}),k.createObjectStore(Ae,{keyPath:"id",autoIncrement:!1}),k.createObjectStore(tr),m.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),k.createObjectStore(Me,{keyPath:"_id"});var g=k.createObjectStore(tt,{autoIncrement:!0});g.createIndex("seq","seq"),g.createIndex("digestSeq","digestSeq",{unique:!0})}function u(k,m){var g=k.objectStore(ve);g.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),g.openCursor().onsuccess=function(f){var d=f.target.result;if(d){var p=d.value,_=Qe(p);p.deletedOrLocal=_?"1":"0",g.put(p),d.continue()}else m()}}function h(k){k.createObjectStore(Me,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function y(k,m){var g=k.objectStore(Me),f=k.objectStore(ve),d=k.objectStore(be),p=f.openCursor();p.onsuccess=function(_){var P=_.target.result;if(P){var M=P.value,D=M.id,U=it(D),z=at(M);if(U){var H=D+"::"+z,A=D+"::",E=D+"::~",q=d.index("_doc_id_rev"),N=IDBKeyRange.bound(A,E,!1,!1),R=q.openCursor(N);R.onsuccess=function(l){if(R=l.target.result,!R)f.delete(P.primaryKey),P.continue();else{var v=R.value;v._doc_id_rev===H&&g.put(v),d.delete(R.primaryKey),R.continue()}}}else P.continue()}else m&&m()}}function c(k){var m=k.createObjectStore(tt,{autoIncrement:!0});m.createIndex("seq","seq"),m.createIndex("digestSeq","digestSeq",{unique:!0})}function w(k,m){var g=k.objectStore(be),f=k.objectStore(qe),d=k.objectStore(tt),p=f.count();p.onsuccess=function(_){var P=_.target.result;if(!P)return m();g.openCursor().onsuccess=function(M){var D=M.target.result;if(!D)return m();for(var U=D.value,z=D.primaryKey,H=Object.keys(U._attachments||{}),A={},E=0;E<H.length;E++){var q=U._attachments[H[E]];A[q.digest]=!0}var N=Object.keys(A);for(E=0;E<N.length;E++){var R=N[E];d.put({seq:z,digestSeq:R+"::"+z})}D.continue()}}}function $(k){function m(p){return p.data?nt(p):(p.deleted=p.deletedOrLocal==="1",p)}var g=k.objectStore(be),f=k.objectStore(ve),d=f.openCursor();d.onsuccess=function(p){var _=p.target.result;if(!_)return;var P=m(_.value);P.winningRev=P.winningRev||at(P);function M(){var U=P.id+"::",z=P.id+"::￿",H=g.index("_doc_id_rev").openCursor(IDBKeyRange.bound(U,z)),A=0;H.onsuccess=function(E){var q=E.target.result;if(!q)return P.seq=A,D();var N=q.primaryKey;N>A&&(A=N),q.continue()}}function D(){var U=nr(P,P.winningRev,P.deleted),z=f.put(U);z.onsuccess=function(){_.continue()}}if(P.seq)return D();M()}}t._remote=!1,t.type=function(){return"idb"},t._id=bo(function(k){k(null,t._meta.instanceId)}),t._bulkDocs=function(m,g,f){wc(e,m,g,t,i,s(f))},t._get=function(m,g,f){var d,p,_,P=g.ctx;if(!P){var M=Be(i,[ve,be,qe],"readonly");if(M.error)return f(M.error);P=M.txn}function D(){f(_,{doc:d,metadata:p,ctx:P})}P.objectStore(ve).get(m).onsuccess=function(U){if(p=nt(U.target.result),!p)return _=ne(Te,"missing"),D();var z;if(g.rev)z=g.latest?au(g.rev,p):g.rev;else{z=p.winningRev;var H=Qe(p);if(H)return _=ne(Te,"deleted"),D()}var A=P.objectStore(be),E=p.id+"::"+z;A.index("_doc_id_rev").get(E).onsuccess=function(q){if(d=q.target.result,d&&(d=fn(d)),!d)return _=ne(Te,"missing"),D();D()}}},t._getAttachment=function(k,m,g,f,d){var p;if(f.ctx)p=f.ctx;else{var _=Be(i,[ve,be,qe],"readonly");if(_.error)return d(_.error);p=_.txn}var P=g.digest,M=g.content_type;p.objectStore(qe).get(P).onsuccess=function(D){var U=D.target.result.body;zo(U,M,f.binary,function(z){d(null,z)})}},t._info=function(m){var g,f,d=Be(i,[Ae,be],"readonly");if(d.error)return m(d.error);var p=d.txn;p.objectStore(Ae).get(Ae).onsuccess=function(_){f=_.target.result.docCount},p.objectStore(be).openCursor(null,"prev").onsuccess=function(_){var P=_.target.result;g=P?P.key:0},p.oncomplete=function(){m(null,{doc_count:f,update_seq:g,idb_attachment_format:t._meta.blobSupport?"binary":"base64"})}},t._allDocs=function(m,g){kc(m,i,s(g))},t._changes=function(m){return Cc(m,t,r,i)},t._close=function(k){i.close(),pt.delete(r),k()},t._getRevisionTree=function(k,m){var g=Be(i,[ve],"readonly");if(g.error)return m(g.error);var f=g.txn,d=f.objectStore(ve).get(k);d.onsuccess=function(p){var _=nt(p.target.result);_?m(null,_.rev_tree):m(ne(Te))}},t._doCompaction=function(k,m,g){var f=[ve,be,qe,tt],d=Be(i,f,"readwrite");if(d.error)return g(d.error);var p=d.txn,_=p.objectStore(ve);_.get(k).onsuccess=function(P){var M=nt(P.target.result);ut(M.rev_tree,function(z,H,A,E,q){var N=H+"-"+A;m.indexOf(N)!==-1&&(q.status="missing")}),Jo(m,k,p);var D=M.winningRev,U=M.deleted;p.objectStore(ve).put(nr(M,D,U))},p.onabort=Ue(g),p.oncomplete=function(){g()}},t._getLocal=function(k,m){var g=Be(i,[Me],"readonly");if(g.error)return m(g.error);var f=g.txn,d=f.objectStore(Me).get(k);d.onerror=Ue(m),d.onsuccess=function(p){var _=p.target.result;_?(delete _._doc_id_rev,m(null,_)):m(ne(Te))}},t._putLocal=function(k,m,g){typeof m=="function"&&(g=m,m={}),delete k._revisions;var f=k._rev,d=k._id;f?k._rev="0-"+(parseInt(f.split("-")[1],10)+1):k._rev="0-1";var p=m.ctx,_;if(!p){var P=Be(i,[Me],"readwrite");if(P.error)return g(P.error);p=P.txn,p.onerror=Ue(g),p.oncomplete=function(){_&&g(null,_)}}var M=p.objectStore(Me),D;f?(D=M.get(d),D.onsuccess=function(U){var z=U.target.result;if(!z||z._rev!==f)g(ne(St));else{var H=M.put(k);H.onsuccess=function(){_={ok:!0,id:k._id,rev:k._rev},m.ctx&&g(null,_)}}}):(D=M.add(k),D.onerror=function(U){g(ne(St)),U.preventDefault(),U.stopPropagation()},D.onsuccess=function(){_={ok:!0,id:k._id,rev:k._rev},m.ctx&&g(null,_)})},t._removeLocal=function(k,m,g){typeof m=="function"&&(g=m,m={});var f=m.ctx;if(!f){var d=Be(i,[Me],"readwrite");if(d.error)return g(d.error);f=d.txn,f.oncomplete=function(){p&&g(null,p)}}var p,_=k._id,P=f.objectStore(Me),M=P.get(_);M.onerror=Ue(g),M.onsuccess=function(D){var U=D.target.result;!U||U._rev!==k._rev?g(ne(Te)):(P.delete(_),p={ok:!0,id:_,rev:"0-0"},m.ctx&&g(null,p))}},t._destroy=function(k,m){qt.removeAllListeners(r);var g=jn.get(r);g&&g.result&&(g.result.close(),pt.delete(r));var f=indexedDB.deleteDatabase(r);f.onsuccess=function(){jn.delete(r),sn()&&r in localStorage&&delete localStorage[r],m(null,{ok:!0})},f.onerror=Ue(m)};var O=pt.get(r);if(O)return i=O.idb,t._meta=O.global,Oe(function(){n(null,t)});var T=indexedDB.open(r,gc);jn.set(r,T),T.onupgradeneeded=function(k){var m=k.target.result;if(k.oldVersion<1)return a(m);var g=k.currentTarget.transaction;k.oldVersion<3&&h(m),k.oldVersion<4&&c(m);var f=[u,y,w,$],d=k.oldVersion;function p(){var _=f[d-1];d++,_&&_(g,p)}p()},T.onsuccess=function(k){i=k.target.result,i.onversionchange=function(){i.close(),pt.delete(r)},i.onabort=function(D){De("error","Database has a window failure",D.target.error),o=D.target.error,i.close(),pt.delete(r)};var m=i.transaction([Ae,tr,ve],"readwrite"),g=!1,f,d,p,_;function P(){typeof p>"u"||!g||(t._meta={name:r,instanceId:_,blobSupport:p},pt.set(r,{idb:i,window:t._meta}),n(null,t))}function M(){if(!(typeof d>"u"||typeof f>"u")){var D=r+"_id";D in f?_=f[D]:f[D]=_=wn(),f.docCount=d,m.objectStore(Ae).put(f)}}m.objectStore(Ae).get(Ae).onsuccess=function(D){f=D.target.result||{id:Ae},M()},Oc(m,function(D){d=D,M()}),qn||(qn=Ac(m)),qn.then(function(D){p=D,P()}),m.oncomplete=function(){g=!0,P()},m.onabort=Ue(n)},T.onerror=function(k){var m=k.target.error&&k.target.error.message;m?m.indexOf("stored database is a higher version")!==-1&&(m=new Error('This DB was created with the newer "indexeddb" adapter, but you are trying to open it with the older "idb" adapter')):m="Failed to open indexedDB, are you in private browsing mode?",De("error",m),n(ne(qr,m))}}Yo.valid=function(){try{return typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}};function Tc(t){t.adapter("idb",Yo,!0)}function qc(t,e){return new Promise(function(n,r){var i=0,o=0,s=0,a=t.length,u;function h(){i++,t[o++]().then(c,w)}function y(){++s===a?u?r(u):n():$()}function c(){i--,y()}function w(O){i--,u=u||O,y()}function $(){for(;i<e&&o<a;)h()}$()})}const jc=25,Dc=50,Yt=5e3,Pc=1e4;let Dn={};function Pn(t){let e=t.doc||t.ok,n=e&&e._attachments;n&&Object.keys(n).forEach(function(r){let i=n[r];i.data=Lr(i.data,i.content_type)})}function Xe(t){return/^_design/.test(t)?"_design/"+encodeURIComponent(t.slice(8)):/^_local/.test(t)?"_local/"+encodeURIComponent(t.slice(7)):encodeURIComponent(t)}function bi(t){return!t._attachments||!Object.keys(t._attachments)?Promise.resolve():Promise.all(Object.keys(t._attachments).map(function(e){let n=t._attachments[e];if(n.data&&typeof n.data!="string")return new Promise(function(r){Mr(n.data,r)}).then(function(r){n.data=r})}))}function Rc(t){if(!t.prefix)return!1;let e=Eo(t.prefix).protocol;return e==="http"||e==="https"}function Bc(t,e){if(Rc(e)){let i=e.name.substr(e.prefix.length);t=e.prefix.replace(/\/?$/,"/")+encodeURIComponent(i)}let n=Eo(t);(n.user||n.password)&&(n.auth={username:n.user,password:n.password});let r=n.path.replace(/(^\/|\/$)/g,"").split("/");return n.db=r.pop(),n.db.indexOf("%")===-1&&(n.db=encodeURIComponent(n.db)),n.path=r.join("/"),n}function ge(t,e){return Vt(t,t.db+"/"+e)}function Vt(t,e){let n=t.path?"/":"";return t.protocol+"://"+t.host+(t.port?":"+t.port:"")+"/"+t.path+n+e}function Xt(t){return"?"+Object.keys(t).map(function(e){return e+"="+encodeURIComponent(t[e])}).join("&")}function Lc(t){let e=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",n=e.indexOf("msie")!==-1,r=e.indexOf("trident")!==-1,i=e.indexOf("edge")!==-1,o=!("method"in t)||t.method==="GET";return(n||r||i)&&o}function sr(t,e){let n=this,r=Bc(t.name,t),i=ge(r,"");t=me(t);const o=async function(c,w){if(w=w||{},w.headers=w.headers||new _t,w.credentials="include",t.auth||r.auth){let T=t.auth||r.auth,k=T.username+":"+T.password,m=Ut(unescape(encodeURIComponent(k)));w.headers.set("Authorization","Basic "+m)}let $=t.headers||{};return Object.keys($).forEach(function(T){w.headers.append(T,$[T])}),Lc(w)&&(c+=(c.indexOf("?")===-1?"?":"&")+"_nonce="+Date.now()),await(t.fetch||Lo)(c,w)};function s(c,w){return le(c,function(...$){h().then(function(){return w.apply(this,$)}).catch(function(O){$.pop()(O)})}).bind(n)}async function a(c,w){let $={};w=w||{},w.headers=w.headers||new _t,w.headers.get("Content-Type")||w.headers.set("Content-Type","application/json"),w.headers.get("Accept")||w.headers.set("Accept","application/json");const O=await o(c,w);$.ok=O.ok,$.status=O.status;const T=await O.json();if($.data=T,!$.ok)throw $.data.status=$.status,kt($.data);return Array.isArray($.data)&&($.data=$.data.map(function(k){return k.error||k.missing?kt(k):k})),$}let u;async function h(){return t.skip_setup?Promise.resolve():u||(u=a(i).catch(function(c){return c&&c.status&&c.status===404?(Jn(404,"PouchDB is just detecting if the remote exists."),a(i,{method:"PUT"})):Promise.reject(c)}).catch(function(c){return c&&c.status&&c.status===412?!0:Promise.reject(c)}),u.catch(function(){u=null}),u)}Oe(function(){e(null,n)}),n._remote=!0,n.type=function(){return"http"},n.id=s("id",async function(c){let w;try{w=await(await o(Vt(r,""))).json()}catch{w={}}let $=w&&w.uuid?w.uuid+r.db:ge(r,"");c(null,$)}),n.compact=s("compact",async function(c,w){typeof c=="function"&&(w=c,c={}),c=me(c),await a(ge(r,"_compact"),{method:"POST"});function $(){n.info(function(O,T){T&&!T.compact_running?w(null,{ok:!0}):setTimeout($,c.interval||200)})}$()}),n.bulkGet=le("bulkGet",function(c,w){let $=this;async function O(g){let f={};c.revs&&(f.revs=!0),c.attachments&&(f.attachments=!0),c.latest&&(f.latest=!0);try{const d=await a(ge(r,"_bulk_get"+Xt(f)),{method:"POST",body:JSON.stringify({docs:c.docs})});c.attachments&&c.binary&&d.data.results.forEach(function(p){p.docs.forEach(Pn)}),g(null,d.data)}catch(d){g(d)}}function T(){let g=Dc,f=Math.ceil(c.docs.length/g),d=0,p=new Array(f);function _(P){return function(M,D){p[P]=D.results,++d===f&&w(null,{results:an(p)})}}for(let P=0;P<f;P++){let M=Nt(c,["revs","attachments","binary","latest"]);M.docs=c.docs.slice(P*g,Math.min(c.docs.length,(P+1)*g)),$o($,M,_(P))}}let k=Vt(r,""),m=Dn[k];typeof m!="boolean"?O(function(g,f){g?(Dn[k]=!1,Jn(g.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),T()):(Dn[k]=!0,w(null,f))}):m?O(w):T()}),n._info=async function(c){try{await h();const $=await(await o(ge(r,""))).json();$.host=ge(r,""),c(null,$)}catch(w){c(w)}},n.fetch=async function(c,w){await h();const $=c.substring(0,1)==="/"?Vt(r,c.substring(1)):ge(r,c);return o($,w)},n.get=s("get",async function(c,w,$){typeof w=="function"&&($=w,w={}),w=me(w);let O={};w.revs&&(O.revs=!0),w.revs_info&&(O.revs_info=!0),w.latest&&(O.latest=!0),w.open_revs&&(w.open_revs!=="all"&&(w.open_revs=JSON.stringify(w.open_revs)),O.open_revs=w.open_revs),w.rev&&(O.rev=w.rev),w.conflicts&&(O.conflicts=w.conflicts),w.update_seq&&(O.update_seq=w.update_seq),c=Xe(c);function T(g){let f=g._attachments,d=f&&Object.keys(f);if(!f||!d.length)return;async function p(P){const M=f[P],D=Xe(g._id)+"/"+y(P)+"?rev="+g._rev,U=await o(ge(r,D));let z;"buffer"in U?z=await U.buffer():z=await U.blob();let H;if(w.binary){let A=Object.getOwnPropertyDescriptor(z.__proto__,"type");(!A||A.set)&&(z.type=M.content_type),H=z}else H=await new Promise(function(A){Mr(z,A)});delete M.stub,delete M.length,M.data=H}let _=d.map(function(P){return function(){return p(P)}});return qc(_,5)}function k(g){return Array.isArray(g)?Promise.all(g.map(function(f){if(f.ok)return T(f.ok)})):T(g)}const m=ge(r,c+Xt(O));try{const g=await a(m);w.attachments&&await k(g.data),$(null,g.data)}catch(g){g.docId=c,$(g)}}),n.remove=s("remove",async function(c,w,$,O){let T;typeof w=="string"?(T={_id:c,_rev:w},typeof $=="function"&&(O=$,$={})):(T=c,typeof w=="function"?(O=w,$={}):(O=$,$=w));const k=T._rev||$.rev,m=ge(r,Xe(T._id))+"?rev="+k;try{const g=await a(m,{method:"DELETE"});O(null,g.data)}catch(g){O(g)}});function y(c){return c.split("/").map(encodeURIComponent).join("/")}n.getAttachment=s("getAttachment",async function(c,w,$,O){typeof $=="function"&&(O=$,$={});const T=$.rev?"?rev="+$.rev:"",k=ge(r,Xe(c))+"/"+y(w)+T;let m;try{const f=await o(k,{method:"GET"});if(!f.ok)throw f;m=f.headers.get("content-type");let d;if(typeof process<"u"&&!process.browser&&typeof f.buffer=="function"?d=await f.buffer():d=await f.blob(),typeof process<"u"&&!process.browser){var g=Object.getOwnPropertyDescriptor(d.__proto__,"type");(!g||g.set)&&(d.type=m)}O(null,d)}catch(f){O(f)}}),n.removeAttachment=s("removeAttachment",async function(c,w,$,O){const T=ge(r,Xe(c)+"/"+y(w))+"?rev="+$;try{const k=await a(T,{method:"DELETE"});O(null,k.data)}catch(k){O(k)}}),n.putAttachment=s("putAttachment",async function(c,w,$,O,T,k){typeof T=="function"&&(k=T,T=O,O=$,$=null);const m=Xe(c)+"/"+y(w);let g=ge(r,m);if($&&(g+="?rev="+$),typeof O=="string"){let f;try{f=Pr(O)}catch{return k(ne(ko,"Attachment is not a valid base64 string"))}O=f?Br(f,T):""}try{const f=await a(g,{headers:new _t({"Content-Type":T}),method:"PUT",body:O});k(null,f.data)}catch(f){k(f)}}),n._bulkDocs=async function(c,w,$){c.new_edits=w.new_edits;try{await h(),await Promise.all(c.docs.map(bi));const O=await a(ge(r,"_bulk_docs"),{method:"POST",body:JSON.stringify(c)});$(null,O.data)}catch(O){$(O)}},n._put=async function(c,w,$){try{await h(),await bi(c);const O=await a(ge(r,Xe(c._id)),{method:"PUT",body:JSON.stringify(c)});$(null,O.data)}catch(O){O.docId=c&&c._id,$(O)}},n.allDocs=s("allDocs",async function(c,w){typeof c=="function"&&(w=c,c={}),c=me(c);let $={},O,T="GET";c.conflicts&&($.conflicts=!0),c.update_seq&&($.update_seq=!0),c.descending&&($.descending=!0),c.include_docs&&($.include_docs=!0),c.attachments&&($.attachments=!0),c.key&&($.key=JSON.stringify(c.key)),c.start_key&&(c.startkey=c.start_key),c.startkey&&($.startkey=JSON.stringify(c.startkey)),c.end_key&&(c.endkey=c.end_key),c.endkey&&($.endkey=JSON.stringify(c.endkey)),typeof c.inclusive_end<"u"&&($.inclusive_end=!!c.inclusive_end),typeof c.limit<"u"&&($.limit=c.limit),typeof c.skip<"u"&&($.skip=c.skip);let k=Xt($);typeof c.keys<"u"&&(T="POST",O={keys:c.keys});try{const m=await a(ge(r,"_all_docs"+k),{method:T,body:JSON.stringify(O)});c.include_docs&&c.attachments&&c.binary&&m.data.rows.forEach(Pn),w(null,m.data)}catch(m){w(m)}}),n._changes=function(c){let w="batch_size"in c?c.batch_size:jc;c=me(c),c.continuous&&!("heartbeat"in c)&&(c.heartbeat=Pc);let $="timeout"in c?c.timeout:30*1e3;"timeout"in c&&c.timeout&&$-c.timeout<Yt&&($=c.timeout+Yt),"heartbeat"in c&&c.heartbeat&&$-c.heartbeat<Yt&&($=c.heartbeat+Yt);let O={};"timeout"in c&&c.timeout&&(O.timeout=c.timeout);let T=typeof c.limit<"u"?c.limit:!1,k=T;if(c.style&&(O.style=c.style),(c.include_docs||c.filter&&typeof c.filter=="function")&&(O.include_docs=!0),c.attachments&&(O.attachments=!0),c.continuous&&(O.feed="longpoll"),c.seq_interval&&(O.seq_interval=c.seq_interval),c.conflicts&&(O.conflicts=!0),c.descending&&(O.descending=!0),c.update_seq&&(O.update_seq=!0),"heartbeat"in c&&c.heartbeat&&(O.heartbeat=c.heartbeat),c.filter&&typeof c.filter=="string"&&(O.filter=c.filter),c.view&&typeof c.view=="string"&&(O.filter="_view",O.view=c.view),c.query_params&&typeof c.query_params=="object")for(let M in c.query_params)Object.prototype.hasOwnProperty.call(c.query_params,M)&&(O[M]=c.query_params[M]);let m="GET",g;c.doc_ids?(O.filter="_doc_ids",m="POST",g={doc_ids:c.doc_ids}):c.selector&&(O.filter="_selector",m="POST",g={selector:c.selector});let f=new bu,d;const p=async function(M,D){if(c.aborted)return;O.since=M,typeof O.since=="object"&&(O.since=JSON.stringify(O.since)),c.descending?T&&(O.limit=k):O.limit=!T||k>w?w:k;let U=ge(r,"_changes"+Xt(O)),z={signal:f.signal,method:m,body:JSON.stringify(g)};if(d=M,!c.aborted)try{await h();const H=await a(U,z);D(null,H.data)}catch(H){D(H)}};let _={results:[]};const P=function(M,D){if(c.aborted)return;let U=0;if(D&&D.results){U=D.results.length,_.last_seq=D.last_seq;let H=null,A=null;typeof D.pending=="number"&&(H=D.pending),(typeof _.last_seq=="string"||typeof _.last_seq=="number")&&(A=_.last_seq),c.query_params,D.results=D.results.filter(function(E){k--;let q=jr(c)(E);return q&&(c.include_docs&&c.attachments&&c.binary&&Pn(E),c.return_docs&&_.results.push(E),c.onChange(E,H,A)),q})}else if(M){c.aborted=!0,c.complete(M);return}D&&D.last_seq&&(d=D.last_seq);let z=T&&k<=0||D&&U<w||c.descending;c.continuous&&!(T&&k<=0)||!z?Oe(function(){p(d,P)}):c.complete(null,_)};return p(c.since||0,P),{cancel:function(){c.aborted=!0,f.abort()}}},n.revsDiff=s("revsDiff",async function(c,w,$){typeof w=="function"&&($=w,w={});try{const O=await a(ge(r,"_revs_diff"),{method:"POST",body:JSON.stringify(c)});$(null,O.data)}catch(O){$(O)}}),n._close=function(c){c()},n._destroy=async function(c,w){try{const $=await a(ge(r,""),{method:"DELETE"});w(null,$)}catch($){$.status===404?w(null,{ok:!0}):w($)}}}sr.valid=function(){return!0};function Mc(t){t.adapter("http",sr,!1),t.adapter("https",sr,!1)}let xt=class Xo extends Error{constructor(e){super(),this.status=400,this.name="query_parse_error",this.message=e,this.error=!0;try{Error.captureStackTrace(this,Xo)}catch{}}},Zo=class Vo extends Error{constructor(e){super(),this.status=404,this.name="not_found",this.message=e,this.error=!0;try{Error.captureStackTrace(this,Vo)}catch{}}},es=class ts extends Error{constructor(e){super(),this.status=500,this.name="invalid_value",this.message=e,this.error=!0;try{Error.captureStackTrace(this,ts)}catch{}}};function ns(t,e){return e&&t.then(function(n){Oe(function(){e(null,n)})},function(n){Oe(function(){e(n)})}),t}function Nc(t){return function(...e){var n=e.pop(),r=t.apply(this,e);return typeof n=="function"&&ns(r,n),r}}function Uc(t,e){return t.then(function(n){return e().then(function(){return n})},function(n){return e().then(function(){throw n})})}function Rn(t,e){return function(){var n=arguments,r=this;return t.add(function(){return e.apply(r,n)})}}function $i(t){var e=new $t(t),n=new Array(e.size),r=-1;return e.forEach(function(i){n[++r]=i}),n}function Bn(t){var e=new Array(t.size),n=-1;return t.forEach(function(r,i){e[++n]=i}),e}function Si(t){var e="builtin "+t+" function requires map values to be numbers or number arrays";return new es(e)}function ar(t){for(var e=0,n=0,r=t.length;n<r;n++){var i=t[n];if(typeof i!="number")if(Array.isArray(i)){e=typeof e=="number"?[e]:e;for(var o=0,s=i.length;o<s;o++){var a=i[o];if(typeof a!="number")throw Si("_sum");typeof e[o]>"u"?e.push(a):e[o]+=a}}else throw Si("_sum");else typeof e=="number"?e+=i:e[0]+=i}return e}var Fc=De.bind(null,"log"),Kc=Array.isArray,Qc=JSON.parse;function rs(t,e){return Dr("return ("+t.replace(/;\s*$/,"")+");",{emit:e,sum:ar,log:Fc,isArray:Kc,toJSON:Qc})}let ur=class{constructor(){this.promise=new Promise(function(e){e()})}add(e){return this.promise=this.promise.catch(function(){}).then(function(){return e()}),this.promise}finish(){return this.promise}};function ki(t){if(!t)return"undefined";switch(typeof t){case"function":return t.toString();case"string":return t.toString();default:return JSON.stringify(t)}}function Wc(t,e){return ki(t)+ki(e)+"undefined"}async function Ai(t,e,n,r,i,o){const s=Wc(n,r);let a;if(!i&&(a=t._cachedViews=t._cachedViews||{},a[s]))return a[s];const u=t.info().then(async function(h){const y=h.db_name+"-mrview-"+(i?"temp":Io(s));function c(k){k.views=k.views||{};let m=e;m.indexOf("/")===-1&&(m=e+"/"+e);const g=k.views[m]=k.views[m]||{};if(!g[y])return g[y]=!0,k}await un(t,"_local/"+o,c);const $=(await t.registerDependentDatabase(y)).db;$.auto_compaction=!0;const O={name:y,db:$,sourceDB:t,adapter:t.adapter,mapFun:n,reduceFun:r};let T;try{T=await O.db.get("_local/lastSeq")}catch(k){if(k.status!==404)throw k}return O.seq=T?T.seq:0,a&&O.db.once("destroyed",function(){delete a[s]}),O});return a&&(a[s]=u),u}var Oi={},Ei=new ur,zc=50;function Ln(t){return t.indexOf("/")===-1?[t,t]:t.split("/")}function Gc(t){return t.length===1&&/^1-/.test(t[0].rev)}function xi(t,e,n){try{t.emit("error",e)}catch{De("error",`The user's map/reduce function threw an uncaught error.
You can debug this error by doing:
myDatabase.on('error', function (err) { debugger; });
Please double-check your map/reduce function.`),De("error",e,n)}}function Jc(t,e,n,r){function i(l,v,b){try{v(b)}catch(S){xi(l,S,{fun:v,doc:b})}}function o(l,v,b,S,I){try{return{output:v(b,S,I)}}catch(L){return xi(l,L,{fun:v,keys:b,values:S,rereduce:I}),{error:L}}}function s(l,v){const b=de(l.key,v.key);return b!==0?b:de(l.value,v.value)}function a(l,v,b){return b=b||0,typeof v=="number"?l.slice(b,v+b):b>0?l.slice(b):l}function u(l){const v=l.value;return v&&typeof v=="object"&&v._id||l.id}function h(l){l.rows.forEach(function(v){const b=v.doc&&v.doc._attachments;b&&Object.keys(b).forEach(function(S){const I=b[S];b[S].data=Lr(I.data,I.content_type)})})}function y(l){return function(v){return l.include_docs&&l.attachments&&l.binary&&h(v),v}}function c(l,v,b,S){let I=v[l];typeof I<"u"&&(S&&(I=encodeURIComponent(JSON.stringify(I))),b.push(l+"="+I))}function w(l){if(typeof l<"u"){const v=Number(l);return!isNaN(v)&&v===parseInt(l,10)?v:l}}function $(l){return l.group_level=w(l.group_level),l.limit=w(l.limit),l.skip=w(l.skip),l}function O(l){if(l){if(typeof l!="number")return new xt(`Invalid value for integer: "${l}"`);if(l<0)return new xt(`Invalid value for positive integer: "${l}"`)}}function T(l,v){const b=l.descending?"endkey":"startkey",S=l.descending?"startkey":"endkey";if(typeof l[b]<"u"&&typeof l[S]<"u"&&de(l[b],l[S])>0)throw new xt("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(v.reduce&&l.reduce!==!1){if(l.include_docs)throw new xt("{include_docs:true} is invalid for reduce");if(l.keys&&l.keys.length>1&&!l.group&&!l.group_level)throw new xt("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(I){const L=O(l[I]);if(L)throw L})}async function k(l,v,b){let S=[],I,L="GET",Q;if(c("reduce",b,S),c("include_docs",b,S),c("attachments",b,S),c("limit",b,S),c("descending",b,S),c("group",b,S),c("group_level",b,S),c("skip",b,S),c("stale",b,S),c("conflicts",b,S),c("startkey",b,S,!0),c("start_key",b,S,!0),c("endkey",b,S,!0),c("end_key",b,S,!0),c("inclusive_end",b,S),c("key",b,S,!0),c("update_seq",b,S),S=S.join("&"),S=S===""?"":"?"+S,typeof b.keys<"u"){const B=`keys=${encodeURIComponent(JSON.stringify(b.keys))}`;B.length+S.length+1<=2e3?S+=(S[0]==="?"?"&":"?")+B:(L="POST",typeof v=="string"?I={keys:b.keys}:v.keys=b.keys)}if(typeof v=="string"){const C=Ln(v),B=await l.fetch("_design/"+C[0]+"/_view/"+C[1]+S,{headers:new _t({"Content-Type":"application/json"}),method:L,body:JSON.stringify(I)});Q=B.ok;const F=await B.json();if(!Q)throw F.status=B.status,kt(F);return F.rows.forEach(function(K){if(K.value&&K.value.error&&K.value.error==="builtin_reduce_error")throw new Error(K.reason)}),new Promise(function(K){K(F)}).then(y(b))}I=I||{},Object.keys(v).forEach(function(C){Array.isArray(v[C])?I[C]=v[C]:I[C]=v[C].toString()});const j=await l.fetch("_temp_view"+S,{headers:new _t({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(I)});Q=j.ok;const x=await j.json();if(!Q)throw x.status=j.status,kt(x);return new Promise(function(C){C(x)}).then(y(b))}function m(l,v,b){return new Promise(function(S,I){l._query(v,b,function(L,Q){if(L)return I(L);S(Q)})})}function g(l){return new Promise(function(v,b){l._viewCleanup(function(S,I){if(S)return b(S);v(I)})})}function f(l){return function(v){if(v.status===404)return l;throw v}}async function d(l,v,b){const S="_local/doc_"+l,I={_id:S,keys:[]},L=b.get(l),Q=L[0],j=L[1];function x(){return Gc(j)?Promise.resolve(I):v.db.get(S).catch(f(I))}function C(X){return X.keys.length?v.db.allDocs({keys:X.keys,include_docs:!0}):Promise.resolve({rows:[]})}function B(X,ie){const ae=[],ye=new $t;for(let W=0,J=ie.rows.length;W<J;W++){const re=ie.rows[W].doc;if(re&&(ae.push(re),ye.add(re._id),re._deleted=!Q.has(re._id),!re._deleted)){const V=Q.get(re._id);"value"in V&&(re.value=V.value)}}const ke=Bn(Q);return ke.forEach(function(W){if(!ye.has(W)){const J={_id:W},Y=Q.get(W);"value"in Y&&(J.value=Y.value),ae.push(J)}}),X.keys=$i(ke.concat(X.keys)),ae.push(X),ae}const F=await x(),K=await C(F);return B(F,K)}function p(l){return l.sourceDB.get("_local/purges").then(function(v){const b=v.purgeSeq;return l.db.get("_local/purgeSeq").then(function(S){return S._rev}).catch(function(S){if(S.status!==404)throw S}).then(function(S){return l.db.put({_id:"_local/purgeSeq",_rev:S,purgeSeq:b})})}).catch(function(v){if(v.status!==404)throw v})}function _(l,v,b){var S="_local/lastSeq";return l.db.get(S).catch(f({_id:S,seq:0})).then(function(I){var L=Bn(v);return Promise.all(L.map(function(Q){return d(Q,l,v)})).then(function(Q){var j=an(Q);return I.seq=b,j.push(I),l.db.bulkDocs({docs:j})}).then(()=>p(l))})}function P(l){const v=typeof l=="string"?l:l.name;let b=Oi[v];return b||(b=Oi[v]=new ur),b}async function M(l,v){return Rn(P(l),function(){return D(l,v)})()}async function D(l,v){let b,S,I;function L(W,J){const Y={id:S._id,key:ct(W)};typeof J<"u"&&J!==null&&(Y.value=ct(J)),b.push(Y)}const Q=e(l.mapFun,L);let j=l.seq||0;function x(){return l.sourceDB.info().then(function(W){I=l.sourceDB.activeTasks.add({name:"view_indexing",total_items:W.update_seq-j})})}function C(W,J){return function(){return _(l,W,J)}}let B=0;const F={view:l.name,indexed_docs:B};l.sourceDB.emit("indexing",F);const K=new ur;async function X(){const W=await l.sourceDB.changes({return_docs:!0,conflicts:!0,include_docs:!0,style:"all_docs",since:j,limit:v.changes_batch_size}),J=await ie();return ae(W,J)}function ie(){return l.db.get("_local/purgeSeq").then(function(W){return W.purgeSeq}).catch(function(W){if(W&&W.status!==404)throw W;return-1}).then(function(W){return l.sourceDB.get("_local/purges").then(function(J){const Y=J.purges.filter(function(V,Z){return Z>W}).map(V=>V.docId),re=Y.filter(function(V,Z){return Y.indexOf(V)===Z});return Promise.all(re.map(function(V){return l.sourceDB.get(V).then(function(Z){return{docId:V,doc:Z}}).catch(function(Z){if(Z.status!==404)throw Z;return{docId:V}})}))}).catch(function(J){if(J&&J.status!==404)throw J;return[]})})}function ae(W,J){var Y=W.results;if(!Y.length&&!J.length)return;for(let Z of J)if(Y.findIndex(function(Pe){return Pe.id===Z.docId})<0){const Pe={_id:Z.docId,doc:{_id:Z.docId,_deleted:1},changes:[]};Z.doc&&(Pe.doc=Z.doc,Pe.changes.push({rev:Z.doc._rev})),Y.push(Pe)}var re=ye(Y);K.add(C(re,j)),B=B+Y.length;const V={view:l.name,last_seq:W.last_seq,results_count:Y.length,indexed_docs:B};if(l.sourceDB.emit("indexing",V),l.sourceDB.activeTasks.update(I,{completed_items:B}),!(Y.length<v.changes_batch_size))return X()}function ye(W){const J=new Ee;for(let Y=0,re=W.length;Y<re;Y++){const V=W[Y];if(V.doc._id[0]!=="_"){b=[],S=V.doc,S._deleted||i(l.sourceDB,Q,S),b.sort(s);const Z=ke(b);J.set(V.doc._id,[Z,V.changes])}j=V.seq}return J}function ke(W){const J=new Ee;let Y;for(let re=0,V=W.length;re<V;re++){const Z=W[re],He=[Z.key,Z.id];re>0&&de(Z.key,Y)===0&&He.push(re),J.set(Re(He),Z),Y=Z.key}return J}try{await x(),await X(),await K.finish(),l.seq=j,l.sourceDB.activeTasks.remove(I)}catch(W){l.sourceDB.activeTasks.remove(I,W)}}function U(l,v,b){b.group_level===0&&delete b.group_level;const S=b.group||b.group_level,I=n(l.reduceFun),L=[],Q=isNaN(b.group_level)?Number.POSITIVE_INFINITY:b.group_level;v.forEach(function(j){const x=L[L.length-1];let C=S?j.key:null;if(S&&Array.isArray(C)&&(C=C.slice(0,Q)),x&&de(x.groupKey,C)===0){x.keys.push([j.key,j.id]),x.values.push(j.value);return}L.push({keys:[[j.key,j.id]],values:[j.value],groupKey:C})}),v=[];for(let j=0,x=L.length;j<x;j++){const C=L[j],B=o(l.sourceDB,I,C.keys,C.values,!1);if(B.error&&B.error instanceof es)throw B.error;v.push({value:B.error?null:B.output,key:C.groupKey})}return{rows:a(v,b.limit,b.skip)}}function z(l,v){return Rn(P(l),function(){return H(l,v)})()}async function H(l,v){let b;const S=l.reduceFun&&v.reduce!==!1,I=v.skip||0;typeof v.keys<"u"&&!v.keys.length&&(v.limit=0,delete v.keys);async function L(j){j.include_docs=!0;const x=await l.db.allDocs(j);return b=x.total_rows,x.rows.map(function(C){if("value"in C.doc&&typeof C.doc.value=="object"&&C.doc.value!==null){const F=Object.keys(C.doc.value).sort(),K=["id","key","value"];if(!(F<K||F>K))return C.doc.value}const B=Mu(C.doc._id);return{key:B[0],id:B[1],value:"value"in C.doc?C.doc.value:null}})}async function Q(j){let x;if(S?x=U(l,j,v):typeof v.keys>"u"?x={total_rows:b,offset:I,rows:j}:x={total_rows:b,offset:I,rows:a(j,v.limit,v.skip)},v.update_seq&&(x.update_seq=l.seq),v.include_docs){const B=$i(j.map(u)),F=await l.sourceDB.allDocs({keys:B,include_docs:!0,conflicts:v.conflicts,attachments:v.attachments,binary:v.binary});var C=new Ee;return F.rows.forEach(function(K){C.set(K.id,K.doc)}),j.forEach(function(K){var X=u(K),ie=C.get(X);ie&&(K.doc=ie)}),x}else return x}if(typeof v.keys<"u"){const x=v.keys.map(function(F){const K={startkey:Re([F]),endkey:Re([F,{}])};return v.update_seq&&(K.update_seq=!0),L(K)}),C=await Promise.all(x),B=an(C);return Q(B)}else{const j={descending:v.descending};v.update_seq&&(j.update_seq=!0);let x,C;if("start_key"in v&&(x=v.start_key),"startkey"in v&&(x=v.startkey),"end_key"in v&&(C=v.end_key),"endkey"in v&&(C=v.endkey),typeof x<"u"&&(j.startkey=v.descending?Re([x,{}]):Re([x])),typeof C<"u"){let F=v.inclusive_end!==!1;v.descending&&(F=!F),j.endkey=Re(F?[C,{}]:[C])}if(typeof v.key<"u"){const F=Re([v.key]),K=Re([v.key,{}]);j.descending?(j.endkey=F,j.startkey=K):(j.startkey=F,j.endkey=K)}S||(typeof v.limit=="number"&&(j.limit=v.limit),j.skip=I);const B=await L(j);return Q(B)}}async function A(l){return(await l.fetch("_view_cleanup",{headers:new _t({"Content-Type":"application/json"}),method:"POST"})).json()}async function E(l){try{const v=await l.get("_local/"+t),b=new Ee;Object.keys(v.views).forEach(function(x){const C=Ln(x),B="_design/"+C[0],F=C[1];let K=b.get(B);K||(K=new $t,b.set(B,K)),K.add(F)});const S={keys:Bn(b),include_docs:!0},I=await l.allDocs(S),L={};I.rows.forEach(function(x){const C=x.key.substring(8);b.get(x.key).forEach(function(B){let F=C+"/"+B;v.views[F]||(F=B);const K=Object.keys(v.views[F]),X=x.doc&&x.doc.views&&x.doc.views[B];K.forEach(function(ie){L[ie]=L[ie]||X})})});const j=Object.keys(L).filter(function(x){return!L[x]}).map(function(x){return Rn(P(x),function(){return new l.constructor(x,l.__opts).destroy()})()});return Promise.all(j).then(function(){return{ok:!0}})}catch(v){if(v.status===404)return{ok:!0};throw v}}async function q(l,v,b){if(typeof l._query=="function")return m(l,v,b);if(Fe(l))return k(l,v,b);const S={changes_batch_size:l.__opts.view_update_changes_batch_size||zc};if(typeof v!="string")return T(b,v),Ei.add(async function(){const I=await Ai(l,"temp_view/temp_view",v.map,v.reduce,!0,t);return Uc(M(I,S).then(function(){return z(I,b)}),function(){return I.db.destroy()})}),Ei.finish();{const I=v,L=Ln(I),Q=L[0],j=L[1],x=await l.get("_design/"+Q);if(v=x.views&&x.views[j],!v)throw new Zo(`ddoc ${x._id} has no view named ${j}`);r(x,j),T(b,v);const C=await Ai(l,I,v.map,v.reduce,!1,t);return b.stale==="ok"||b.stale==="update_after"?(b.stale==="update_after"&&Oe(function(){M(C,S)}),z(C,b)):(await M(C,S),z(C,b))}}function N(l,v,b){const S=this;typeof v=="function"&&(b=v,v={}),v=v?$(v):{},typeof l=="function"&&(l={map:l});const I=Promise.resolve().then(function(){return q(S,l,v)});return ns(I,b),I}const R=Nc(function(){const l=this;return typeof l._viewCleanup=="function"?g(l):Fe(l)?A(l):E(l)});return{query:N,viewCleanup:R}}var Mn={_sum:function(t,e){return ar(e)},_count:function(t,e){return e.length},_stats:function(t,e){function n(r){for(var i=0,o=0,s=r.length;o<s;o++){var a=r[o];i+=a*a}return i}return{sum:ar(e),min:Math.min.apply(null,e),max:Math.max.apply(null,e),count:e.length,sumsqr:n(e)}}};function Hc(t){if(/^_sum/.test(t))return Mn._sum;if(/^_count/.test(t))return Mn._count;if(/^_stats/.test(t))return Mn._stats;if(/^_/.test(t))throw new Error(t+" is not a supported reduce function.")}function Yc(t,e){if(typeof t=="function"&&t.length===2){var n=t;return function(r){return n(r,e)}}else return rs(t.toString(),e)}function Xc(t){var e=t.toString(),n=Hc(e);return n||rs(e)}function Zc(t,e){var n=t.views&&t.views[e];if(typeof n.map!="string")throw new Zo("ddoc "+t._id+" has no string view named "+e+", instead found object of type: "+typeof n.map)}var Vc="mrviews",is=Jc(Vc,Yc,Xc,Zc);function ef(t,e,n){return is.query.call(this,t,e,n)}function tf(t){return is.viewCleanup.call(this,t)}var nf={query:ef,viewCleanup:tf};function rf(t,e,n){return!t._attachments||!t._attachments[n]||t._attachments[n].digest!==e._attachments[n].digest}function Ci(t,e){var n=Object.keys(e._attachments);return Promise.all(n.map(function(r){return t.getAttachment(e._id,r,{rev:e._rev})}))}function of(t,e,n){var r=Fe(e)&&!Fe(t),i=Object.keys(n._attachments);return r?t.get(n._id).then(function(o){return Promise.all(i.map(function(s){return rf(o,n,s)?e.getAttachment(n._id,s):t.getAttachment(o._id,s)}))}).catch(function(o){if(o.status!==404)throw o;return Ci(e,n)}):Ci(e,n)}function sf(t){var e=[];return Object.keys(t).forEach(function(n){var r=t[n].missing;r.forEach(function(i){e.push({id:n,rev:i})})}),{docs:e,revs:!0,latest:!0}}function af(t,e,n,r){n=me(n);var i=[],o=!0;function s(){var u=sf(n);if(u.docs.length)return t.bulkGet(u).then(function(h){if(r.cancelled)throw new Error("cancelled");return Promise.all(h.results.map(function(y){return Promise.all(y.docs.map(function(c){var w=c.ok;return c.error&&(o=!1),!w||!w._attachments?w:of(e,t,w).then(function($){var O=Object.keys(w._attachments);return $.forEach(function(T,k){var m=w._attachments[O[k]];delete m.stub,delete m.length,m.data=T}),w})}))})).then(function(y){i=i.concat(an(y).filter(Boolean))})})}function a(){return{ok:o,docs:i}}return Promise.resolve().then(s).then(a)}var Ii=1,Ti="pouchdb",uf=5,Ne=0;function cr(t,e,n,r,i){return t.get(e).catch(function(o){if(o.status===404)return(t.adapter==="http"||t.adapter==="https")&&Jn(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:r,_id:e,history:[],replicator:Ti,version:Ii};throw o}).then(function(o){if(!i.cancelled&&o.last_seq!==n)return o.history=(o.history||[]).filter(function(s){return s.session_id!==r}),o.history.unshift({last_seq:n,session_id:r}),o.history=o.history.slice(0,uf),o.version=Ii,o.replicator=Ti,o.session_id=r,o.last_seq=n,t.put(o).catch(function(s){if(s.status===409)return cr(t,e,n,r,i);throw s})})}class qi{constructor(e,n,r,i,o){this.src=e,this.target=n,this.id=r,this.returnValue=i,this.opts=o||{}}writeCheckpoint(e,n){var r=this;return this.updateTarget(e,n).then(function(){return r.updateSource(e,n)})}updateTarget(e,n){return this.opts.writeTargetCheckpoint?cr(this.target,this.id,e,n,this.returnValue):Promise.resolve(!0)}updateSource(e,n){if(this.opts.writeSourceCheckpoint){var r=this;return cr(this.src,this.id,e,n,this.returnValue).catch(function(i){if(Di(i))return r.opts.writeSourceCheckpoint=!1,!0;throw i})}else return Promise.resolve(!0)}getCheckpoint(){var e=this;return e.opts&&e.opts.writeSourceCheckpoint&&!e.opts.writeTargetCheckpoint?e.src.get(e.id).then(function(n){return n.last_seq||Ne}).catch(function(n){if(n.status!==404)throw n;return Ne}):e.target.get(e.id).then(function(n){return e.opts&&e.opts.writeTargetCheckpoint&&!e.opts.writeSourceCheckpoint?n.last_seq||Ne:e.src.get(e.id).then(function(r){if(n.version!==r.version)return Ne;var i;return n.version?i=n.version.toString():i="undefined",i in ji?ji[i](n,r):Ne},function(r){if(r.status===404&&n.last_seq)return e.src.put({_id:e.id,last_seq:Ne}).then(function(){return Ne},function(i){return Di(i)?(e.opts.writeSourceCheckpoint=!1,n.last_seq):Ne});throw r})}).catch(function(n){if(n.status!==404)throw n;return Ne})}}var ji={undefined:function(t,e){return de(t.last_seq,e.last_seq)===0?e.last_seq:0},1:function(t,e){return cf(e,t).last_seq}};function cf(t,e){return t.session_id===e.session_id?{last_seq:t.last_seq,history:t.history}:os(t.history,e.history)}function os(t,e){var n=t[0],r=t.slice(1),i=e[0],o=e.slice(1);if(!n||e.length===0)return{last_seq:Ne,history:[]};var s=n.session_id;if(fr(s,e))return{last_seq:n.last_seq,history:t};var a=i.session_id;return fr(a,r)?{last_seq:i.last_seq,history:o}:os(r,o)}function fr(t,e){var n=e[0],r=e.slice(1);return!t||e.length===0?!1:t===n.session_id?!0:fr(t,r)}function Di(t){return typeof t.status=="number"&&Math.floor(t.status/100)===4}function ss(t,e,n,r,i){return this instanceof qi?ss:new qi(t,e,n,r,i)}var Pi=0;function ff(t,e,n,r){if(t.retry===!1){e.emit("error",n),e.removeAllListeners();return}if(typeof t.back_off_function!="function"&&(t.back_off_function=Ta),e.emit("requestError",n),e.state==="active"||e.state==="pending"){e.emit("paused",n),e.state="stopped";var i=function(){t.current_back_off=Pi},o=function(){e.removeListener("active",i)};e.once("paused",o),e.once("active",i)}t.current_back_off=t.current_back_off||Pi,t.current_back_off=t.back_off_function(t.current_back_off),setTimeout(r,t.current_back_off)}function lf(t){return Object.keys(t).sort(de).reduce(function(e,n){return e[n]=t[n],e},{})}function df(t,e,n){var r=n.doc_ids?n.doc_ids.sort(de):"",i=n.filter?n.filter.toString():"",o="",s="",a="";return n.selector&&(a=JSON.stringify(n.selector)),n.filter&&n.query_params&&(o=JSON.stringify(lf(n.query_params))),n.filter&&n.filter==="_view"&&(s=n.view.toString()),Promise.all([t.id(),e.id()]).then(function(u){var h=u[0]+u[1]+i+s+o+r+a;return new Promise(function(y){Nr(h,y)})}).then(function(u){return u=u.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+u})}function as(t,e,n,r,i){var o=[],s,a={seq:0,changes:[],docs:[]},u=!1,h=!1,y=!1,c=0,w=0,$=n.continuous||n.live||!1,O=n.batch_size||100,T=n.batches_limit||10,k=n.style||"all_docs",m=!1,g=n.doc_ids,f=n.selector,d,p,_=[],P=wn(),M;i=i||{ok:!0,start_time:new Date().toISOString(),docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var D={};r.ready(t,e);function U(){return p?Promise.resolve():df(t,e,n).then(function(x){d=x;var C={};n.checkpoint===!1?C={writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:n.checkpoint==="source"?C={writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:n.checkpoint==="target"?C={writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:C={writeSourceCheckpoint:!0,writeTargetCheckpoint:!0},p=new ss(t,e,d,r,C)})}function z(){if(_=[],s.docs.length!==0){var x=s.docs,C={timeout:n.timeout};return e.bulkDocs({docs:x,new_edits:!1},C).then(function(B){if(r.cancelled)throw l(),new Error("cancelled");var F=Object.create(null);B.forEach(function(X){X.error&&(F[X.id]=X)});var K=Object.keys(F).length;i.doc_write_failures+=K,i.docs_written+=x.length-K,x.forEach(function(X){var ie=F[X._id];if(ie){i.errors.push(ie);var ae=(ie.name||"").toLowerCase();if(ae==="unauthorized"||ae==="forbidden")r.emit("denied",me(ie));else throw ie}else _.push(X)})},function(B){throw i.doc_write_failures+=x.length,B})}}function H(){if(s.error)throw new Error("There was a problem getting docs.");i.last_seq=w=s.seq;var x=me(i);return _.length&&(x.docs=_,typeof s.pending=="number"&&(x.pending=s.pending,delete s.pending),r.emit("change",x)),u=!0,t.info().then(function(C){var B=t.activeTasks.get(M);if(!(!s||!B)){var F=B.completed_items||0,K=parseInt(C.update_seq,10)-parseInt(c,10);t.activeTasks.update(M,{completed_items:F+s.changes.length,total_items:K})}}),p.writeCheckpoint(s.seq,P).then(function(){if(r.emit("checkpoint",{checkpoint:s.seq}),u=!1,r.cancelled)throw l(),new Error("cancelled");s=void 0,I()}).catch(function(C){throw j(C),C})}function A(){var x={};return s.changes.forEach(function(C){r.emit("checkpoint",{revs_diff:C}),C.id!=="_user/"&&(x[C.id]=C.changes.map(function(B){return B.rev}))}),e.revsDiff(x).then(function(C){if(r.cancelled)throw l(),new Error("cancelled");s.diffs=C})}function E(){return af(t,e,s.diffs,r).then(function(x){s.error=!x.ok,x.docs.forEach(function(C){delete s.diffs[C._id],i.docs_read++,s.docs.push(C)})})}function q(){if(!(r.cancelled||s)){if(o.length===0){N(!0);return}s=o.shift(),r.emit("checkpoint",{start_next_batch:s.seq}),A().then(E).then(z).then(H).then(q).catch(function(x){R("batch processing terminated with error",x)})}}function N(x){if(a.changes.length===0){o.length===0&&!s&&(($&&D.live||h)&&(r.state="pending",r.emit("paused")),h&&l());return}(x||h||a.changes.length>=O)&&(o.push(a),a={seq:0,changes:[],docs:[]},(r.state==="pending"||r.state==="stopped")&&(r.state="active",r.emit("active")),q())}function R(x,C){y||(C.message||(C.message=x),i.ok=!1,i.status="aborting",o=[],a={seq:0,changes:[],docs:[]},l(C))}function l(x){if(!y&&!(r.cancelled&&(i.status="cancelled",u)))if(i.status=i.status||"complete",i.end_time=new Date().toISOString(),i.last_seq=w,y=!0,t.activeTasks.remove(M,x),x){x=ne(x),x.result=i;var C=(x.name||"").toLowerCase();C==="unauthorized"||C==="forbidden"?(r.emit("error",x),r.removeAllListeners()):ff(n,r,x,function(){as(t,e,n,r)})}else r.emit("complete",i),r.removeAllListeners()}function v(x,C,B){if(r.cancelled)return l();typeof C=="number"&&(a.pending=C);var F=jr(n)(x);if(!F){var K=t.activeTasks.get(M);if(K){var X=K.completed_items||0;t.activeTasks.update(M,{completed_items:++X})}return}a.seq=x.seq||B,a.changes.push(x),r.emit("checkpoint",{pending_batch:a.seq}),Oe(function(){N(o.length===0&&D.live)})}function b(x){if(m=!1,r.cancelled)return l();if(x.results.length>0)D.since=x.results[x.results.length-1].seq,I(),N(!0);else{var C=function(){$?(D.live=!0,I()):h=!0,N(!0)};!s&&x.results.length===0?(u=!0,p.writeCheckpoint(x.last_seq,P).then(function(){if(u=!1,i.last_seq=w=x.last_seq,r.cancelled)throw l(),new Error("cancelled");C()}).catch(j)):C()}}function S(x){if(m=!1,r.cancelled)return l();R("changes rejected",x)}function I(){if(!(!m&&!h&&o.length<T))return;m=!0;function x(){B.cancel()}function C(){r.removeListener("cancel",x)}r._changes&&(r.removeListener("cancel",r._abortChanges),r._changes.cancel()),r.once("cancel",x);var B=t.changes(D).on("change",v);B.then(C,C),B.then(b).catch(S),n.retry&&(r._changes=B,r._abortChanges=x)}function L(x){return t.info().then(function(C){var B=typeof n.since>"u"?parseInt(C.update_seq,10)-parseInt(x,10):parseInt(C.update_seq,10);return M=t.activeTasks.add({name:`${$?"continuous ":""}replication from ${C.db_name}`,total_items:B}),x})}function Q(){U().then(function(){if(r.cancelled){l();return}return p.getCheckpoint().then(L).then(function(x){w=x,c=x,D={since:w,limit:O,batch_size:O,style:k,doc_ids:g,selector:f,return_docs:!0},n.filter&&(typeof n.filter!="string"?D.include_docs=!0:D.filter=n.filter),"heartbeat"in n&&(D.heartbeat=n.heartbeat),"timeout"in n&&(D.timeout=n.timeout),n.query_params&&(D.query_params=n.query_params),n.view&&(D.view=n.view),I()})}).catch(function(x){R("getCheckpoint rejected with ",x)})}function j(x){u=!1,R("writeCheckpoint completed with error",x)}if(r.cancelled){l();return}r._addedListeners||(r.once("cancel",l),typeof n.complete=="function"&&(r.once("error",n.complete),r.once("complete",function(x){n.complete(null,x)})),r._addedListeners=!0),typeof n.since>"u"?Q():U().then(function(){return u=!0,p.writeCheckpoint(n.since,P)}).then(function(){if(u=!1,r.cancelled){l();return}w=n.since,Q()}).catch(j)}class hf extends je{constructor(){super(),this.cancelled=!1,this.state="pending";const e=new Promise((n,r)=>{this.once("complete",n),this.once("error",r)});this.then=function(n,r){return e.then(n,r)},this.catch=function(n){return e.catch(n)},this.catch(function(){})}cancel(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")}ready(e,n){if(this._readyCalled)return;this._readyCalled=!0;const r=()=>{this.cancel()};e.once("destroyed",r),n.once("destroyed",r);function i(){e.removeListener("destroyed",r),n.removeListener("destroyed",r)}this.once("complete",i),this.once("error",i)}}function ln(t,e){var n=e.PouchConstructor;return typeof t=="string"?new n(t,e):t}function lr(t,e,n,r){if(typeof n=="function"&&(r=n,n={}),typeof n>"u"&&(n={}),n.doc_ids&&!Array.isArray(n.doc_ids))throw ne(_n,"`doc_ids` filter parameter is not a list.");n.complete=r,n=me(n),n.continuous=n.continuous||n.live,n.retry="retry"in n?n.retry:!1,n.PouchConstructor=n.PouchConstructor||this;var i=new hf(n),o=ln(t,n),s=ln(e,n);return as(o,s,n,i),i}function vf(t,e,n,r){return typeof n=="function"&&(r=n,n={}),typeof n>"u"&&(n={}),n=me(n),n.PouchConstructor=n.PouchConstructor||this,t=ln(t,n),e=ln(e,n),new pf(t,e,n,r)}class pf extends je{constructor(e,n,r,i){super(),this.canceled=!1;const o=r.push?st({},r,r.push):r,s=r.pull?st({},r,r.pull):r;this.push=lr(e,n,o),this.pull=lr(n,e,s),this.pushPaused=!0,this.pullPaused=!0;const a=f=>{this.emit("change",{direction:"pull",change:f})},u=f=>{this.emit("change",{direction:"push",change:f})},h=f=>{this.emit("denied",{direction:"push",doc:f})},y=f=>{this.emit("denied",{direction:"pull",doc:f})},c=()=>{this.pushPaused=!0,this.pullPaused&&this.emit("paused")},w=()=>{this.pullPaused=!0,this.pushPaused&&this.emit("paused")},$=()=>{this.pushPaused=!1,this.pullPaused&&this.emit("active",{direction:"push"})},O=()=>{this.pullPaused=!1,this.pushPaused&&this.emit("active",{direction:"pull"})};let T={};const k=f=>(d,p)=>{(d==="change"&&(p===a||p===u)||d==="denied"&&(p===y||p===h)||d==="paused"&&(p===w||p===c)||d==="active"&&(p===O||p===$))&&(d in T||(T[d]={}),T[d][f]=!0,Object.keys(T[d]).length===2&&this.removeAllListeners(d))};r.live&&(this.push.on("complete",this.pull.cancel.bind(this.pull)),this.pull.on("complete",this.push.cancel.bind(this.push)));function m(f,d,p){f.listeners(d).indexOf(p)==-1&&f.on(d,p)}this.on("newListener",function(f){f==="change"?(m(this.pull,"change",a),m(this.push,"change",u)):f==="denied"?(m(this.pull,"denied",y),m(this.push,"denied",h)):f==="active"?(m(this.pull,"active",O),m(this.push,"active",$)):f==="paused"&&(m(this.pull,"paused",w),m(this.push,"paused",c))}),this.on("removeListener",function(f){f==="change"?(this.pull.removeListener("change",a),this.push.removeListener("change",u)):f==="denied"?(this.pull.removeListener("denied",y),this.push.removeListener("denied",h)):f==="active"?(this.pull.removeListener("active",O),this.push.removeListener("active",$)):f==="paused"&&(this.pull.removeListener("paused",w),this.push.removeListener("paused",c))}),this.pull.on("removeListener",k("pull")),this.push.on("removeListener",k("push"));const g=Promise.all([this.push,this.pull]).then(f=>{const d={push:f[0],pull:f[1]};return this.emit("complete",d),i&&i(null,d),this.removeAllListeners(),d},f=>{if(this.cancel(),i?i(f):this.emit("error",f),this.removeAllListeners(),i)throw f});this.then=function(f,d){return g.then(f,d)},this.catch=function(f){return g.catch(f)}}cancel(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())}}function yf(t){t.replicate=lr,t.sync=vf,Object.defineProperty(t.prototype,"replicate",{get:function(){var e=this;return typeof this.replicateMethods>"u"&&(this.replicateMethods={from:function(n,r,i){return e.constructor.replicate(n,e,r,i)},to:function(n,r,i){return e.constructor.replicate(e,n,r,i)}}),this.replicateMethods}}),t.prototype.sync=function(e,n,r){return this.constructor.sync(this,e,n,r)}}te.plugin(Tc).plugin(Mc).plugin(nf).plugin(yf);class ce extends Error{constructor(e,n,r){super(),this.status=e,this.name=n,this.message=r,this.error=!0}toString(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})}}new ce(401,"unauthorized","Name or password is incorrect.");new ce(400,"bad_request","Missing JSON list of 'docs'");new ce(404,"not_found","missing");new ce(409,"conflict","Document update conflict");new ce(400,"bad_request","_id field must contain a string");new ce(412,"missing_id","_id is required for puts");new ce(400,"bad_request","Only reserved document ids may start with underscore.");new ce(412,"precondition_failed","Database not open");var gf=new ce(500,"unknown_error","Database encountered an unknown error");new ce(500,"badarg","Some query argument is invalid");new ce(400,"invalid_request","Request was invalid");new ce(400,"query_parse_error","Some query parameter is invalid");new ce(500,"doc_validation","Bad special document member");new ce(400,"bad_request","Something wrong with the request");new ce(400,"bad_request","Document must be a JSON object");new ce(404,"not_found","Database not found");new ce(500,"indexed_db_went_bad","unknown");new ce(500,"web_sql_went_bad","unknown");new ce(500,"levelDB_went_went_bad","unknown");new ce(403,"forbidden","Forbidden by design doc validate_doc_update function");new ce(400,"bad_request","Invalid rev format");new ce(412,"file_exists","The database could not be created, the file already exists.");new ce(412,"missing_stub","A pre-existing attachment stub wasn't found");new ce(413,"invalid_url","Provided URL is invalid");function dr(t){if(typeof t!="object"){var e=t;t=gf,t.data=e}return"error"in t&&t.error==="conflict"&&(t.name="conflict",t.status=409),"name"in t||(t.name=t.error||"unknown"),"status"in t||(t.status=500),"message"in t||(t.message=t.message||t.reason),"stack"in t||(t.stack=new Error().stack),t}var en=Headers;function bn(t){return"$"+t}function us(t){return t.substring(1)}function ze(){this._store={}}ze.prototype.get=function(t){var e=bn(t);return this._store[e]};ze.prototype.set=function(t,e){var n=bn(t);return this._store[n]=e,!0};ze.prototype.has=function(t){var e=bn(t);return e in this._store};ze.prototype.keys=function(){return Object.keys(this._store).map(t=>us(t))};ze.prototype.delete=function(t){var e=bn(t),n=e in this._store;return delete this._store[e],n};ze.prototype.forEach=function(t){for(var e=Object.keys(this._store),n=0,r=e.length;n<r;n++){var i=e[n],o=this._store[i];i=us(i),t(o,i)}};Object.defineProperty(ze.prototype,"size",{get:function(){return Object.keys(this._store).length}});function Ft(t){if(this._store=new ze,t&&Array.isArray(t))for(var e=0,n=t.length;e<n;e++)this.add(t[e])}Ft.prototype.add=function(t){return this._store.set(t,!0)};Ft.prototype.has=function(t){return this._store.has(t)};Ft.prototype.forEach=function(t){this._store.forEach(function(e,n){t(n)})};Object.defineProperty(Ft.prototype,"size",{get:function(){return this._store.size}});function mf(){if(typeof Symbol>"u"||typeof Map>"u"||typeof Set>"u")return!1;var t=Object.getOwnPropertyDescriptor(Map,Symbol.species);return t&&"get"in t&&Map[Symbol.species]===Map}var Rt,yt;mf()?(Rt=Set,yt=Map):(Rt=Ft,yt=ze);var _f=function(t){return atob(t)};function wf(t,e){t=t||[],e=e||{};try{return new Blob(t,e)}catch(o){if(o.name!=="TypeError")throw o;for(var n=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,r=new n,i=0;i<t.length;i+=1)r.append(t[i]);return r.getBlob(e.type)}}function bf(t){for(var e=t.length,n=new ArrayBuffer(e),r=new Uint8Array(n),i=0;i<e;i++)r[i]=t.charCodeAt(i);return n}function $f(t,e){return wf([bf(t)],{type:e})}function Sf(t,e){return $f(_f(t),e)}function kf(t,e,n){for(var r="",i=n-t.length;r.length<i;)r+=e;return r}function Af(t,e,n){var r=kf(t,e,n);return r+t}var cs=-324,hr=3,vr="";function pe(t,e){if(t===e)return 0;t=ft(t),e=ft(e);var n=pr(t),r=pr(e);if(n-r!==0)return n-r;switch(typeof t){case"number":return t-e;case"boolean":return t<e?-1:1;case"string":return Tf(t,e)}return Array.isArray(t)?If(t,e):qf(t,e)}function ft(t){switch(typeof t){case"undefined":return null;case"number":return t===1/0||t===-1/0||isNaN(t)?null:t;case"object":var e=t;if(Array.isArray(t)){var n=t.length;t=new Array(n);for(var r=0;r<n;r++)t[r]=ft(e[r])}else{if(t instanceof Date)return t.toJSON();if(t!==null){t={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=e[i];typeof o<"u"&&(t[i]=ft(o))}}}}return t}function Of(t){if(t!==null)switch(typeof t){case"boolean":return t?1:0;case"number":return jf(t);case"string":return t.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var e=Array.isArray(t),n=e?t:Object.keys(t),r=-1,i=n.length,o="";if(e)for(;++r<i;)o+=Le(n[r]);else for(;++r<i;){var s=n[r];o+=Le(s)+Le(t[s])}return o}return""}function Le(t){var e="\0";return t=ft(t),pr(t)+vr+Of(t)+e}function Ef(t,e){var n=e,r,i=t[e]==="1";if(i)r=0,e++;else{var o=t[e]==="0";e++;var s="",a=t.substring(e,e+hr),u=parseInt(a,10)+cs;for(o&&(u=-u),e+=hr;;){var h=t[e];if(h==="\0")break;s+=h,e++}s=s.split("."),s.length===1?r=parseInt(s,10):r=parseFloat(s[0]+"."+s[1]),o&&(r=r-10),u!==0&&(r=parseFloat(r+"e"+u))}return{num:r,length:e-n}}function xf(t,e){var n=t.pop();if(e.length){var r=e[e.length-1];n===r.element&&(e.pop(),r=e[e.length-1]);var i=r.element,o=r.index;if(Array.isArray(i))i.push(n);else if(o===t.length-2){var s=t.pop();i[s]=n}else t.push(n)}}function Cf(t){for(var e=[],n=[],r=0;;){var i=t[r++];if(i==="\0"){if(e.length===1)return e.pop();xf(e,n);continue}switch(i){case"1":e.push(null);break;case"2":e.push(t[r]==="1"),r++;break;case"3":var o=Ef(t,r);e.push(o.num),r+=o.length;break;case"4":for(var s="";;){var a=t[r];if(a==="\0")break;s+=a,r++}s=s.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),e.push(s);break;case"5":var u={element:[],index:e.length};e.push(u.element),n.push(u);break;case"6":var h={element:{},index:e.length};e.push(h.element),n.push(h);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+i)}}}function If(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=pe(t[r],e[r]);if(i!==0)return i}return t.length===e.length?0:t.length>e.length?1:-1}function Tf(t,e){return t===e?0:t>e?1:-1}function qf(t,e){for(var n=Object.keys(t),r=Object.keys(e),i=Math.min(n.length,r.length),o=0;o<i;o++){var s=pe(n[o],r[o]);if(s!==0||(s=pe(t[n[o]],e[r[o]]),s!==0))return s}return n.length===r.length?0:n.length>r.length?1:-1}function pr(t){var e=["boolean","number","string","object"],n=e.indexOf(typeof t);if(~n)return t===null?1:Array.isArray(t)?5:n<3?n+2:n+3;if(Array.isArray(t))return 5}function jf(t){if(t===0)return"1";var e=t.toExponential().split(/e\+?/),n=parseInt(e[1],10),r=t<0,i=r?"0":"2",o=(r?-n:n)-cs,s=Af(o.toString(),"0",hr);i+=vr+s;var a=Math.abs(parseFloat(e[0]));r&&(a=10-a);var u=a.toFixed(20);return u=u.replace(/\.?0+$/,""),i+=vr+u,i}function fs(t){return on.hash(t)}function Df(t){return typeof ArrayBuffer<"u"&&t instanceof ArrayBuffer||typeof Blob<"u"&&t instanceof Blob}function Pf(t){if(typeof t.slice=="function")return t.slice(0);var e=new ArrayBuffer(t.byteLength),n=new Uint8Array(e),r=new Uint8Array(t);return n.set(r),e}function Rf(t){if(t instanceof ArrayBuffer)return Pf(t);var e=t.size,n=t.type;return typeof t.slice=="function"?t.slice(0,e,n):t.webkitSlice(0,e,n)}var ls=Function.prototype.toString,Bf=ls.call(Object);function Lf(t){var e=Object.getPrototypeOf(t);if(e===null)return!0;var n=e.constructor;return typeof n=="function"&&n instanceof n&&ls.call(n)==Bf}function Je(t){var e,n,r;if(!t||typeof t!="object")return t;if(Array.isArray(t)){for(e=[],n=0,r=t.length;n<r;n++)e[n]=Je(t[n]);return e}if(t instanceof Date&&isFinite(t))return t.toISOString();if(Df(t))return Rf(t);if(!Lf(t))return t;e={};for(n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var i=Je(t[n]);typeof i<"u"&&(e[n]=i)}return e}function Mf(t){var e=!1;return function(...n){if(e)throw new Error("once called more than once");e=!0,t.apply(this,n)}}function Kt(t){return function(...e){e=Je(e);var n=this,r=typeof e[e.length-1]=="function"?e.pop():!1,i=new Promise(function(o,s){var a;try{var u=Mf(function(h,y){h?s(h):o(y)});e.push(u),a=t.apply(n,e),a&&typeof a.then=="function"&&o(a)}catch(h){s(h)}});return r&&i.then(function(o){r(null,o)},r),i}}var Ri;try{localStorage.setItem("_pouch_check_localstorage",1),Ri=!!localStorage.getItem("_pouch_check_localstorage")}catch{Ri=!1}function yr(t){if(typeof console<"u"&&typeof console[t]=="function"){var e=Array.prototype.slice.call(arguments,1);console[t].apply(console,e)}}var gr;typeof Object.assign=="function"?gr=Object.assign:gr=function(t){for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(r!=null)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e};var Wr=gr;function Bi(t){for(var e=[],n=0,r=t.length;n<r;n++)e=e.concat(t[n]);return e}function lt(t){return typeof t._remote=="boolean"?t._remote:typeof t.type=="function"?(yr("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),t.type()==="http"):!1}function $n(t,e,n){return t.get(e).catch(function(r){if(r.status!==404)throw r;return{}}).then(function(r){var i=r._rev,o=n(r);return o?(o._id=e,o._rev=i,Nf(t,o,n)):{updated:!1,rev:i}})}function Nf(t,e,n){return t.put(e).then(function(r){return{updated:!0,rev:r.rev}},function(r){if(r.status!==409)throw r;return $n(t,e._id,n)})}class Ve extends Error{constructor(e){super(),this.status=400,this.name="query_parse_error",this.message=e,this.error=!0;try{Error.captureStackTrace(this,Ve)}catch{}}}class zr extends Error{constructor(e){super(),this.status=404,this.name="not_found",this.message=e,this.error=!0;try{Error.captureStackTrace(this,zr)}catch{}}}class Gr extends Error{constructor(e){super(),this.status=500,this.name="invalid_value",this.message=e,this.error=!0;try{Error.captureStackTrace(this,Gr)}catch{}}}function ds(t,e){return e&&t.then(function(n){Oe(function(){e(null,n)})},function(n){Oe(function(){e(n)})}),t}function Uf(t){return function(...e){var n=e.pop(),r=t.apply(this,e);return typeof n=="function"&&ds(r,n),r}}function Ff(t,e){return t.then(function(n){return e().then(function(){return n})},function(n){return e().then(function(){throw n})})}function Nn(t,e){return function(){var n=arguments,r=this;return t.add(function(){return e.apply(r,n)})}}function Li(t){var e=new Rt(t),n=new Array(e.size),r=-1;return e.forEach(function(i){n[++r]=i}),n}function Un(t){var e=new Array(t.size),n=-1;return t.forEach(function(r,i){e[++n]=i}),e}class mr{constructor(){this.promise=new Promise(function(e){e()})}add(e){return this.promise=this.promise.catch(function(){}).then(function(){return e()}),this.promise}finish(){return this.promise}}function Mi(t){if(!t)return"undefined";switch(typeof t){case"function":return t.toString();case"string":return t.toString();default:return JSON.stringify(t)}}function Kf(t,e){return Mi(t)+Mi(e)+"undefined"}async function Ni(t,e,n,r,i,o){const s=Kf(n,r);let a;if(!i&&(a=t._cachedViews=t._cachedViews||{},a[s]))return a[s];const u=t.info().then(async function(h){const y=h.db_name+"-mrview-"+(i?"temp":fs(s));function c(k){k.views=k.views||{};let m=e;m.indexOf("/")===-1&&(m=e+"/"+e);const g=k.views[m]=k.views[m]||{};if(!g[y])return g[y]=!0,k}await $n(t,"_local/"+o,c);const $=(await t.registerDependentDatabase(y)).db;$.auto_compaction=!0;const O={name:y,db:$,sourceDB:t,adapter:t.adapter,mapFun:n,reduceFun:r};let T;try{T=await O.db.get("_local/lastSeq")}catch(k){if(k.status!==404)throw k}return O.seq=T?T.seq:0,a&&O.db.once("destroyed",function(){delete a[s]}),O});return a&&(a[s]=u),u}var Ui={},Fi=new mr,Qf=50;function Fn(t){return t.indexOf("/")===-1?[t,t]:t.split("/")}function Wf(t){return t.length===1&&/^1-/.test(t[0].rev)}function Ki(t,e,n){try{t.emit("error",e)}catch{yr("error",`The user's map/reduce function threw an uncaught error.
You can debug this error by doing:
myDatabase.on('error', function (err) { debugger; });
Please double-check your map/reduce function.`),yr("error",e,n)}}function zf(t,e,n,r){function i(l,v,b){try{v(b)}catch(S){Ki(l,S,{fun:v,doc:b})}}function o(l,v,b,S,I){try{return{output:v(b,S,I)}}catch(L){return Ki(l,L,{fun:v,keys:b,values:S,rereduce:I}),{error:L}}}function s(l,v){const b=pe(l.key,v.key);return b!==0?b:pe(l.value,v.value)}function a(l,v,b){return b=b||0,typeof v=="number"?l.slice(b,v+b):b>0?l.slice(b):l}function u(l){const v=l.value;return v&&typeof v=="object"&&v._id||l.id}function h(l){l.rows.forEach(function(v){const b=v.doc&&v.doc._attachments;b&&Object.keys(b).forEach(function(S){const I=b[S];b[S].data=Sf(I.data,I.content_type)})})}function y(l){return function(v){return l.include_docs&&l.attachments&&l.binary&&h(v),v}}function c(l,v,b,S){let I=v[l];typeof I<"u"&&(S&&(I=encodeURIComponent(JSON.stringify(I))),b.push(l+"="+I))}function w(l){if(typeof l<"u"){const v=Number(l);return!isNaN(v)&&v===parseInt(l,10)?v:l}}function $(l){return l.group_level=w(l.group_level),l.limit=w(l.limit),l.skip=w(l.skip),l}function O(l){if(l){if(typeof l!="number")return new Ve(`Invalid value for integer: "${l}"`);if(l<0)return new Ve(`Invalid value for positive integer: "${l}"`)}}function T(l,v){const b=l.descending?"endkey":"startkey",S=l.descending?"startkey":"endkey";if(typeof l[b]<"u"&&typeof l[S]<"u"&&pe(l[b],l[S])>0)throw new Ve("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(v.reduce&&l.reduce!==!1){if(l.include_docs)throw new Ve("{include_docs:true} is invalid for reduce");if(l.keys&&l.keys.length>1&&!l.group&&!l.group_level)throw new Ve("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(I){const L=O(l[I]);if(L)throw L})}async function k(l,v,b){let S=[],I,L="GET",Q;if(c("reduce",b,S),c("include_docs",b,S),c("attachments",b,S),c("limit",b,S),c("descending",b,S),c("group",b,S),c("group_level",b,S),c("skip",b,S),c("stale",b,S),c("conflicts",b,S),c("startkey",b,S,!0),c("start_key",b,S,!0),c("endkey",b,S,!0),c("end_key",b,S,!0),c("inclusive_end",b,S),c("key",b,S,!0),c("update_seq",b,S),S=S.join("&"),S=S===""?"":"?"+S,typeof b.keys<"u"){const B=`keys=${encodeURIComponent(JSON.stringify(b.keys))}`;B.length+S.length+1<=2e3?S+=(S[0]==="?"?"&":"?")+B:(L="POST",typeof v=="string"?I={keys:b.keys}:v.keys=b.keys)}if(typeof v=="string"){const C=Fn(v),B=await l.fetch("_design/"+C[0]+"/_view/"+C[1]+S,{headers:new en({"Content-Type":"application/json"}),method:L,body:JSON.stringify(I)});Q=B.ok;const F=await B.json();if(!Q)throw F.status=B.status,dr(F);return F.rows.forEach(function(K){if(K.value&&K.value.error&&K.value.error==="builtin_reduce_error")throw new Error(K.reason)}),new Promise(function(K){K(F)}).then(y(b))}I=I||{},Object.keys(v).forEach(function(C){Array.isArray(v[C])?I[C]=v[C]:I[C]=v[C].toString()});const j=await l.fetch("_temp_view"+S,{headers:new en({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(I)});Q=j.ok;const x=await j.json();if(!Q)throw x.status=j.status,dr(x);return new Promise(function(C){C(x)}).then(y(b))}function m(l,v,b){return new Promise(function(S,I){l._query(v,b,function(L,Q){if(L)return I(L);S(Q)})})}function g(l){return new Promise(function(v,b){l._viewCleanup(function(S,I){if(S)return b(S);v(I)})})}function f(l){return function(v){if(v.status===404)return l;throw v}}async function d(l,v,b){const S="_local/doc_"+l,I={_id:S,keys:[]},L=b.get(l),Q=L[0],j=L[1];function x(){return Wf(j)?Promise.resolve(I):v.db.get(S).catch(f(I))}function C(X){return X.keys.length?v.db.allDocs({keys:X.keys,include_docs:!0}):Promise.resolve({rows:[]})}function B(X,ie){const ae=[],ye=new Rt;for(let W=0,J=ie.rows.length;W<J;W++){const re=ie.rows[W].doc;if(re&&(ae.push(re),ye.add(re._id),re._deleted=!Q.has(re._id),!re._deleted)){const V=Q.get(re._id);"value"in V&&(re.value=V.value)}}const ke=Un(Q);return ke.forEach(function(W){if(!ye.has(W)){const J={_id:W},Y=Q.get(W);"value"in Y&&(J.value=Y.value),ae.push(J)}}),X.keys=Li(ke.concat(X.keys)),ae.push(X),ae}const F=await x(),K=await C(F);return B(F,K)}function p(l){return l.sourceDB.get("_local/purges").then(function(v){const b=v.purgeSeq;return l.db.get("_local/purgeSeq").then(function(S){return S._rev}).catch(function(S){if(S.status!==404)throw S}).then(function(S){return l.db.put({_id:"_local/purgeSeq",_rev:S,purgeSeq:b})})}).catch(function(v){if(v.status!==404)throw v})}function _(l,v,b){var S="_local/lastSeq";return l.db.get(S).catch(f({_id:S,seq:0})).then(function(I){var L=Un(v);return Promise.all(L.map(function(Q){return d(Q,l,v)})).then(function(Q){var j=Bi(Q);return I.seq=b,j.push(I),l.db.bulkDocs({docs:j})}).then(()=>p(l))})}function P(l){const v=typeof l=="string"?l:l.name;let b=Ui[v];return b||(b=Ui[v]=new mr),b}async function M(l,v){return Nn(P(l),function(){return D(l,v)})()}async function D(l,v){let b,S,I;function L(W,J){const Y={id:S._id,key:ft(W)};typeof J<"u"&&J!==null&&(Y.value=ft(J)),b.push(Y)}const Q=e(l.mapFun,L);let j=l.seq||0;function x(){return l.sourceDB.info().then(function(W){I=l.sourceDB.activeTasks.add({name:"view_indexing",total_items:W.update_seq-j})})}function C(W,J){return function(){return _(l,W,J)}}let B=0;const F={view:l.name,indexed_docs:B};l.sourceDB.emit("indexing",F);const K=new mr;async function X(){const W=await l.sourceDB.changes({return_docs:!0,conflicts:!0,include_docs:!0,style:"all_docs",since:j,limit:v.changes_batch_size}),J=await ie();return ae(W,J)}function ie(){return l.db.get("_local/purgeSeq").then(function(W){return W.purgeSeq}).catch(function(W){if(W&&W.status!==404)throw W;return-1}).then(function(W){return l.sourceDB.get("_local/purges").then(function(J){const Y=J.purges.filter(function(V,Z){return Z>W}).map(V=>V.docId),re=Y.filter(function(V,Z){return Y.indexOf(V)===Z});return Promise.all(re.map(function(V){return l.sourceDB.get(V).then(function(Z){return{docId:V,doc:Z}}).catch(function(Z){if(Z.status!==404)throw Z;return{docId:V}})}))}).catch(function(J){if(J&&J.status!==404)throw J;return[]})})}function ae(W,J){var Y=W.results;if(!Y.length&&!J.length)return;for(let Z of J)if(Y.findIndex(function(Pe){return Pe.id===Z.docId})<0){const Pe={_id:Z.docId,doc:{_id:Z.docId,_deleted:1},changes:[]};Z.doc&&(Pe.doc=Z.doc,Pe.changes.push({rev:Z.doc._rev})),Y.push(Pe)}var re=ye(Y);K.add(C(re,j)),B=B+Y.length;const V={view:l.name,last_seq:W.last_seq,results_count:Y.length,indexed_docs:B};if(l.sourceDB.emit("indexing",V),l.sourceDB.activeTasks.update(I,{completed_items:B}),!(Y.length<v.changes_batch_size))return X()}function ye(W){const J=new yt;for(let Y=0,re=W.length;Y<re;Y++){const V=W[Y];if(V.doc._id[0]!=="_"){b=[],S=V.doc,S._deleted||i(l.sourceDB,Q,S),b.sort(s);const Z=ke(b);J.set(V.doc._id,[Z,V.changes])}j=V.seq}return J}function ke(W){const J=new yt;let Y;for(let re=0,V=W.length;re<V;re++){const Z=W[re],He=[Z.key,Z.id];re>0&&pe(Z.key,Y)===0&&He.push(re),J.set(Le(He),Z),Y=Z.key}return J}try{await x(),await X(),await K.finish(),l.seq=j,l.sourceDB.activeTasks.remove(I)}catch(W){l.sourceDB.activeTasks.remove(I,W)}}function U(l,v,b){b.group_level===0&&delete b.group_level;const S=b.group||b.group_level,I=n(l.reduceFun),L=[],Q=isNaN(b.group_level)?Number.POSITIVE_INFINITY:b.group_level;v.forEach(function(j){const x=L[L.length-1];let C=S?j.key:null;if(S&&Array.isArray(C)&&(C=C.slice(0,Q)),x&&pe(x.groupKey,C)===0){x.keys.push([j.key,j.id]),x.values.push(j.value);return}L.push({keys:[[j.key,j.id]],values:[j.value],groupKey:C})}),v=[];for(let j=0,x=L.length;j<x;j++){const C=L[j],B=o(l.sourceDB,I,C.keys,C.values,!1);if(B.error&&B.error instanceof Gr)throw B.error;v.push({value:B.error?null:B.output,key:C.groupKey})}return{rows:a(v,b.limit,b.skip)}}function z(l,v){return Nn(P(l),function(){return H(l,v)})()}async function H(l,v){let b;const S=l.reduceFun&&v.reduce!==!1,I=v.skip||0;typeof v.keys<"u"&&!v.keys.length&&(v.limit=0,delete v.keys);async function L(j){j.include_docs=!0;const x=await l.db.allDocs(j);return b=x.total_rows,x.rows.map(function(C){if("value"in C.doc&&typeof C.doc.value=="object"&&C.doc.value!==null){const F=Object.keys(C.doc.value).sort(),K=["id","key","value"];if(!(F<K||F>K))return C.doc.value}const B=Cf(C.doc._id);return{key:B[0],id:B[1],value:"value"in C.doc?C.doc.value:null}})}async function Q(j){let x;if(S?x=U(l,j,v):typeof v.keys>"u"?x={total_rows:b,offset:I,rows:j}:x={total_rows:b,offset:I,rows:a(j,v.limit,v.skip)},v.update_seq&&(x.update_seq=l.seq),v.include_docs){const B=Li(j.map(u)),F=await l.sourceDB.allDocs({keys:B,include_docs:!0,conflicts:v.conflicts,attachments:v.attachments,binary:v.binary});var C=new yt;return F.rows.forEach(function(K){C.set(K.id,K.doc)}),j.forEach(function(K){var X=u(K),ie=C.get(X);ie&&(K.doc=ie)}),x}else return x}if(typeof v.keys<"u"){const x=v.keys.map(function(F){const K={startkey:Le([F]),endkey:Le([F,{}])};return v.update_seq&&(K.update_seq=!0),L(K)}),C=await Promise.all(x),B=Bi(C);return Q(B)}else{const j={descending:v.descending};v.update_seq&&(j.update_seq=!0);let x,C;if("start_key"in v&&(x=v.start_key),"startkey"in v&&(x=v.startkey),"end_key"in v&&(C=v.end_key),"endkey"in v&&(C=v.endkey),typeof x<"u"&&(j.startkey=v.descending?Le([x,{}]):Le([x])),typeof C<"u"){let F=v.inclusive_end!==!1;v.descending&&(F=!F),j.endkey=Le(F?[C,{}]:[C])}if(typeof v.key<"u"){const F=Le([v.key]),K=Le([v.key,{}]);j.descending?(j.endkey=F,j.startkey=K):(j.startkey=F,j.endkey=K)}S||(typeof v.limit=="number"&&(j.limit=v.limit),j.skip=I);const B=await L(j);return Q(B)}}async function A(l){return(await l.fetch("_view_cleanup",{headers:new en({"Content-Type":"application/json"}),method:"POST"})).json()}async function E(l){try{const v=await l.get("_local/"+t),b=new yt;Object.keys(v.views).forEach(function(x){const C=Fn(x),B="_design/"+C[0],F=C[1];let K=b.get(B);K||(K=new Rt,b.set(B,K)),K.add(F)});const S={keys:Un(b),include_docs:!0},I=await l.allDocs(S),L={};I.rows.forEach(function(x){const C=x.key.substring(8);b.get(x.key).forEach(function(B){let F=C+"/"+B;v.views[F]||(F=B);const K=Object.keys(v.views[F]),X=x.doc&&x.doc.views&&x.doc.views[B];K.forEach(function(ie){L[ie]=L[ie]||X})})});const j=Object.keys(L).filter(function(x){return!L[x]}).map(function(x){return Nn(P(x),function(){return new l.constructor(x,l.__opts).destroy()})()});return Promise.all(j).then(function(){return{ok:!0}})}catch(v){if(v.status===404)return{ok:!0};throw v}}async function q(l,v,b){if(typeof l._query=="function")return m(l,v,b);if(lt(l))return k(l,v,b);const S={changes_batch_size:l.__opts.view_update_changes_batch_size||Qf};if(typeof v!="string")return T(b,v),Fi.add(async function(){const I=await Ni(l,"temp_view/temp_view",v.map,v.reduce,!0,t);return Ff(M(I,S).then(function(){return z(I,b)}),function(){return I.db.destroy()})}),Fi.finish();{const I=v,L=Fn(I),Q=L[0],j=L[1],x=await l.get("_design/"+Q);if(v=x.views&&x.views[j],!v)throw new zr(`ddoc ${x._id} has no view named ${j}`);r(x,j),T(b,v);const C=await Ni(l,I,v.map,v.reduce,!1,t);return b.stale==="ok"||b.stale==="update_after"?(b.stale==="update_after"&&Oe(function(){M(C,S)}),z(C,b)):(await M(C,S),z(C,b))}}function N(l,v,b){const S=this;typeof v=="function"&&(b=v,v={}),v=v?$(v):{},typeof l=="function"&&(l={map:l});const I=Promise.resolve().then(function(){return q(S,l,v)});return ds(I,b),I}const R=Uf(function(){const l=this;return typeof l._viewCleanup=="function"?g(l):lt(l)?A(l):E(l)});return{query:N,viewCleanup:R}}function Qt(t,e){for(var n=t,r=0,i=e.length;r<i;r++){var o=e[r];if(n=n[o],!n)break}return n}function Gf(t,e,n){for(var r=0,i=e.length;r<i-1;r++){var o=e[r];t=t[o]=t[o]||{}}t[e[i-1]]=n}function Jr(t,e){return t<e?-1:t>e?1:0}function ht(t){for(var e=[],n="",r=0,i=t.length;r<i;r++){var o=t[r];r>0&&t[r-1]==="\\"&&(o==="$"||o===".")?n=n.substring(0,n.length-1)+o:o==="."?(e.push(n),n=""):n+=o}return e.push(n),e}var Jf=["$or","$nor","$not"];function hs(t){return Jf.indexOf(t)>-1}function Ie(t){return Object.keys(t)[0]}function Hr(t){return t[Ie(t)]}function Bt(t){var e={},n={$or:!0,$nor:!0};return t.forEach(function(r){Object.keys(r).forEach(function(i){var o=r[i];if(typeof o!="object"&&(o={$eq:o}),hs(i))if(o instanceof Array){if(n[i]){n[i]=!1,e[i]=o;return}var s=[];e[i].forEach(function(u){Object.keys(o).forEach(function(h){var y=o[h],c=Math.max(Object.keys(u).length,Object.keys(y).length),w=Bt([u,y]);Object.keys(w).length<=c||s.push(w)})}),e[i]=s}else e[i]=Bt([o]);else{var a=e[i]=e[i]||{};Object.keys(o).forEach(function(u){var h=o[u];if(u==="$gt"||u==="$gte")return Hf(u,h,a);if(u==="$lt"||u==="$lte")return Yf(u,h,a);if(u==="$ne")return Xf(h,a);if(u==="$eq")return Zf(h,a);if(u==="$regex")return Vf(h,a);a[u]=h})}})}),e}function Hf(t,e,n){typeof n.$eq<"u"||(typeof n.$gte<"u"?t==="$gte"?e>n.$gte&&(n.$gte=e):e>=n.$gte&&(delete n.$gte,n.$gt=e):typeof n.$gt<"u"?t==="$gte"?e>n.$gt&&(delete n.$gt,n.$gte=e):e>n.$gt&&(n.$gt=e):n[t]=e)}function Yf(t,e,n){typeof n.$eq<"u"||(typeof n.$lte<"u"?t==="$lte"?e<n.$lte&&(n.$lte=e):e<=n.$lte&&(delete n.$lte,n.$lt=e):typeof n.$lt<"u"?t==="$lte"?e<n.$lt&&(delete n.$lt,n.$lte=e):e<n.$lt&&(n.$lt=e):n[t]=e)}function Xf(t,e){"$ne"in e?e.$ne.push(t):e.$ne=[t]}function Zf(t,e){delete e.$gt,delete e.$gte,delete e.$lt,delete e.$lte,delete e.$ne,e.$eq=t}function Vf(t,e){"$regex"in e?e.$regex.push(t):e.$regex=[t]}function vs(t){for(var e in t){if(Array.isArray(t))for(var n in t)t[n].$and&&(t[n]=Bt(t[n].$and));var r=t[e];typeof r=="object"&&vs(r)}return t}function ps(t,e){for(var n in t){n==="$and"&&(e=!0);var r=t[n];typeof r=="object"&&(e=ps(r,e))}return e}function Yr(t){var e=Je(t);ps(e,!1)&&(e=vs(e),"$and"in e&&(e=Bt(e.$and))),["$or","$nor"].forEach(function(s){s in e&&e[s].forEach(function(a){for(var u=Object.keys(a),h=0;h<u.length;h++){var y=u[h],c=a[y];(typeof c!="object"||c===null)&&(a[y]={$eq:c})}})}),"$not"in e&&(e.$not=Bt([e.$not]));for(var n=Object.keys(e),r=0;r<n.length;r++){var i=n[r],o=e[i];(typeof o!="object"||o===null)&&(o={$eq:o}),e[i]=o}return _r(e),e}function _r(t){Object.keys(t).forEach(function(e){var n=t[e];Array.isArray(n)?n.forEach(function(r){r&&typeof r=="object"&&_r(r)}):e==="$ne"?t.$ne=[n]:e==="$regex"?t.$regex=[n]:n&&typeof n=="object"&&_r(n)})}function el(t){function e(n){return t.map(function(r){var i=Ie(r),o=ht(i),s=Qt(n,o);return s})}return function(n,r){var i=e(n.doc),o=e(r.doc),s=pe(i,o);return s!==0?s:Jr(n.doc._id,r.doc._id)}}function ys(t,e,n){if(t=t.filter(function(s){return bt(s.doc,e.selector,n)}),e.sort){var r=el(e.sort);t=t.sort(r),typeof e.sort[0]!="string"&&Hr(e.sort[0])==="desc"&&(t=t.reverse())}if("limit"in e||"skip"in e){var i=e.skip||0,o=("limit"in e?e.limit:t.length)+i;t=t.slice(i,o)}return t}function bt(t,e,n){return n.every(function(r){var i=e[r],o=ht(r),s=Qt(t,o);return hs(r)?tl(r,i,t):dn(i,t,o,s)})}function dn(t,e,n,r){return t?typeof t=="object"?Object.keys(t).every(function(i){var o=t[i];if(i.indexOf("$")===0)return Qi(i,e,o,n,r);var s=ht(i);if(r===void 0&&typeof o!="object"&&s.length>0)return!1;var a=Qt(r,s);return typeof o=="object"?dn(o,e,n,a):Qi("$eq",e,o,s,a)}):t===r:!0}function tl(t,e,n){return t==="$or"?e.some(function(r){return bt(n,r,Object.keys(r))}):t==="$not"?!bt(n,e,Object.keys(e)):!e.find(function(r){return bt(n,r,Object.keys(r))})}function Qi(t,e,n,r,i){if(!zi[t])throw new Error('unknown operator "'+t+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return zi[t](e,n,r,i)}function Ct(t){return typeof t<"u"&&t!==null}function Ze(t){return typeof t<"u"}function nl(t,e){if(typeof t!="number"||parseInt(t,10)!==t)return!1;var n=e[0],r=e[1];return t%n===r}function Wi(t,e){return e.some(function(n){return t instanceof Array?t.some(function(r){return pe(n,r)===0}):pe(n,t)===0})}function rl(t,e){return e.every(function(n){return t.some(function(r){return pe(n,r)===0})})}function il(t,e){return t.length===e}function ol(t,e){var n=new RegExp(e);return n.test(t)}function sl(t,e){switch(e){case"null":return t===null;case"boolean":return typeof t=="boolean";case"number":return typeof t=="number";case"string":return typeof t=="string";case"array":return t instanceof Array;case"object":return{}.toString.call(t)==="[object Object]"}}var zi={$elemMatch:function(t,e,n,r){return!Array.isArray(r)||r.length===0?!1:typeof r[0]=="object"&&r[0]!==null?r.some(function(i){return bt(i,e,Object.keys(e))}):r.some(function(i){return dn(e,t,n,i)})},$allMatch:function(t,e,n,r){return!Array.isArray(r)||r.length===0?!1:typeof r[0]=="object"&&r[0]!==null?r.every(function(i){return bt(i,e,Object.keys(e))}):r.every(function(i){return dn(e,t,n,i)})},$eq:function(t,e,n,r){return Ze(r)&&pe(r,e)===0},$gte:function(t,e,n,r){return Ze(r)&&pe(r,e)>=0},$gt:function(t,e,n,r){return Ze(r)&&pe(r,e)>0},$lte:function(t,e,n,r){return Ze(r)&&pe(r,e)<=0},$lt:function(t,e,n,r){return Ze(r)&&pe(r,e)<0},$exists:function(t,e,n,r){return e?Ze(r):!Ze(r)},$mod:function(t,e,n,r){return Ct(r)&&nl(r,e)},$ne:function(t,e,n,r){return e.every(function(i){return pe(r,i)!==0})},$in:function(t,e,n,r){return Ct(r)&&Wi(r,e)},$nin:function(t,e,n,r){return Ct(r)&&!Wi(r,e)},$size:function(t,e,n,r){return Ct(r)&&Array.isArray(r)&&il(r,e)},$all:function(t,e,n,r){return Array.isArray(r)&&rl(r,e)},$regex:function(t,e,n,r){return Ct(r)&&typeof r=="string"&&e.every(function(i){return ol(r,i)})},$type:function(t,e,n,r){return sl(r,e)}};function Sn(t,e){if(typeof e!="object")throw new Error("Selector error: expected a JSON object");e=Yr(e);var n={doc:t},r=ys([n],{selector:e},Object.keys(e));return r&&r.length===1}function gs(t){return t=Je(t),t.index||(t.index={}),["type","name","ddoc"].forEach(function(e){t.index[e]&&(t[e]=t.index[e],delete t.index[e])}),t.fields&&(t.index.fields=t.fields,delete t.fields),t.type||(t.type="json"),t}function al(t,e,n){var r="",i=e,o=!0;if(["$in","$nin","$or","$and","$mod","$nor","$all"].indexOf(t)!==-1&&(Array.isArray(e)||(r="Query operator "+t+" must be an array.")),["$not","$elemMatch","$allMatch"].indexOf(t)!==-1&&(!Array.isArray(e)&&typeof e=="object"&&e!==null||(r="Query operator "+t+" must be an object.")),t==="$mod"&&Array.isArray(e))if(e.length!==2)r="Query operator $mod must be in the format [divisor, remainder], where divisor and remainder are both integers.";else{var s=e[0],a=e[1];s===0&&(r="Query operator $mod's divisor cannot be 0, cannot divide by zero.",o=!1),(typeof s!="number"||parseInt(s,10)!==s)&&(r="Query operator $mod's divisor is not an integer.",i=s),parseInt(a,10)!==a&&(r="Query operator $mod's remainder is not an integer.",i=a)}if(t==="$exists"&&typeof e!="boolean"&&(r="Query operator $exists must be a boolean."),t==="$type"){var u=["null","boolean","number","string","array","object"],h='"'+u.slice(0,u.length-1).join('", "')+'", or "'+u[u.length-1]+'"';(typeof e!="string"||u.indexOf(e)==-1)&&(r="Query operator $type must be a string. Supported values: "+h+".")}if(t==="$size"&&parseInt(e,10)!==e&&(r="Query operator $size must be a integer."),t==="$regex"&&typeof e!="string"&&(n?r="Query operator $regex must be a string.":e instanceof RegExp||(r="Query operator $regex must be a string or an instance of a javascript regular expression.")),r){if(o){var y=i===null?" ":Array.isArray(i)?" array":" "+typeof i,c=typeof i=="object"&&i!==null?JSON.stringify(i,null,"	"):i;r+=" Received"+y+": "+c}throw new Error(r)}}var ul=["$all","$allMatch","$and","$elemMatch","$exists","$in","$mod","$nin","$nor","$not","$or","$regex","$size","$type"],cl=["$in","$nin","$mod","$all"],fl=["$eq","$gt","$gte","$lt","$lte"];function hn(t,e){if(Array.isArray(t))for(var n of t)typeof n=="object"&&s!==null&&hn(n,e);else for(var r=Object.keys(t),i=0;i<r.length;i++){var o=r[i],s=t[o];ul.indexOf(o)!==-1&&al(o,s,e),fl.indexOf(o)===-1&&cl.indexOf(o)===-1&&typeof s=="object"&&s!==null&&hn(s,e)}}function Wt(t,e,n,r){var i,o;n.headers=new en({"Content-type":"application/json"}),t.fetch(e,n).then(function(s){return i=s.status,o=s.ok,s.json()}).then(function(s){if(o)r(null,s);else{s.status=i;var a=dr(s);r(a)}}).catch(r)}function ll(t,e,n){e=gs(e),Wt(t,"_index",{method:"POST",body:JSON.stringify(e)},n)}function dl(t,e,n){hn(e.selector,!0),Wt(t,"_find",{method:"POST",body:JSON.stringify(e)},n)}function hl(t,e,n){Wt(t,"_explain",{method:"POST",body:JSON.stringify(e)},n)}function vl(t,e){Wt(t,"_index",{method:"GET"},e)}function pl(t,e,n){var r=e.ddoc,i=e.type||"json",o=e.name;if(!r)return n(new Error("you must provide an index's ddoc"));if(!o)return n(new Error("you must provide an index's name"));var s="_index/"+[r,i,o].map(encodeURIComponent).join("/");Wt(t,s,{method:"DELETE"},n)}function zt(t){return function(...e){var n=e.pop(),r=t.apply(this,e);return yl(r,n),r}}function yl(t,e){return t.then(function(n){Oe(function(){e(null,n)})},function(n){Oe(function(){e(n)})}),t}var Xr=function(...t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n];Array.isArray(i)?e=e.concat(Xr.apply(null,i)):e.push(i)}return e};function Zr(t){for(var e={},n=0,r=t.length;n<r;n++)e=Wr(e,t[n]);return e}function gl(t,e){for(var n={},r=0,i=e.length;r<i;r++){var o=ht(e[r]),s=Qt(t,o);typeof s<"u"&&Gf(n,o,s)}return n}function ms(t,e){for(var n=0,r=Math.min(t.length,e.length);n<r;n++)if(t[n]!==e[n])return!1;return!0}function ml(t,e){return t.length>e.length?!1:ms(t,e)}function _l(t,e){t=t.slice();for(var n=0,r=e.length;n<r;n++){var i=e[n];if(!t.length)break;var o=t.indexOf(i);if(o===-1)return!1;t.splice(o,1)}return!0}function wl(t){for(var e={},n=0,r=t.length;n<r;n++)e[t[n]]=!0;return e}function bl(t,e){for(var n=null,r=-1,i=0,o=t.length;i<o;i++){var s=t[i],a=e(s);a>r&&(r=a,n=s)}return n}function Gi(t,e){if(t.length!==e.length)return!1;for(var n=0,r=t.length;n<r;n++)if(t[n]!==e[n])return!1;return!0}function $l(t){for(var e={},n=0;n<t.length;n++)e["$"+t[n]]=!0;return Object.keys(e).map(function(r){return r.substring(1)})}function Sl(t,e,n){return function(r){if(!(n&&!Sn(r,n))){for(var i=[],o=0,s=t.length;o<s;o++){for(var a=ht(t[o]),u=r,h=0,y=a.length;h<y;h++){var c=a[h];if(u=u[c],typeof u>"u")return}i.push(u)}e(i)}}}function kl(t,e,n){var r=ht(t);return function(i){if(!(n&&!Sn(i,n))){for(var o=i,s=0,a=r.length;s<a;s++){var u=r[s];if(o=o[u],typeof o>"u")return}e(o)}}}function Al(t,e,n){return function(r){n&&!Sn(r,n)||e(r[t])}}function Ol(t,e,n){return function(r){if(!(n&&!Sn(r,n))){for(var i=[],o=0,s=t.length;o<s;o++)i.push(r[t[o]]);e(i)}}}function El(t){for(var e=0,n=t.length;e<n;e++){var r=t[e];if(r.indexOf(".")!==-1)return!1}return!0}function xl(t,e,n){var r=El(t),i=t.length===1;return r?i?Al(t[0],e,n):Ol(t,e,n):i?kl(t[0],e,n):Sl(t,e,n)}function Cl(t,e){const n=Object.keys(t.fields),r=t.partial_filter_selector;return xl(n,e,r)}function Il(){throw new Error("reduce not supported")}function Tl(t,e){var n=t.views[e];if(!n.map||!n.map.fields)throw new Error("ddoc "+t._id+" with view "+e+" doesn't have map.fields defined. maybe it wasn't created by this plugin?")}var Kn=zf("indexes",Cl,Il,Tl);function Vr(t){return t._customFindAbstractMapper?{query:function(n,r){var i=Kn.query.bind(this);return t._customFindAbstractMapper.query.call(this,n,r,i)},viewCleanup:function(){var n=Kn.viewCleanup.bind(this);return t._customFindAbstractMapper.viewCleanup.call(this,n)}}:Kn}function ql(t){if(!Array.isArray(t))throw new Error("invalid sort json - should be an array");return t.map(function(e){if(typeof e=="string"){var n={};return n[e]="asc",n}else return e})}function jl(t){var e=[];return typeof t=="string"?e.push(t):e=t,e.map(function(n){return n.replace("_design/","")})}function _s(t){return t.fields=t.fields.map(function(e){if(typeof e=="string"){var n={};return n[e]="asc",n}return e}),t.partial_filter_selector&&(t.partial_filter_selector=Yr(t.partial_filter_selector)),t}function Dl(t,e){for(var n=[],r=0;r<e.def.fields.length;r++){var i=Ie(e.def.fields[r]);n.push(Qt(t,ht(i)))}return n}function Pl(t,e,n){for(var r=n.def.fields,i=0,o=t.length;i<o;i++){var s=t[i],a=Dl(s.doc,n);if(r.length===1)a=a[0];else for(;a.length>e.length;)a.pop();if(Math.abs(pe(a,e))>0)break}return i>0?t.slice(i):t}function Rl(t){var e=Je(t);return delete e.startkey,delete e.endkey,delete e.inclusive_start,delete e.inclusive_end,"endkey"in t&&(e.startkey=t.endkey),"startkey"in t&&(e.endkey=t.startkey),"inclusive_start"in t&&(e.inclusive_end=t.inclusive_start),"inclusive_end"in t&&(e.inclusive_start=t.inclusive_end),e}function Bl(t){var e=t.fields.filter(function(n){return Hr(n)==="asc"});if(e.length!==0&&e.length!==t.fields.length)throw new Error("unsupported mixed sorting")}function Ll(t,e){if(e.defaultUsed&&t.sort){var n=t.sort.filter(function(r){return Object.keys(r)[0]!=="_id"}).map(function(r){return Object.keys(r)[0]});if(n.length>0)throw new Error('Cannot sort on field(s) "'+n.join(",")+'" when using the default index')}e.defaultUsed}function Ml(t){if(typeof t.selector!="object")throw new Error("you must provide a selector when you find()")}function Nl(t,e){var n=Object.keys(t),r=e?e.map(Ie):[],i;return n.length>=r.length?i=n:i=r,r.length===0?{fields:i}:(i=i.sort(function(o,s){var a=r.indexOf(o);a===-1&&(a=Number.MAX_VALUE);var u=r.indexOf(s);return u===-1&&(u=Number.MAX_VALUE),a<u?-1:a>u?1:0}),{fields:i,sortOrder:e.map(Ie)})}function Ul(t,e){e=gs(e);var n=Je(e.index);e.index=_s(e.index),Bl(e.index);var r;function i(){return r||(r=fs(JSON.stringify(e)))}var o=e.name||"idx-"+i(),s=e.ddoc||"idx-"+i(),a="_design/"+s,u=!1,h=!1;function y(c){return c._rev&&c.language!=="query"&&(u=!0),c.language="query",c.views=c.views||{},h=!!c.views[o],h?!1:(c.views[o]={map:{fields:Zr(e.index.fields),partial_filter_selector:e.index.partial_filter_selector},reduce:"_count",options:{def:n}},c)}return t.constructor.emit("debug",["find","creating index",a]),$n(t,a,y).then(function(){if(u)throw new Error('invalid language for ddoc with id "'+a+'" (should be "query")')}).then(function(){var c=s+"/"+o;return Vr(t).query.call(t,c,{limit:0,reduce:!1}).then(function(){return{id:a,name:o,result:h?"exists":"created"}})})}function ws(t){return t.allDocs({startkey:"_design/",endkey:"_design/￿",include_docs:!0}).then(function(e){var n={indexes:[{ddoc:null,name:"_all_docs",type:"special",def:{fields:[{_id:"asc"}]}}]};return n.indexes=Xr(n.indexes,e.rows.filter(function(r){return r.doc.language==="query"}).map(function(r){var i=r.doc.views!==void 0?Object.keys(r.doc.views):[];return i.map(function(o){var s=r.doc.views[o];return{ddoc:r.id,name:o,type:"json",def:_s(s.options.def)}})})),n.indexes.sort(function(r,i){return Jr(r.name,i.name)}),n.total_rows=n.indexes.length,n})}var vn=null,wr={"￿":{}};const Fl={queryOpts:{limit:0,startkey:wr,endkey:vn},inMemoryFields:[]};function Kl(t,e){for(var n=t.def.fields.map(Ie),r=0,i=n.length;r<i;r++){var o=n[r];if(e===o)return!0}return!1}function Ql(t,e){var n=t[e],r=Ie(n);return r!=="$eq"}function bs(t,e){var n=e.def.fields.map(Ie);return t.slice().sort(function(r,i){var o=n.indexOf(r),s=n.indexOf(i);return o===-1&&(o=Number.MAX_VALUE),s===-1&&(s=Number.MAX_VALUE),Jr(o,s)})}function Wl(t,e,n){n=bs(n,t);for(var r=!1,i=0,o=n.length;i<o;i++){var s=n[i];if(r||!Kl(t,s))return n.slice(i);i<o-1&&Ql(e,s)&&(r=!0)}return[]}function zl(t){var e=[];return Object.keys(t).forEach(function(n){var r=t[n];Object.keys(r).forEach(function(i){i==="$ne"&&e.push(n)})}),e}function Gl(t,e,n,r){var i=Xr(t,Wl(e,n,r),zl(n));return bs($l(i),e)}function Jl(t,e,n){if(e){var r=ml(e,t),i=ms(n,t);return r&&i}return _l(n,t)}var Hl=["$eq","$gt","$gte","$lt","$lte"];function $s(t){return Hl.indexOf(t)===-1}function Yl(t,e){var n=t[0],r=e[n];if(typeof r>"u")return!0;var i=Object.keys(r).length===1&&Ie(r)==="$ne";return!i}function Xl(t,e,n,r){var i=t.def.fields.map(Ie),o=Jl(i,e,n);return o?Yl(i,r):!1}function Zl(t,e,n,r){return r.filter(function(i){return Xl(i,n,e,t)})}function Vl(t,e,n,r,i){var o=Zl(t,e,n,r);if(o.length===0){if(i)throw{error:"no_usable_index",message:"There is no index available for this selector."};var s=r[0];return s.defaultUsed=!0,s}if(o.length===1&&!i)return o[0];var a=wl(e);function u(w){for(var $=w.def.fields.map(Ie),O=0,T=0,k=$.length;T<k;T++){var m=$[T];a[m]&&O++}return O}if(i){var h="_design/"+i[0],y=i.length===2?i[1]:!1,c=o.find(function(w){return!!(y&&w.ddoc===h&&y===w.name||w.ddoc===h)});if(!c)throw{error:"unknown_error",message:"Could not find that index or could not use that index for the query"};return c}return bl(o,u)}function ed(t,e){switch(t){case"$eq":return{key:e};case"$lte":return{endkey:e};case"$gte":return{startkey:e};case"$lt":return{endkey:e,inclusive_end:!1};case"$gt":return{startkey:e,inclusive_start:!1}}return{startkey:vn}}function td(t,e){var n=Ie(e.def.fields[0]),r=t[n]||{},i=[],o=Object.keys(r),s;return o.forEach(function(a){$s(a)&&i.push(n);var u=r[a],h=ed(a,u);s?s=Zr([s,h]):s=h}),{queryOpts:s,inMemoryFields:i}}function nd(t,e){switch(t){case"$eq":return{startkey:e,endkey:e};case"$lte":return{endkey:e};case"$gte":return{startkey:e};case"$lt":return{endkey:e,inclusive_end:!1};case"$gt":return{startkey:e,inclusive_start:!1}}}function rd(t,e){var n=e.def.fields.map(Ie),r=[],i=[],o=[],s,a;function u(D){s!==!1&&i.push(vn),a!==!1&&o.push(wr),r=n.slice(D)}for(var h=0,y=n.length;h<y;h++){var c=n[h],w=t[c];if(!w||!Object.keys(w).length){u(h);break}else if(Object.keys(w).some($s)){u(h);break}else if(h>0){var $="$gt"in w||"$gte"in w||"$lt"in w||"$lte"in w,O=Object.keys(t[n[h-1]]),T=Gi(O,["$eq"]),k=Gi(O,Object.keys(w)),m=$&&!T&&!k;if(m){u(h);break}}for(var g=Object.keys(w),f=null,d=0;d<g.length;d++){var p=g[d],_=w[p],P=nd(p,_);f?f=Zr([f,P]):f=P}i.push("startkey"in f?f.startkey:vn),o.push("endkey"in f?f.endkey:wr),"inclusive_start"in f&&(s=f.inclusive_start),"inclusive_end"in f&&(a=f.inclusive_end)}var M={startkey:i,endkey:o};return typeof s<"u"&&(M.inclusive_start=s),typeof a<"u"&&(M.inclusive_end=a),{queryOpts:M,inMemoryFields:r}}function id(t){return Object.keys(t).map(function(n){return t[n]}).some(function(n){return typeof n=="object"&&Object.keys(n).length===0})}function od(t){return{queryOpts:{startkey:null},inMemoryFields:[Object.keys(t)]}}function sd(t,e){return e.defaultUsed?od(t):e.def.fields.length===1?td(t,e):rd(t,e)}function ad(t,e){var n=t.selector,r=t.sort;if(id(n))return Wr({},Fl,{index:e[0]});var i=Nl(n,r),o=i.fields,s=i.sortOrder,a=Vl(n,o,s,e,t.use_index),u=sd(n,a),h=u.queryOpts,y=u.inMemoryFields,c=Gl(y,a,n,o),w={queryOpts:h,index:a,inMemoryFields:c};return w}function ud(t){return t.ddoc.substring(8)+"/"+t.name}function cd(t,e){var n=Je(e);return n.descending?("endkey"in n&&typeof n.endkey!="string"&&(n.endkey=""),"startkey"in n&&typeof n.startkey!="string"&&(n.limit=0)):("startkey"in n&&typeof n.startkey!="string"&&(n.startkey=""),"endkey"in n&&typeof n.endkey!="string"&&(n.limit=0)),"key"in n&&typeof n.key!="string"&&(n.limit=0),n.limit>0&&n.indexes_count&&(n.original_limit=n.limit,n.limit+=n.indexes_count),t.allDocs(n).then(function(r){return r.rows=r.rows.filter(function(i){return!/^_design\//.test(i.id)}),n.original_limit&&(n.limit=n.original_limit),r.rows=r.rows.slice(0,n.limit),r})}function Ss(t,e,n){return e.selector&&(hn(e.selector,!1),e.selector=Yr(e.selector)),e.sort&&(e.sort=ql(e.sort)),e.use_index&&(e.use_index=jl(e.use_index)),Ml(e),ws(t).then(function(r){t.constructor.emit("debug",["find","planning query",e]);var i=ad(e,r.indexes);t.constructor.emit("debug",["find","query plan",i]);var o=i.index;Ll(e,o);var s=Wr({include_docs:!0,reduce:!1,indexes_count:r.total_rows},i.queryOpts);if("startkey"in s&&"endkey"in s&&pe(s.startkey,s.endkey)>0)return{docs:[]};var a=e.sort&&typeof e.sort[0]!="string"&&Hr(e.sort[0])==="desc";return a&&(s.descending=!0,s=Rl(s)),i.inMemoryFields.length||("limit"in e&&(s.limit=e.limit),"skip"in e&&(s.skip=e.skip)),n?Promise.resolve(i,s):Promise.resolve().then(function(){if(o.name==="_all_docs")return cd(t,s);var u=ud(o);return Vr(t).query.call(t,u,s)}).then(function(u){s.inclusive_start===!1&&(u.rows=Pl(u.rows,s.startkey,o)),i.inMemoryFields.length&&(u.rows=ys(u.rows,e,i.inMemoryFields));var h={docs:u.rows.map(function(y){var c=y.doc;return e.fields?gl(c,e.fields):c})};return o.defaultUsed&&(h.warning="No matching index found, create an index to optimize query time."),h})})}function fd(t,e){return Ss(t,e,!0).then(function(n){return{dbname:t.name,index:n.index,selector:e.selector,range:{start_key:n.queryOpts.startkey,end_key:n.queryOpts.endkey},opts:{use_index:e.use_index||[],bookmark:"nil",limit:e.limit,skip:e.skip,sort:e.sort||{},fields:e.fields,conflicts:!1,r:[49]},limit:e.limit,skip:e.skip||0,fields:e.fields}})}function ld(t,e){if(!e.ddoc)throw new Error("you must supply an index.ddoc when deleting");if(!e.name)throw new Error("you must supply an index.name when deleting");var n=e.ddoc,r=e.name;function i(o){return Object.keys(o.views).length===1&&o.views[r]?{_id:n,_deleted:!0}:(delete o.views[r],o)}return $n(t,n,i).then(function(){return Vr(t).viewCleanup.apply(t)}).then(function(){return{ok:!0}})}var dd=zt(Ul),hd=zt(Ss),vd=zt(fd),pd=zt(ws),yd=zt(ld),At={};At.createIndex=Kt(function(t,e){if(typeof t!="object")return e(new Error("you must provide an index to create"));var n=lt(this)?ll:dd;n(this,t,e)});At.find=Kt(function(t,e){if(typeof e>"u"&&(e=t,t=void 0),typeof t!="object")return e(new Error("you must provide search parameters to find()"));var n=lt(this)?dl:hd;n(this,t,e)});At.explain=Kt(function(t,e){if(typeof e>"u"&&(e=t,t=void 0),typeof t!="object")return e(new Error("you must provide search parameters to explain()"));var n=lt(this)?hl:vd;n(this,t,e)});At.getIndexes=Kt(function(t){var e=lt(this)?vl:pd;e(this,t)});At.deleteIndex=Kt(function(t,e){if(typeof t!="object")return e(new Error("you must provide an index to delete"));var n=lt(this)?pl:yd;n(this,t,e)});const gd="dictionary";class md{constructor(){_e(this,"pouchDBClient");_e(this,"init",()=>{this.pouchDBClient||(te.plugin(At),this.pouchDBClient=new te(gd))});_e(this,"getAll",async()=>{const e=await this.pouchDBClient.allDocs({include_docs:!0});return{documents:this.wordDocumentsFrom(e.rows),total:e.total_rows}});_e(this,"add",async e=>{const n=await this.pouchDBClient.post(e);if(!n.ok)throw Error("Can't add document in pouchDB");const r=await this.pouchDBClient.get(n.id);return this.wordFrom(r)});_e(this,"edit",async e=>{const n=await this.findByKey(e.key),r=await this.pouchDBClient.put({...n,...e}),i=await this.pouchDBClient.get(r.id);return this.wordFrom(i)});_e(this,"delete",async e=>{const n=await this.findByKey(e);return await this.pouchDBClient.remove(n),e});this.init()}wordFrom(e){const{key:n,value:r,translations:i,createdAt:o}=e;return{key:n,value:r,translations:i,createdAt:o}}wordDocumentsFrom(e){return e.map(n=>n.doc&&this.wordFrom(n.doc)).filter(n=>!!n)}async findByKey(e){return(await this.pouchDBClient.find({selector:{key:{$eq:e}}})).docs[0]}}class _d{constructor(){_e(this,"cloudMainService");_e(this,"localMainService");this.cloudMainService=new ea,this.localMainService=new md}isEqual(e,n,r){const i=e.key===n.key;return r?i:i?1:-1}generateMeta(e){return{...e,key:globalThis.crypto.randomUUID(),createdAt:Qn().toISOString()}}async getDictionary(e){try{return e?await this.localMainService.getAll():await this.cloudMainService.getAll()}catch(n){return console.log(n),this.localMainService.getAll()}}async addWord(e){return await Promise.race([this.localMainService.add(e),this.cloudMainService.add(e)])}async removeWord(e){return await Promise.race([this.localMainService.delete(e),this.cloudMainService.delete(e)]),e}async editWord(e){await Promise.race([this.localMainService.edit(e),this.cloudMainService.edit(e)])}}const wd=Symbol("dictionary-store"),kn=no("dictionary-store",()=>{const t=new _d,e=$e([]),n=async()=>{const a=await t.getDictionary(!0);e.value=a.documents};return{_init:()=>{n()},dictionary:e,fetchDictionary:n,addWord:async a=>{const u=t.generateMeta(a);e.value=[u,...e.value];const h=await t.addWord(u);e.value=e.value.map(y=>t.isEqual(y,h,!0)?h:y)},removeWord:async a=>{e.value=e.value.filter(u=>!t.isEqual(a,u,!0)),await t.removeWord(a.key)},editWord:async a=>{const u=e.value.findIndex(({key:h})=>h===a.key);e.value[u]=a}}});class bd{constructor(){_e(this,"appwriteAccountClient");_e(this,"appwriteAvatarClient");this.appwriteAccountClient=Xs(),this.appwriteAvatarClient=Zs()}getCurrentSession(){return this.appwriteAccountClient.getSession("current")}loginWithGoogle(){this.appwriteAccountClient.createOAuth2Session("google",globalThis.location.href)}async logout(){const e=await this.getCurrentSession();this.appwriteAccountClient.deleteSession(e.$id)}async getUserInfo(){return{...await this.appwriteAccountClient.get(),avatar_url:this.appwriteAvatarClient.getInitials()}}}class $d{constructor(){_e(this,"authService");this.authService=new bd}async checkIsLoggedIn(){return!!await this.authService.getCurrentSession()}login(){this.authService.loginWithGoogle()}logout(){this.authService.logout()}getUserInfo(){return this.authService.getUserInfo()}}const Sd=Symbol("settings-store"),ks=no("settings",()=>{const t=new $d,e=$e(),n=async()=>{e.value=await t.getUserInfo()},r=()=>{t.login()},i=()=>{t.logout(),e.value=void 0},o=async()=>{await t.checkIsLoggedIn()&&n()};return qs(()=>{o()}),{user:e,loginWithGoogle:r,logout:i}}),kd={class:"cell"},Ad=Ke({__name:"row",props:{word:null,isSelected:{type:Boolean}},emits:["click"],setup(t,{emit:e}){const n=t,r=()=>{e("click",n.word)};return(i,o)=>(he(),Se("tr",{class:jt(["hover",{active:t.isSelected}]),onClick:r},[ee("td",null,tn(t.word.value),1),ee("td",kd,[ee("span",null,tn(t.word.translations.join(", ")),1)])],2))}}),Od=["onSubmit"],Ed=["onKeypress"],xd=["onKeypress"],Cd=Ke({__name:"editor_row",setup(t){const e="value",n="translations",r=$e(),i=$e(),o=$e(),s=kn(),a=()=>{var y;(y=o.value)==null||y.focus()},u=()=>{var y,c,w;(y=r.value)==null||y.requestSubmit(),(c=r.value)==null||c.reset(),(w=i.value)==null||w.focus()},h=()=>{const y=new FormData(r.value);s.addWord({value:String(y.get(e)),translations:String(y.get(n)).split(", ")})};return(y,c)=>(he(),Se("tr",null,[ee("td",null,[ee("form",{id:"editor-row-form",ref_key:"formRef",ref:r,onSubmit:pn(h,["prevent"])},[ee("input",{ref_key:"valueInputRef",ref:i,type:"text",autocomplete:"off",name:e,autofocus:"",form:"editor-row-form",class:"input input-xs input-success w-1/2",placeholder:"Введите слово ...",onKeypress:nn(a,["enter"])},null,40,Ed)],40,Od)]),ee("td",null,[ee("input",{ref_key:"translationsInputRef",ref:o,type:"text",autocomplete:"off",name:n,form:"editor-row-form",class:"input input-xs input-info w-1/2",placeholder:"... и перевод",onKeypress:nn(u,["enter"])},null,40,xd)])]))}}),Id={class:"table table-pin-rows w-full p-2"},Td=ee("tr",null,[ee("th",null,"Слово"),ee("th",null,"Перевод")],-1),qd=[Td],jd=Ke({__name:"table",props:{words:null,selectedWord:null,headClass:null,footClass:null},emits:["click:word"],setup(t,{emit:e}){const n=r=>{e("click:word",r)};return(r,i)=>(he(),Se("table",Id,[ee("thead",{class:jt(t.headClass)},qd,2),ee("tbody",null,[(he(!0),Se(ro,null,js(t.words,o=>{var s;return he(),Lt(Ad,{key:o.key,word:o,"is-selected":((s=t.selectedWord)==null?void 0:s.key)===o.key,onClick:n},null,8,["word","is-selected"])}),128))]),ee("tfoot",{class:jt(t.footClass)},[rt(Cd)],2)]))}});var Ji;const As=typeof window<"u",Dd=t=>typeof t=="string",dt=()=>{},Hi=As&&((Ji=window==null?void 0:window.navigator)==null?void 0:Ji.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent);function Ce(t){return typeof t=="function"?t():fe(t)}function Os(t,e){function n(...r){return new Promise((i,o)=>{Promise.resolve(t(()=>e.apply(this,r),{fn:e,thisArg:this,args:r})).then(i).catch(o)})}return n}function Pd(t,e={}){let n,r,i=dt;const o=a=>{clearTimeout(a),i(),i=dt};return a=>{const u=Ce(t),h=Ce(e.maxWait);return n&&o(n),u<=0||h!==void 0&&h<=0?(r&&(o(r),r=null),Promise.resolve(a())):new Promise((y,c)=>{i=e.rejectOnCancel?c:y,h&&!r&&(r=setTimeout(()=>{n&&o(n),r=null,y(a())},h)),n=setTimeout(()=>{r&&o(r),r=null,y(a())},u)})}}function Rd(t,e=!0,n=!0,r=!1){let i=0,o,s=!0,a=dt,u;const h=()=>{o&&(clearTimeout(o),o=void 0,a(),a=dt)};return c=>{const w=Ce(t),$=Date.now()-i,O=()=>u=c();return h(),w<=0?(i=Date.now(),O()):($>w&&(n||!s)?(i=Date.now(),O()):e&&(u=new Promise((T,k)=>{a=r?k:T,o=setTimeout(()=>{i=Date.now(),s=!0,T(O()),h()},Math.max(0,w-$))})),!n&&!o&&(o=setTimeout(()=>s=!0,w)),s=!1,u)}}function Bd(t){return t}function Es(t){return Ps()?(Rs(t),!0):!1}function Ld(t,e=200,n={}){return Os(Pd(e,n),t)}function Md(t,e=200,n=!1,r=!0,i=!1){return Os(Rd(e,n,r,i),t)}function Nd(t){return typeof t=="function"?ot(t):$e(t)}function Ud(t=!1,e={}){const{truthyValue:n=!0,falsyValue:r=!1}=e,i=Ds(t),o=$e(t);function s(a){if(arguments.length)return o.value=a,o.value;{const u=Ce(n);return o.value=o.value===u?Ce(r):u,o.value}}return i?s:[o,s]}function Fd(t){var e;const n=Ce(t);return(e=n==null?void 0:n.$el)!=null?e:n}const Kd=As?window:void 0;function br(...t){let e,n,r,i;if(Dd(t[0])||Array.isArray(t[0])?([n,r,i]=t,e=Kd):[e,n,r,i]=t,!e)return dt;Array.isArray(n)||(n=[n]),Array.isArray(r)||(r=[r]);const o=[],s=()=>{o.forEach(y=>y()),o.length=0},a=(y,c,w,$)=>(y.addEventListener(c,w,$),()=>y.removeEventListener(c,w,$)),u=$r(()=>[Fd(e),Ce(i)],([y,c])=>{s(),y&&o.push(...n.flatMap(w=>r.map($=>a(y,w,$,c))))},{immediate:!0,flush:"post"}),h=()=>{u(),s()};return Es(h),h}const Yi=typeof globalThis<"u"?globalThis:typeof window<"u"||typeof window<"u"?window:typeof self<"u"?self:{},Xi="__vueuse_ssr_handlers__";Yi[Xi]=Yi[Xi]||{};const Zi=1;function Qd(t,e={}){const{throttle:n=0,idle:r=200,onStop:i=dt,onScroll:o=dt,offset:s={left:0,right:0,top:0,bottom:0},eventListenerOptions:a={capture:!1,passive:!0},behavior:u="auto"}=e,h=$e(0),y=$e(0),c=ot({get(){return h.value},set(d){$(d,void 0)}}),w=ot({get(){return y.value},set(d){$(void 0,d)}});function $(d,p){var _,P,M;const D=Ce(t);D&&((M=D instanceof Document?document.body:D)==null||M.scrollTo({top:(_=Ce(p))!=null?_:w.value,left:(P=Ce(d))!=null?P:c.value,behavior:Ce(u)}))}const O=$e(!1),T=ti({left:!0,right:!1,top:!0,bottom:!1}),k=ti({left:!1,right:!1,top:!1,bottom:!1}),m=d=>{O.value&&(O.value=!1,k.left=!1,k.right=!1,k.top=!1,k.bottom=!1,i(d))},g=Ld(m,n+r),f=d=>{const p=d.target===document?d.target.documentElement:d.target,_=p.scrollLeft;k.left=_<h.value,k.right=_>y.value,T.left=_<=0+(s.left||0),T.right=_+p.clientWidth>=p.scrollWidth-(s.right||0)-Zi,h.value=_;let P=p.scrollTop;d.target===document&&!P&&(P=document.body.scrollTop),k.top=P<y.value,k.bottom=P>y.value,T.top=P<=0+(s.top||0),T.bottom=P+p.clientHeight>=p.scrollHeight-(s.bottom||0)-Zi,y.value=P,O.value=!0,g(d),o(d)};return br(t,"scroll",n?Md(f,n,!0,!1):f,a),br(t,"scrollend",m,a),{x:c,y:w,isScrolling:O,arrivedState:T,directions:k}}var Vi;(function(t){t.UP="UP",t.RIGHT="RIGHT",t.DOWN="DOWN",t.LEFT="LEFT",t.NONE="NONE"})(Vi||(Vi={}));function xs(t){const e=window.getComputedStyle(t);if(e.overflowX==="scroll"||e.overflowY==="scroll"||e.overflowX==="auto"&&t.clientHeight<t.scrollHeight||e.overflowY==="auto"&&t.clientWidth<t.scrollWidth)return!0;{const n=t.parentNode;return!n||n.tagName==="BODY"?!1:xs(n)}}function Wd(t){const e=t||window.event,n=e.target;return xs(n)?!1:e.touches.length>1?!0:(e.preventDefault&&e.preventDefault(),!1)}function zd(t,e=!1){const n=$e(e);let r=null,i;$r(Nd(t),a=>{if(a){const u=a;i=u.style.overflow,n.value&&(u.style.overflow="hidden")}},{immediate:!0});const o=()=>{const a=Ce(t);!a||n.value||(Hi&&(r=br(a,"touchmove",u=>{Wd(u)},{passive:!1})),a.style.overflow="hidden",n.value=!0)},s=()=>{const a=Ce(t);!a||!n.value||(Hi&&(r==null||r()),a.style.overflow=i,n.value=!1)};return Es(s),ot({get(){return n.value},set(a){a?o():s()}})}var Gd=Object.defineProperty,eo=Object.getOwnPropertySymbols,Jd=Object.prototype.hasOwnProperty,Hd=Object.prototype.propertyIsEnumerable,to=(t,e,n)=>e in t?Gd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Yd=(t,e)=>{for(var n in e||(e={}))Jd.call(e,n)&&to(t,n,e[n]);if(eo)for(var n of eo(e))Hd.call(e,n)&&to(t,n,e[n]);return t};const Xd={easeInSine:[.12,0,.39,0],easeOutSine:[.61,1,.88,1],easeInOutSine:[.37,0,.63,1],easeInQuad:[.11,0,.5,0],easeOutQuad:[.5,1,.89,1],easeInOutQuad:[.45,0,.55,1],easeInCubic:[.32,0,.67,0],easeOutCubic:[.33,1,.68,1],easeInOutCubic:[.65,0,.35,1],easeInQuart:[.5,0,.75,0],easeOutQuart:[.25,1,.5,1],easeInOutQuart:[.76,0,.24,1],easeInQuint:[.64,0,.78,0],easeOutQuint:[.22,1,.36,1],easeInOutQuint:[.83,0,.17,1],easeInExpo:[.7,0,.84,0],easeOutExpo:[.16,1,.3,1],easeInOutExpo:[.87,0,.13,1],easeInCirc:[.55,0,1,.45],easeOutCirc:[0,.55,.45,1],easeInOutCirc:[.85,0,.15,1],easeInBack:[.36,0,.66,-.56],easeOutBack:[.34,1.56,.64,1],easeInOutBack:[.68,-.6,.32,1.6]};Yd({linear:Bd},Xd);const Zd={key:0,class:"fixed top-0 left-0 w-full h-full z-30 flex justify-center items-center"},Vd=["onClick"],eh={class:"absolute card lg:w-96 w-11/12 bg-base-100 shadow-xl"},th=Ke({__name:"modal",props:{isOpen:{type:Boolean}},emits:["click:background"],setup(t,{emit:e}){const n=t,r=zd(document.body),i=()=>{e("click:background")};return $r(()=>n.isOpen,o=>{r.value=o}),(o,s)=>(he(),Lt(Bs,{name:"modal"},{default:Sr(()=>[t.isOpen?(he(),Se("div",Zd,[ee("div",{class:"bg-neutral/[.4] w-full h-full",onClick:pn(i,["self"])},null,8,Vd),ee("div",eh,[io(o.$slots,"default",{},void 0,!0)])])):Dt("",!0)]),_:3}))}});const ei=(t,e)=>{const n=t.__vccOpts||t;for(const[r,i]of e)n[r]=i;return n},nh=ei(th,[["__scopeId","data-v-1b4d69e4"]]),rh={},ih={xmlns:"http://www.w3.org/2000/svg",height:"100%",width:"100%",viewBox:"0 96 960 960"},oh=ee("path",{class:"fill-inherit",d:"m361 757 119-121 120 121 47-48-119-121 119-121-47-48-120 121-119-121-48 48 120 121-120 121 48 48ZM261 936q-24 0-42-18t-18-42V306h-41v-60h188v-30h264v30h188v60h-41v570q0 24-18 42t-42 18H261Zm438-630H261v570h438V306Zm-438 0v570-570Z"},null,-1),sh=[oh];function ah(t,e){return he(),Se("svg",ih,sh)}const uh=ei(rh,[["render",ah]]),ch={},fh={xmlns:"http://www.w3.org/2000/svg",height:"100%",viewBox:"0 96 960 960",width:"100%"},lh=ee("path",{d:"M479.956 563q-76.826 0-124.391-48.065Q308 466.87 308 390.704q0-76.167 47.406-123.935Q402.812 219 479.637 219q76.826 0 125.094 47.656Q653 314.312 653 391.204q0 75.666-48.109 123.731Q556.781 563 479.956 563ZM229 926q-38.05 0-64.525-26.3Q138 873.4 138 835v-24.606q0-43.866 22.445-76.846Q182.891 700.568 220 684q68-32 131.854-47 63.854-15 127.731-15 65.877 0 128.646 16Q671 654 739 684q38.375 15.402 61.188 48.465Q823 765.528 823 810.394V835q0 38.4-26.769 64.7Q769.463 926 731 926H229Z"},null,-1),dh=[lh];function hh(t,e){return he(),Se("svg",fh,dh)}const vh=ei(ch,[["render",hh]]),ph={key:0,class:"card-body"},yh={class:"card-title"},gh={class:"card-actions justify-end mt-2"},mh=["onSubmit"],_h=["value"],wh={class:"form-control"},bh=["value"],$h={class:"card-actions justify-end mt-2"},Sh=ee("button",{class:"btn btn-sm btn-outline btn-success",type:"submit"}," сохранить ",-1),kh=Ke({__name:"word_modal",props:{word:null},emits:["click:close","click:remove","click:save"],setup(t,{emit:e}){const n=t,[r,i]=Ud(!1),o=()=>{i(!1),e("click:close")},s=()=>{n.word&&e("click:remove",n.word)},a=u=>{var c,w;if(!n.word)return;const h=new FormData(u.target),y={...n.word,value:((c=h.get("value"))==null?void 0:c.toString())??"",translations:(((w=h.get("translations"))==null?void 0:w.toString())||"").split(", ")};e("click:save",y),i(!1)};return(u,h)=>(he(),Lt(fe(nh),{"is-open":!!t.word,"onClick:background":o},{default:Sr(()=>{var y,c,w,$;return[fe(r)?Dt("",!0):(he(),Se("div",ph,[ee("h1",yh,tn((y=t.word)==null?void 0:y.value),1),ee("p",null,tn((c=t.word)==null?void 0:c.translations.join(", ")),1),ee("div",gh,[ee("button",{class:"btn btn-sm btn-outline btn-error fill-error hover:fill-info-content",onClick:s},[rt(fe(uh),{class:"w-5 h-5"})]),ee("button",{class:"btn btn-sm btn-outline btn-info",onClick:h[0]||(h[0]=O=>fe(i)(!0))}," редактировать ")])])),fe(r)?(he(),Se("form",{key:1,class:"card-body gap-y-4",onSubmit:pn(a,["prevent"])},[ee("input",{class:"input input-sm input-bordered input-info",name:"value",value:(w=t.word)==null?void 0:w.value},null,8,_h),ee("div",wh,[ee("input",{class:"input input-sm input-bordered input-info w-full",name:"translations",value:($=t.word)==null?void 0:$.translations.join(", ")},null,8,bh)]),ee("div",$h,[ee("button",{class:"btn btn-sm btn-outline btn-error",onClick:h[1]||(h[1]=O=>fe(i)(!1))}," отмена "),Sh])],40,mh)):Dt("",!0)]}),_:1},8,["is-open"]))}}),Ah=Ke({__name:"dictionary_table",props:{headClass:null,footClass:null},setup(t){const e=kn(),{dictionary:n}=Ls(e),{removeWord:r,editWord:i}=e,o=$e(),s=y=>{o.value=y},a=()=>{o.value=void 0},u=y=>{r(y),a()},h=y=>{i(y),a()};return(y,c)=>(he(),Se(ro,null,[rt(jd,{words:fe(n),"selected-word":o.value,"head-class":t.headClass,"foot-class":t.footClass,"onClick:word":s},null,8,["words","selected-word","head-class","foot-class"]),rt(kh,{word:o.value,"onClick:close":a,"onClick:remove":u,"onClick:save":h},null,8,["word"])],64))}}),Cs=({scrollElement:t=document,offset:e}=Oh)=>{const{directions:n,y:r,arrivedState:i}=Qd(t,{behavior:"smooth"}),{bottom:o,top:s}=ni(i),{top:a,bottom:u}=ni(n),h=$e(!1);return Ms(()=>{a.value||o.value||s.value?h.value=!1:r.value>((e==null?void 0:e.value)??0)&&u.value&&(h.value=!0)},{flush:"post"}),{isHidden:h}},Oh={scrollElement:document},Eh=Ke({__name:"bottom_sheet",setup(t){const e=$e(),n=ot(()=>{var i;return((i=e.value)==null?void 0:i.offsetHeight)||0}),{isHidden:r}=Cs({offset:n});return(i,o)=>(he(),Se("div",{ref_key:"elementRef",ref:e,class:jt(["bg-base-100 rounded-xl z-20 fixed -bottom-28 drop-shadow-2xl transition-all duration-500",{"bottom-1":!fe(r)}])},[io(i.$slots,"default")],2))}});const xh=["onSubmit"],Ch=["onKeypress"],Ih=["onKeypress"],Th=Ke({__name:"editor_bottom_sheet",setup(t){const e="value",n="translations",r=kn(),i=$e(),o=$e(),s=()=>{var h;(h=o.value)==null||h.focus()},a=()=>{var h;(h=i.value)==null||h.requestSubmit()},u=()=>{const h=new FormData(i.value);r.addWord({value:String(h.get(e)),translations:String(h.get(n)).split(", ")})};return(h,y)=>(he(),Lt(Eh,null,{default:Sr(()=>[ee("form",{ref_key:"formRef",ref:i,class:"navbar join",onSubmit:pn(u,["prevent"])},[ee("input",{type:"text",autocomplete:"off",name:e,class:"input input-bordered input-success join-item w-full",placeholder:"Введите слово ...",onKeypress:nn(s,["enter"])},null,40,Ch),ee("input",{ref_key:"translationsInputRef",ref:o,type:"text",autocomplete:"off",name:n,class:"input input-bordered input-info join-item w-full",placeholder:"... и перевод",onKeypress:nn(a,["enter"])},null,40,Ih)],40,xh)]),_:1}))}}),qh=ee("div",{class:"navbar-start"},[ee("h1",{class:"normal-case font-semibold text-xl select-none"}," focu ")],-1),jh={class:"navbar-end gap-x-2"},Dh={class:"dropdown dropdown-end"},Ph={tabindex:"0",class:"btn btn-ghost btn-circle avatar"},Rh={class:"w-6 rounded-full"},Bh=["src"],Lh={tabindex:"0",class:"mt-3 p-2 shadow menu menu-compact dropdown-content bg-base-100 rounded-box w-52"},Mh={key:0},Nh={key:1},Uh=Ke({__name:"header",setup(t){const e=ks(),n=ot(()=>e==null?void 0:e.user),r=$e(),i=ot(()=>{var s;return((s=r.value)==null?void 0:s.offsetHeight)||0}),{isHidden:o}=Cs({offset:i});return(s,a)=>(he(),Se("header",{ref_key:"elementRef",ref:r,class:jt(["navbar bg-base-100 rounded-xl z-20 fixed -top-28 gap-x-2 drop-shadow-xl",{"top-1":!fe(o)}])},[qh,ee("div",jh,[ee("div",Dh,[ee("label",Ph,[ee("div",Rh,[fe(n)?(he(),Se("img",{key:0,src:fe(n).avatar_url.toString(),referrerpolicy:"no-referrer"},null,8,Bh)):(he(),Lt(fe(vh),{key:1}))])]),ee("ul",Lh,[fe(n)?Dt("",!0):(he(),Se("li",Mh,[ee("span",{onClick:a[0]||(a[0]=(...u)=>{var h,y;return((h=fe(e))==null?void 0:h.loginWithGoogle)&&((y=fe(e))==null?void 0:y.loginWithGoogle(...u))})}," Login with Google ")])),fe(n)?(he(),Se("li",Nh,[ee("span",{onClick:a[1]||(a[1]=(...u)=>{var h,y;return((h=fe(e))==null?void 0:h.logout)&&((y=fe(e))==null?void 0:y.logout(...u))})}," Logout ")])):Dt("",!0)])])])],2))}});const Fh={class:"min-h-full"},Kh={class:"relative container mx-auto"},Qh={class:"page-content"},Yh=Ke({__name:"index",setup(t){const e=kn();ri(wd,e);const n=ks();return ri(Sd,n),(r,i)=>(he(),Se("main",Fh,[ee("div",Kh,[rt(fe(Uh),{class:"container"}),ee("section",Qh,[rt(fe(Ah),{"head-class":"hidden t:table-header-group","foot-class":"hidden t:table-header-group"})]),rt(fe(Th),{class:"container block t:hidden"})])]))}});export{Yh as default};
